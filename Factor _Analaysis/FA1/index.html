<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Factor Analysis Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.0/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --info: #4895ef;
      --warning: #f72585;
      --danger: #e63946;
      --light: #f8f9fa;
      --dark: #212529;
    }
    
    :root.dark-mode {
      --primary: #6366f1;
      --secondary: #818cf8;
      --success: #22d3ee;
      --info: #67e8f9;
      --warning: #fb7185;
      --danger: #f43f5e;
      --light: #1f2937;
      --dark: #f9fafb;
      --bg-main: #0f172a;
      --bg-card: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --border-color: #334155;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-main, #f0f2f5);
      color: var(--text-primary, #111827);
      line-height: 1.6;
      background-image: linear-gradient(135deg, var(--bg-main, #f5f7fa) 0%, var(--bg-card, #c3cfe2) 100%);
      min-height: 100vh;
      transition: background-color 0.3s ease, color 0.3s ease;
    }    .report-container {
      max-width: 1000px;
      margin: 2rem auto;
      background: var(--bg-card, white);
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      overflow: hidden;
      transform: translateY(0);
      transition: all 0.5s ease;
      animation: fadeInUp 0.8s ease-out;
    }
    
    @keyframes fadeInUp {
      from { 
        opacity: 0; 
        transform: translateY(30px);
      }
      to { 
        opacity: 1; 
        transform: translateY(0);
      }
    }
    
    .report-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 2.5rem 2rem;
      text-align: center;
      position: relative;
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
    
    .report-header h1 {
      margin: 0;
      font-size: 2.2rem;
      font-weight: 700;
    }
    
    .report-header p {
      margin-top: 0.5rem;
      opacity: 0.9;
    }
      .stat-card {
      background: var(--bg-card, white);
      border-radius: 8px;
      padding: 1.2rem;
      margin: 1rem;
      transition: all 0.3s ease;
      border-left: 4px solid var(--primary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 0;
      background: linear-gradient(to top, rgba(var(--primary-rgb, 67, 97, 238), 0.1), transparent);
      transition: height 0.3s ease;
      z-index: -1;
    }
    
    .stat-card:hover::before {
      height: 100%;
    }
      .section-title {
      position: relative;
      cursor: pointer;
      padding: 1rem 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      background: var(--bg-card, #f8f9fa);
      border-radius: 8px;
      margin: 1rem 0;
      transition: all 0.3s ease;
      border-left: 4px solid var(--primary);
    }
    
    .section-title:hover {
      background: var(--bg-card, #edf2ff);
      transform: translateX(5px);
    }
    
    .dark-mode .section-title:hover {
      background: rgba(99, 102, 241, 0.15);
    }
    
    .section-title::after {
      content: "↓";
      margin-left: auto;
      transition: all 0.3s ease;
    }
    
    details[open] .section-title::after {
      transform: rotate(180deg);
    }
      .content-box {
      background: var(--bg-card, white);
      padding: 1.5rem;
      border-radius: 8px;
      margin-top: 0.5rem;
      animation: fadeIn 0.5s ease-in-out;
      transition: background-color 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      overflow: hidden;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    
    thead {
      background: linear-gradient(135deg, #e9ecef, #dee2e6);
    }
    
    th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
    }
    
    td {
      padding: 1rem;
      border-bottom: 1px solid #e9ecef;
    }
    
    tbody tr:hover {
      background-color: #f8f9fa;
    }
    
    .highlight {
      font-weight: 600;
      color: var(--primary);
    }
    
    .factor1 { background-color: rgba(67, 97, 238, 0.1); }
    .factor2 { background-color: rgba(247, 37, 133, 0.1); }
    .factor3 { background-color: rgba(76, 201, 240, 0.1); }
    
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-right: 0.5rem;
      background: var(--primary);
      color: white;
    }
    
    .badge-success { background: #4cc9f0; }
    .badge-warning { background: #f72585; }
    .badge-info { background: #4895ef; }
    
    .tooltip {
      position: relative;
      cursor: help;
      border-bottom: 1px dotted #ccc;
    }
    
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    .progress-wrapper {
      height: 6px;
      width: 100%;
      background: #e9ecef;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 5px;
    }
    
    .progress-bar {
      height: 100%;
      background: var(--primary);
    }
    
    .progress-bar.factor1 { background: var(--primary); }
    .progress-bar.factor2 { background: var(--warning); }
    .progress-bar.factor3 { background: var(--success); }
    
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
      margin: 1.5rem 0;
    }
    
    .key-finding {
      padding: 1rem;
      background: linear-gradient(135deg, #f0f9ff, #e1f5fe);
      border-radius: 8px;
      border-left: 4px solid var(--info);
      margin: 1rem 0;
    }
    
    .loading-bar {
      height: 4px;
      width: 0%;
      background: linear-gradient(to right, var(--primary), var(--info));
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      animation: loading 2s ease forwards;
    }
    
    @keyframes loading {
      0% { width: 0%; }
      100% { width: 100%; }
    }
    
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }
      .interactive-cell {
      transition: all 0.2s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .interactive-cell:hover {
      background-color: rgba(67, 97, 238, 0.1);
      transform: scale(1.02);
    }
    
    .interactive-cell:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), var(--info));
      transition: width 0.3s ease;
    }
    
    .interactive-cell:hover:after {
      width: 100%;
    }
    
    .bold-value {
      font-weight: 700;
      color: #1a1a1a;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid #dee2e6;
      margin-bottom: 1rem;
    }
    
    .tab {
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 2px solid transparent;
    }
    
    .tab.active {
      border-bottom: 2px solid var(--primary);
      font-weight: 600;
      color: var(--primary);
    }
      .tab-content {
      display: none;
      animation: fadeIn 0.5s;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
      opacity: 1;
    }
    
    .pulse-effect {
      animation: pulse 0.3s ease;
    }
      @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    /* Dark mode adjustments */
    .dark-mode .report-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    .dark-mode .tab.active {
      color: var(--primary);
      border-color: var(--primary);
    }
    
    .dark-mode th, .dark-mode td {
      color: var(--text-primary);
      border-color: var(--border-color);
    }
    
    .dark-mode .badge {
      background: var(--primary);
    }
    
    .dark-mode .badge-success { background: var(--success); }
    .dark-mode .badge-warning { background: var(--warning); }
    .dark-mode .badge-info { background: var(--info); }
    
    .dark-mode thead {
      background: linear-gradient(135deg, #334155, #1e293b);
    }
    
    .dark-mode .highlight {
      color: var(--primary);
    }
    
    /* Enhanced table styling */
    table {
      transition: all 0.3s ease;
    }
    
    .dark-mode table {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced buttons */
    .action-button {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .action-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%, -50%);
      transform-origin: 50% 50%;
    }
    
    .action-button:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }
    
    @keyframes ripple {
      0% { transform: scale(0, 0); opacity: 0.7; }
      20% { transform: scale(25, 25); opacity: 0.5; }
      100% { opacity: 0; transform: scale(40, 40); }
    }
    
    /* Enhanced chart tooltips */
    .enhanced-tooltip {
      background-color: rgba(0, 0, 0, 0.8) !important;
      border-radius: 6px !important;
      color: white !important;
      padding: 8px 12px !important;
      font-weight: 500 !important;
      font-size: 12px !important;
    }
    
    /* Print styles for export */
    @media print {
      body {
        background: white !important;
        color: black !important;
      }
      
      .report-container {
        box-shadow: none !important;
        margin: 0 !important;
      }
      
      nav, .no-print {
        display: none !important;
      }
    }

    /* Enhanced Animations and Effects */
    .floating {
      animation: floating 3s ease-in-out infinite;
    }

    @keyframes floating {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    /* Glass Card Effect */
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    /* Neon Glow Effect */
    .neon-glow {
      box-shadow: 0 0 5px var(--primary),
                  0 0 25px var(--primary),
                  0 0 50px var(--primary),
                  0 0 100px var(--primary);
    }

    /* Interactive Hover Effects */
    .hover-lift {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-lift:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    /* Gradient Text */
    .gradient-text {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Progress Bar Animation */
    .progress-bar {
      position: relative;
      overflow: hidden;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 30px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: progress-shine 1.5s infinite;
    }

    @keyframes progress-shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(400%); }
    }

    /* Ripple Effect */
    .ripple {
      position: relative;
      overflow: hidden;
    }

    .ripple::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
      background-repeat: no-repeat;
      background-position: 50%;
      transform: scale(10, 10);
      opacity: 0;
      transition: transform .5s, opacity 1s;
    }

    .ripple:active::after {
      transform: scale(0, 0);
      opacity: .3;
      transition: 0s;
    }
  </style>
</head>
<body><div class="loading-bar"></div>
    <nav class="fixed top-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md shadow-sm py-2 px-6 flex items-center justify-between z-50 transition-all">
    <div class="flex items-center">
      <div class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-info flex items-center">
        <i class="fas fa-chart-pie mr-2 text-primary"></i>
        FactorViz
      </div>
    </div>
    <div class="flex items-center space-x-4">
      <button id="exportBtn" class="action-button px-3 py-1 rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-200 text-sm font-medium hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-all flex items-center">
        <i class="fas fa-download mr-1"></i> Export
      </button>
      <button id="shareBtn" class="action-button px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 text-sm font-medium hover:bg-blue-200 dark:hover:bg-blue-800 transition-all flex items-center">
        <i class="fas fa-share-alt mr-1"></i> Share
      </button>
      <button id="themeToggle" class="p-2 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all">
        <i class="fas fa-moon text-gray-600 dark:text-gray-300 dark:hidden"></i>
        <i class="fas fa-sun text-amber-400 hidden dark:block"></i>
      </button>
    </div>
  </nav>
  
  <div class="pt-12"></div>
  
  <div class="report-container">    <div class="report-header relative overflow-hidden">
      <div class="absolute top-0 left-0 w-full h-full">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/10 to-info/10 animate-pulse" style="animation-duration: 10s;"></div>
        <div class="absolute -top-24 -right-24 w-64 h-64 bg-secondary/20 rounded-full filter blur-xl"></div>
        <div class="absolute -bottom-32 -left-32 w-80 h-80 bg-info/20 rounded-full filter blur-xl"></div>
      </div>
      
      <div class="absolute top-4 left-4 bg-white/20 dark:bg-gray-800/30 backdrop-blur-md px-3 py-1 rounded-full text-sm font-medium opacity-80 flex items-center">
        <i class="fas fa-calendar mr-1"></i> Updated May 15, 2025
      </div>
      
      <div class="absolute top-4 right-4 flex space-x-2">
        <div class="bg-white/20 dark:bg-gray-800/30 backdrop-blur-md px-3 py-1 rounded-full text-sm font-medium opacity-80 flex items-center">
          <i class="fas fa-user-circle mr-1"></i> Aditto Ahosan kabbo
        </div>
      </div>
      
      <div class="relative z-10">
        <h1 class="text-shadow-sm">Factor Analysis Report</h1>
        <p class="mb-3">Advanced statistical analysis with visualizations and interactive elements</p>
        <div class="flex justify-center mt-2 space-x-2 flex-wrap">
          <span class="badge bg-gray-700/30 backdrop-blur-md flex items-center animate-fadeIn" style="animation-delay: 0.2s;">
            <i class="fas fa-database mr-1"></i> 329 samples
          </span>
          <span class="badge bg-gray-700/30 backdrop-blur-md flex items-center animate-fadeIn" style="animation-delay: 0.4s;">
            <i class="fas fa-chart-column mr-1"></i> 3 factors
          </span>
          <span class="badge bg-gray-700/30 backdrop-blur-md flex items-center animate-fadeIn" style="animation-delay: 0.6s;">
            <i class="fas fa-check-circle mr-1"></i> KMO 0.703
          </span>
          <span class="badge bg-gray-700/30 backdrop-blur-md flex items-center animate-fadeIn" style="animation-delay: 0.8s;">
            <i class="fas fa-table mr-1"></i> 9 variables
          </span>
        </div>
      </div>
    </div>
      <div class="p-6">
      <!-- Summary Cards -->
      <div class="flex flex-wrap justify-between mb-6">
        <div class="stat-card w-1/4 flex-grow flex-shrink-0 mx-1" style="border-left-color: var(--warning);">
          <h3 class="text-lg font-bold text-gray-700">Sample Size</h3>
          <div class="flex items-center">
            <span class="text-3xl font-bold text-pink-500">329</span>
            <span class="ml-2 text-gray-500">observations</span>
          </div>
        </div>
      
        <div class="stat-card w-1/4 flex-grow flex-shrink-0 mx-1" style="border-left-color: var(--info);">
          <h3 class="text-lg font-bold text-gray-700">Variables</h3>
          <div class="flex items-center">
            <span class="text-3xl font-bold text-purple-500">9</span>
            <span class="ml-2 text-gray-500">analyzed variables</span>
          </div>
        </div>
      
        <div class="stat-card w-1/4 flex-grow flex-shrink-0 mx-1" style="border-left-color: var(--primary);">
          <h3 class="text-lg font-bold text-gray-700">Identified Factors</h3>
          <div class="flex items-center">
            <span class="text-3xl font-bold text-indigo-600">3</span>
            <span class="ml-2 text-gray-500">distinct factors</span>
          </div>
        </div>
      
        <div class="stat-card w-1/4 flex-grow flex-shrink-0 mx-1" style="border-left-color: var(--success);">
          <h3 class="text-lg font-bold text-gray-700">Variance Explained</h3>
          <div class="flex items-center">
            <span class="text-3xl font-bold text-blue-400">62.4%</span>
            <span class="ml-2 text-gray-500">of total variance</span>
          </div>
        </div>
      </div>
      
      <!-- Quick Summary & Chart -->
      <div class="key-finding mb-6">
        <h3 class="font-bold text-lg mb-2">📌 Key Findings</h3>
        <p>Analysis identified <span class="highlight">3 distinct factors</span> explaining <span class="highlight">62.4%</span> of total variance in the 9-variable dataset.</p>
        <div class="chart-container" style="height: 200px;">
          <canvas id="varianceChart"></canvas>
        </div>
      </div>
      
      <!-- Main Report Sections -->
      <details open>
        <summary class="section-title">🔍 1. Data Preparation</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h4 class="font-semibold mb-2">Dataset Overview</h4>
              <ul class="list-disc pl-5 space-y-2">
                <li><span class="tooltip">Initial Data<span class="tooltip-text">Total observations and variables before preprocessing</span></span>: 329 rows, 10 columns</li>
                <li><span class="tooltip">Columns<span class="tooltip-text">Variables in the dataset</span></span>: climate, housing, health, crime, trans, educate, arts, recreate, econ, id</li>
                <li><span class="tooltip">Preprocessing<span class="tooltip-text">Data cleaning steps taken</span></span>: Dropped <code class="bg-gray-100 px-1">id</code> column</li>
                <li><span class="tooltip">Missing Values<span class="tooltip-text">How missing data was handled</span></span>: None found</li>
                <li><span class="tooltip">Final Dataset<span class="tooltip-text">Dataset dimensions after cleaning</span></span>: 329 rows × 9 columns</li>
              </ul>
            </div>
            <div>
              <h4 class="font-semibold mb-2">Variables Overview</h4>
              <div class="overflow-auto max-h-48">
                <table class="w-full">
                  <thead>
                    <tr>
                      <th>Variable</th>
                      <th>Role in Analysis</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="interactive-cell">
                      <td>climate</td>
                      <td><span class="badge badge-info">Factor 3</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>housing</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>health</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>crime</td>
                      <td><span class="badge badge-warning">Factor 2</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>trans</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>educate</td>
                      <td><span class="badge badge-warning">Factor 2</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>arts</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>recreate</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>econ</td>
                      <td><span class="badge badge-warning">Factor 2</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">🧪 2. Suitability Tests</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
              <h4 class="font-semibold mb-3">Bartlett's Test of Sphericity</h4>
              <div class="stat-card text-center">
                <div class="text-2xl font-bold">839.43</div>
                <div class="text-sm text-gray-500">Chi-square value</div>
              </div>
              <div class="stat-card text-center">
                <div class="text-2xl font-bold text-green-600">5.99e-153</div>
                <div class="text-sm text-gray-500">p-value</div>
              </div>
              <div class="p-3 mt-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                <span class="font-semibold">Conclusion: </span>
                <span class="text-green-700">Data is suitable for factor analysis</span>
              </div>
            </div>
            
            <div>
              <h4 class="font-semibold mb-3">Kaiser-Meyer-Olkin (KMO) Test</h4>
              <div class="text-center">
                <div class="relative inline-block w-40 h-40">
                  <svg class="w-full h-full" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#f0f2f5" stroke="#e9ecef" stroke-width="5"></circle>
                    <path d="M50 5 A45 45 0 1 1 5 50" stroke="#4361ee" stroke-width="10" fill="none" stroke-linecap="round"></path>
                    <text x="50" y="50" font-size="18" text-anchor="middle" dy="6" font-weight="bold">0.703</text>
                  </svg>
                </div>
                <div class="mt-2 text-md">
                  <span class="font-semibold">Interpretation: </span>Good sampling adequacy
                </div>
              </div>
              <div class="grid grid-cols-5 gap-1 mt-3">
                <div class="text-center text-xs p-1">0.00</div>
                <div class="text-center text-xs p-1">0.25</div>
                <div class="text-center text-xs p-1">0.50</div>
                <div class="text-center text-xs p-1">0.75</div>
                <div class="text-center text-xs p-1">1.00</div>
              </div>
              <div class="h-3 bg-gray-200 rounded-full w-full relative">
                <div class="h-3 bg-gradient-to-r from-red-400 via-yellow-300 to-green-500 rounded-full" style="width: 70.3%">
                  <div class="absolute -bottom-4 left-[70.3%] transform -translate-x-1/2">
                    <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-1 mt-4 text-xs text-center">
                <div class="p-1 bg-red-100 rounded">Poor<br>&lt;0.5</div>
                <div class="p-1 bg-yellow-100 rounded">Acceptable<br>0.5-0.7</div>
                <div class="p-1 bg-green-100 rounded">Good<br>&gt;0.7</div>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📐 3. Factor Determination</summary>
        <div class="content-box">
          <div class="flex flex-col md:flex-row gap-6">
            <div class="flex-1">
              <h4 class="font-semibold mb-3">Eigenvalues (Kaiser Criterion)</h4>
              <table class="w-full">
                <thead>
                  <tr>
                    <th>Factor</th>
                    <th>Eigenvalue</th>
                    <th>Retained</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="interactive-cell">
                    <td>1</td>
                    <td class="bold-value">3.298</td>
                    <td><span class="text-green-500 font-bold">✓</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>2</td>
                    <td class="bold-value">1.214</td>
                    <td><span class="text-green-500 font-bold">✓</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>3</td>
                    <td class="bold-value">1.196</td>
                    <td><span class="text-green-500 font-bold">✓</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>4–9</td>
                    <td>&lt; 1</td>
                    <td><span class="text-red-500">✗</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="flex-1">
              <h4 class="font-semibold mb-3">Scree Plot</h4>
              <div class="chart-container">
                <canvas id="screePlot"></canvas>
              </div>
              <div class="mt-2 text-sm text-gray-600">
                <p>Scree plot shows an elbow at factor 4, confirming 3-factor retention.</p>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📊 4. Factor Loadings</summary>
        <div class="content-box">
          <div class="tabs">
            <div class="tab active" data-tab="table">Loadings Table</div>
            <div class="tab" data-tab="heatmap">Heatmap View</div>
            <div class="tab" data-tab="grouped">Grouped Factors</div>
          </div>
          
          <div class="tab-content active" id="table">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr>
                    <th>Variable</th>
                    <th>Factor 1</th>
                    <th>Factor 2</th>
                    <th>Factor 3</th>
                    <th>Main Loading</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="interactive-cell">
                    <td>climate</td>
                    <td>0.287</td>
                    <td>0.076</td>
                    <td class="font-bold text-blue-600">0.841</td>
                    <td><span class="badge badge-info">Factor 3</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>housing</td>
                    <td class="font-bold text-indigo-600">0.698</td>
                    <td>0.153</td>
                    <td>0.084</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>health</td>
                    <td class="font-bold text-indigo-600">0.744</td>
                    <td>-0.410</td>
                    <td>-0.020</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>crime</td>
                    <td>0.471</td>
                    <td class="font-bold text-pink-600">0.522</td>
                    <td>0.135</td>
                    <td><span class="badge badge-warning">Factor 2</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>trans</td>
                    <td class="font-bold text-indigo-600">0.681</td>
                    <td>-0.156</td>
                    <td>-0.148</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>educate</td>
                    <td>0.498</td>
                    <td class="font-bold text-pink-600">-0.498</td>
                    <td>-0.253</td>
                    <td><span class="badge badge-warning">Factor 2</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>arts</td>
                    <td class="font-bold text-indigo-600">0.860</td>
                    <td>-0.115</td>
                    <td>0.012</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>recreate</td>
                    <td class="font-bold text-indigo-600">0.642</td>
                    <td>0.322</td>
                    <td>0.044</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>econ</td>
                    <td>0.298</td>
                    <td class="font-bold text-pink-600">0.595</td>
                    <td>-0.533</td>
                    <td><span class="badge badge-warning">Factor 2</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="tab-content" id="heatmap">
            <div class="chart-container">
              <canvas id="heatmapChart"></canvas>
            </div>
          </div>
          
          <div class="tab-content" id="grouped">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="p-4 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                <h4 class="font-bold mb-2 text-indigo-700">Factor 1: Quality of Life/Amenities</h4>
                <ul class="list-disc pl-5">
                  <li>housing <span class="text-sm text-gray-600">(0.698)</span></li>
                  <li>health <span class="text-sm text-gray-600">(0.744)</span></li>
                  <li>trans <span class="text-sm text-gray-600">(0.681)</span></li>
                  <li>arts <span class="text-sm text-gray-600">(0.860)</span></li>
                  <li>recreate <span class="text-sm text-gray-600">(0.642)</span></li>
                </ul>
              </div>
              
              <div class="p-4 bg-pink-50 rounded-lg border-l-4 border-pink-500">
                <h4 class="font-bold mb-2 text-pink-700">Factor 2: Socioeconomic</h4>
                <ul class="list-disc pl-5">
                  <li>crime <span class="text-sm text-gray-600">(0.522)</span></li>
                  <li>educate <span class="text-sm text-gray-600">(-0.498)</span></li>
                  <li>econ <span class="text-sm text-gray-600">(0.595)</span></li>
                </ul>
              </div>
              
              <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                <h4 class="font-bold mb-2 text-blue-700">Factor 3: Climate</h4>
                <ul class="list-disc pl-5">
                  <li>climate <span class="text-sm text-gray-600">(0.841)</span></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📈 5. Communalities</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <div class="chart-container">
                <canvas id="communalitiesChart"></canvas>
              </div>
            </div>
            
            <div>
              <table class="w-full">
                <thead>
                  <tr>
                    <th>Variable</th>
                    <th>Communality</th>
                    <th>Interpretation</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="interactive-cell">
                    <td>climate</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar" style="width: 79.5%"></div>
                        </div>
                        <span>0.795</span>
                      </div>
                    </td>
                    <td><span class="badge badge-success">Excellent</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>housing</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar" style="width: 51.8%"></div>
                        </div>
                        <span>0.518</span>
                      </div>
                    </td>
                    <td><span class="badge">Good</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>health</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar" style="width: 72.2%"></div>
                        </div>
                        <span>0.722</span>
                      </div>
                    </td>
                    <td><span class="badge badge-success">Excellent</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>crime</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar" style="width: 51.2%"></div>
                        </div>
                        <span>0.512</span>
                      </div>
                    </td>
                    <td><span class="badge">Good</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>trans</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar" style="width: 51.0%"></div>
                        </div>
                        <span>0.510</span>
                      </div>
                    </td>
                    <td><span class="badge">Good</span></td>
                  </tr>
                </tbody>
              </table>
              <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                <p>Most communalities > 0.5, indicating good factor explanation of variable variance.</p>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📉 6. Variance Explained</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <div class="chart-container">
                <canvas id="varianceExplainedChart"></canvas>
              </div>
            </div>
            
            <div>
              <table class="w-full">
                <thead>
                  <tr>
                    <th>Factor</th>
                    <th>Variance</th>
                    <th>Proportional Var</th>
                    <th>Cumulative Var</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="interactive-cell factor1">
                    <td>Factor 1</td>
                    <td>3.298</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar factor1" style="width: 36.64%"></div>
                        </div>
                        <span>0.3664</span>
                      </div>
                    </td>
                    <td>0.3664</td>
                  </tr>
                  <tr class="interactive-cell factor2">
                    <td>Factor 2</td>
                    <td>1.214</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar factor2" style="width: 13.48%"></div>
                        </div>
                        <span>0.1348</span>
                      </div>
                    </td>
                    <td>0.5012</td>
                  </tr>
                  <tr class="interactive-cell factor3">
                    <td>Factor 3</td>
                    <td>1.106</td>
                    <td>
                      <div class="flex items-center">
                        <div class="progress-wrapper mr-2">
                          <div class="progress-bar factor3" style="width: 12.28%"></div>
                        </div>
                        <span>0.1228</span>
                      </div>
                    </td>
                    <td>0.6240</td>
                  </tr>
                </tbody>
              </table>
              
              <div class="mt-4 p-4 rounded-lg bg-gradient-to-r from-indigo-50 to-blue-50">
                <h4 class="font-bold">Total Variance Explained: <span class="text-2xl text-indigo-600">62.4%</span></h4>
                <div class="mt-2">
                  <div class="h-6 w-full bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-blue-500" style="width: 62.4%"></div>
                  </div>
                  <div class="flex justify-between text-xs mt-1">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">🔧 7. Practical Implications</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-5 bg-gradient-to-br from-indigo-50 to-blue-50 rounded-lg">
              <div class="flex items-center">
                <div class="p-3 bg-indigo-100 rounded-full mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 012-2z" />
                  </svg>
                </div>
                <h4 class="text-lg font-bold">Statistical Usage</h4>
              </div>
              <p class="mt-3 text-gray-700">Use factor scores for clustering or regression analysis to reduce dimensionality while retaining information.</p>
            </div>
            
            <div class="p-5 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg">
              <div class="flex items-center">
                <div class="p-3 bg-green-100 rounded-full mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
                  </svg>
                </div>
                <h4 class="text-lg font-bold">Factor Names</h4>
              </div>
              <ul class="mt-3 space-y-2 text-gray-700">
                <li><span class="font-medium text-indigo-600">Factor 1:</span> Quality of Life/Amenities</li>
                <li><span class="font-medium text-pink-600">Factor 2:</span> Socioeconomic/Development</li>
                <li><span class="font-medium text-blue-600">Factor 3:</span> Climate</li>
              </ul>
            </div>
            
            <div class="p-5 bg-gradient-to-br from-amber-50 to-yellow-50 rounded-lg">
              <div class="flex items-center">
                <div class="p-3 bg-yellow-100 rounded-full mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                </div>
                <h4 class="text-lg font-bold">Further Steps</h4>
              </div>
              <p class="mt-3 text-gray-700">Consider factor rotation for clearer interpretation and refined factor structure for better theoretical alignment.</p>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📋 8. Summary Table</summary>
        <div class="content-box">
          <table class="w-full">
            <thead>
              <tr>
                <th>Step</th>
                <th>Result/Interpretation</th>
              </tr>
            </thead>
            <tbody>
              <tr class="interactive-cell">
                <td>Data Suitability</td>
                <td><span class="font-medium">Bartlett's p < 0.05</span>, <span class="font-medium">KMO = 0.703</span> (Good)</td>
              </tr>
              <tr class="interactive-cell">
                <td>Factors Retained</td>
                <td>3 (Eigenvalues > 1, Scree plot elbow)</td>
              </tr>
              <tr class="interactive-cell">
                <td>Main Factor Themes</td>
                <td>
                  <span class="badge">1: Quality of Life</span>
                  <span class="badge badge-warning">2: Socioeconomic</span>
                  <span class="badge badge-info">3: Climate</span>
                </td>
              </tr>
              <tr class="interactive-cell">
                <td>Variance Explained</td>
                <td>
                  <div class="flex items-center">
                    <span class="mr-2">62.4% (by 3 factors)</span>
                    <div class="progress-wrapper w-32">
                      <div class="progress-bar bg-gradient-to-r from-indigo-500 to-purple-500" style="width: 62.4%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="interactive-cell">
                <td>Communalities</td>
                <td>Most > 0.5 (factors explain most variable variance)</td>
              </tr>
            </tbody>
          </table>
        </div>
      </details>
    </div>
  </div>

  <div id="particles-js" class="fixed inset-0 pointer-events-none"></div>

  <script>
    // Initialize tabs with smooth transitions
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Add a subtle pulse effect when clicking tabs
        tab.classList.add('pulse-effect');
        setTimeout(() => tab.classList.remove('pulse-effect'), 300);
        
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => {
          c.classList.remove('active');
          c.style.opacity = '0';
        });
        
        tab.classList.add('active');
        const activeContent = document.getElementById(tab.dataset.tab);
        activeContent.classList.add('active');
        
        // Fade in the selected tab content
        setTimeout(() => {
          activeContent.style.opacity = '1';
        }, 10);
      });
    });

    // Initialize Charts
    // Initialize Dark Mode
    function initTheme() {
      const darkMode = localStorage.getItem('darkMode') === 'true';
      if (darkMode) {
        document.documentElement.classList.add('dark-mode');
      }
      
      const themeToggle = document.getElementById('themeToggle');
      themeToggle.addEventListener('click', function() {
        document.documentElement.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.documentElement.classList.contains('dark-mode'));
      });
    }
    
    // Export functionality
    function initExport() {
      document.getElementById('exportBtn').addEventListener('click', function() {
        // Show exporting message
        const toast = document.createElement('div');
        toast.className = 'fixed bottom-4 right-4 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
        toast.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Preparing PDF export...';
        document.body.appendChild(toast);
        
        setTimeout(() => {
          window.print();
          toast.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Export complete!';
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 2000);
        }, 1000);
      });
    }
    
    // Share functionality
    function initShare() {
      document.getElementById('shareBtn').addEventListener('click', function() {
        const url = window.location.href;
        const title = 'Factor Analysis Report';
        
        if (navigator.share) {
          navigator.share({
            title: title,
            url: url
          }).catch(() => {
            copyToClipboard(url);
          });
        } else {
          copyToClipboard(url);
        }
      });
      
      function copyToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const toast = document.createElement('div');
        toast.className = 'fixed bottom-4 right-4 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
        toast.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Link copied to clipboard!';
        document.body.appendChild(toast);
        
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 2000);
      }
    }
    
    // Interactive elements
    function initInteractions() {
      const interactiveCells = document.querySelectorAll('.interactive-cell');
      interactiveCells.forEach((cell, index) => {
        cell.addEventListener('click', function() {
          this.classList.add('pulse-effect');
          setTimeout(() => this.classList.remove('pulse-effect'), 300);
          
          // Add info tooltip when clicked
          const toast = document.createElement('div');
          toast.className = 'fixed bottom-4 left-4 bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
          toast.innerHTML = `<i class="fas fa-info-circle mr-2"></i> Click to copy the value to clipboard`;
          document.body.appendChild(toast);
          
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 2000);
          
          // Copy the cell content
          const content = this.innerText.trim();
          navigator.clipboard.writeText(content).catch(() => {});
        });
        
        // Add reveal animation
        setTimeout(() => {
          cell.style.opacity = '1';
          cell.style.transform = 'translateY(0)';
        }, 70 * index);
      });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      initTheme();
      initExport();
      initShare();
      initInteractions();      // Variance Explained Pie Chart
      const varianceCtx = document.getElementById('varianceChart').getContext('2d');
      const varianceChart = new Chart(varianceCtx, {
        type: 'doughnut',
        data: {
          labels: ['Factor 1', 'Factor 2', 'Factor 3', 'Unexplained'],
          datasets: [{
            data: [36.64, 13.48, 12.28, 37.6],
            backgroundColor: [
              'rgba(67, 97, 238, 0.7)',
              'rgba(247, 37, 133, 0.7)',
              'rgba(76, 201, 240, 0.7)',
              'rgba(200, 200, 200, 0.5)'
            ],
            borderColor: [
              'rgba(67, 97, 238, 1)',
              'rgba(247, 37, 133, 1)',
              'rgba(76, 201, 240, 1)',
              'rgba(200, 200, 200, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: {
            animateRotate: true,
            animateScale: true,
            duration: 2000,
            easing: 'easeOutQuart'
          },
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleFont: {
                size: 14,
                weight: 'bold'
              },
              bodyFont: {
                size: 13
              },
              padding: 12,
              cornerRadius: 6,
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += context.raw + '%';
                  return label;
                }
              }
            }
          }
        }
      });
      
      // Add hover interaction to highlight segments
      document.getElementById('varianceChart').addEventListener('mousemove', (e) => {
        const activePoints = varianceChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, false);
        if (activePoints.length > 0) {
          const index = activePoints[0].index;
          varianceChart.data.datasets[0].backgroundColor.forEach((bg, i) => {
            if (i === index) {
              varianceChart.data.datasets[0].backgroundColor[i] = varianceChart.data.datasets[0].backgroundColor[i].replace('0.7', '0.9');
            } else {
              varianceChart.data.datasets[0].backgroundColor[i] = varianceChart.data.datasets[0].backgroundColor[i].replace('0.9', '0.7');
            }
          });
          varianceChart.update();
        }
      });
        // Scree Plot with animation and interaction
      const screeCtx = document.getElementById('screePlot').getContext('2d');
      const screePlot = new Chart(screeCtx, {
        type: 'line',
        data: {
          labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
          datasets: [{
            label: 'Eigenvalues',
            data: [3.298, 1.214, 1.196, 0.85, 0.75, 0.65, 0.45, 0.32, 0.28],
            borderColor: 'rgba(67, 97, 238, 1)',
            backgroundColor: 'rgba(67, 97, 238, 0.1)',
            pointBackgroundColor: 'rgba(67, 97, 238, 1)',
            pointBorderColor: 'rgba(255, 255, 255, 1)',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8,
            fill: true,
            tension: 0.3
          }, {
            label: 'Kaiser Criterion (Eigenvalue=1)',
            data: [1, 1, 1, 1, 1, 1, 1, 1, 1],
            borderColor: 'rgba(255, 99, 132, 1)',
            borderDash: [5, 5],
            pointRadius: 0,
            fill: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: {
            duration: 2000,
            easing: 'easeOutQuart'
          },
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 15,
                boxWidth: 10
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleFont: { weight: 'bold' },
              bodyFont: { size: 13 },
              padding: 10,
              cornerRadius: 6,
              displayColors: false,
              callbacks: {
                afterLabel: function(context) {
                  if (context.datasetIndex === 0) {
                    const factorNum = parseInt(context.label);
                    if (factorNum <= 3) {
                      return '✓ Factor retained (Eigenvalue > 1)';
                    } else {
                      return '✗ Factor not retained (Eigenvalue < 1)';
                    }
                  }
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Eigenvalue',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              grid: {
                color: 'rgba(200, 200, 200, 0.2)'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Factor Number',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      // Add elbow point annotation
      const annotationPlugin = {
        id: 'elbowAnnotation',
        afterDraw(chart) {
          const ctx = chart.ctx;
          const xAxis = chart.scales.x;
          const yAxis = chart.scales.y;
          
          // Draw elbow annotation
          const elbowX = xAxis.getPixelForValue('4');
          const elbowY = yAxis.getPixelForValue(0.85);
          
          ctx.save();
          ctx.beginPath();
          ctx.arc(elbowX, elbowY, 8, 0, Math.PI * 2);
          ctx.fillStyle = 'rgba(255, 99, 132, 0.2)';
          ctx.fill();
          ctx.strokeStyle = 'rgba(255, 99, 132, 1)';
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.closePath();
          
          ctx.font = '12px Arial';
          ctx.fillStyle = 'rgba(255, 99, 132, 1)';
          ctx.textAlign = 'center';
          ctx.fillText('Elbow Point', elbowX, elbowY - 15);
          ctx.restore();
        }
      };
      
      // Register and add the annotation plugin
      screePlot.options.plugins.annotation = annotationPlugin;
      screePlot.update();
        // Enhanced Communalities Chart
      const communalitiesCtx = document.getElementById('communalitiesChart').getContext('2d');
      const communalitiesChart = new Chart(communalitiesCtx, {
        type: 'bar',
        data: {
          labels: ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'],
          datasets: [{
            label: 'Communality',
            data: [0.795, 0.518, 0.722, 0.512, 0.510, 0.610, 0.754, 0.517, 0.728],
            backgroundColor: [
              'rgba(76, 201, 240, 0.7)',
              'rgba(67, 97, 238, 0.7)',
              'rgba(67, 97, 238, 0.7)',
              'rgba(247, 37, 133, 0.7)',
              'rgba(67, 97, 238, 0.7)',
              'rgba(247, 37, 133, 0.7)',
              'rgba(67, 97, 238, 0.7)',
              'rgba(67, 97, 238, 0.7)',
              'rgba(247, 37, 133, 0.7)'
            ],
            borderColor: [
              'rgba(76, 201, 240, 1)',
              'rgba(67, 97, 238, 1)',
              'rgba(67, 97, 238, 1)',
              'rgba(247, 37, 133, 1)',
              'rgba(67, 97, 238, 1)',
              'rgba(247, 37, 133, 1)',
              'rgba(67, 97, 238, 1)',
              'rgba(67, 97, 238, 1)',
              'rgba(247, 37, 133, 1)'
            ],
            borderWidth: 1
          }, {
            type: 'line',
            label: 'Threshold (0.5)',
            data: [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5],
            borderColor: 'rgba(255, 99, 132, 1)',
            borderDash: [5, 5],
            pointRadius: 0,
            fill: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
            },
          },          scales: {
            y: {
              beginAtZero: true,
              max: 1,
              title: {
                display: true,
                text: 'Communality Value',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              grid: {
                color: 'rgba(200, 200, 200, 0.2)'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          },
          animation: {
            duration: 2000,
            easing: 'easeOutQuart',
            delay: (context) => {
              return context.dataIndex * 100;
            }
          },
          plugins: {
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              cornerRadius: 6,
              padding: 10,
              callbacks: {
                afterLabel: (context) => {
                  const value = context.raw;
                  let interpretation;
                  if (value > 0.7) {
                    interpretation = 'Excellent - Well explained by factors';
                  } else if (value > 0.5) {
                    interpretation = 'Good - Adequately explained by factors';
                  } else if (value > 0.3) {
                    interpretation = 'Fair - Moderately explained by factors';
                  } else {
                    interpretation = 'Poor - Poorly explained by factors';
                  }
                  return 'Interpretation: ' + interpretation;
                }
              }
            }
          }
        }
      });
      
      // Add click interactivity to communalities chart
      document.getElementById('communalitiesChart').addEventListener('click', function(event) {
        const points = communalitiesChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
        if (points.length) {
          const dataIndex = points[0].index;
          const variableName = communalitiesChart.data.labels[dataIndex];
          const value = communalitiesChart.data.datasets[0].data[dataIndex];
          
          // Show detailed info in a toast
          const toast = document.createElement('div');
          toast.className = 'fixed top-20 right-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg z-50';
          toast.style.maxWidth = '300px';
          
          let interpretationClass, interpretationText;
          if (value > 0.7) {
            interpretationClass = 'text-green-600 dark:text-green-400';
            interpretationText = 'Excellent';
          } else if (value > 0.5) {
            interpretationClass = 'text-blue-600 dark:text-blue-400';
            interpretationText = 'Good';
          } else if (value > 0.3) {
            interpretationClass = 'text-yellow-600 dark:text-yellow-400';
            interpretationText = 'Fair';
          } else {
            interpretationClass = 'text-red-600 dark:text-red-400';
            interpretationText = 'Poor';
          }
          
          toast.innerHTML = `
            <div class="flex justify-between items-start">
              <div class="font-bold text-lg">${variableName}</div>
              <button class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="mt-2">
              <div class="font-medium">Communality Value: <span class="font-bold">${value.toFixed(3)}</span></div>
              <div class="font-medium mt-1">Interpretation: <span class="${interpretationClass} font-bold">${interpretationText}</span></div>
              <div class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                This indicates how much of the variable's variance is explained by the extracted factors.
              </div>
            </div>
          `;
          
          document.body.appendChild(toast);
          
          toast.querySelector('button').addEventListener('click', function() {
            document.body.removeChild(toast);
          });
          
          setTimeout(() => {
            if (document.body.contains(toast)) {
              document.body.removeChild(toast);
            }
          }, 5000);
        }
      });
        // Enhanced Variance Explained Chart
      const varianceExplainedCtx = document.getElementById('varianceExplainedChart').getContext('2d');
      const varianceExplainedChart = new Chart(varianceExplainedCtx, {
        type: 'bar',
        data: {
          labels: ['Factor 1', 'Factor 2', 'Factor 3'],
          datasets: [{
            label: 'Variance Explained',
            data: [36.64, 13.48, 12.28],
            backgroundColor: [
              'rgba(67, 97, 238, 0.7)',
              'rgba(247, 37, 133, 0.7)',
              'rgba(76, 201, 240, 0.7)'
            ],
            borderColor: [
              'rgba(67, 97, 238, 1)',
              'rgba(247, 37, 133, 1)',
              'rgba(76, 201, 240, 1)'
            ],
            borderWidth: 1
          }, {
            type: 'line',
            label: 'Cumulative Variance',
            data: [36.64, 50.12, 62.40],
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            pointBackgroundColor: 'rgba(75, 192, 192, 1)',
            pointRadius: 5,
            fill: false,
            yAxisID: 'y1'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Variance Explained (%)'
              },
              max: 40
            },            y1: {
              beginAtZero: true,
              position: 'right',
              title: {
                display: true,
                text: 'Cumulative Variance (%)',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              max: 100,
              grid: {
                drawOnChartArea: false
              }
            }
          },
          animation: {
            delay: (context) => context.dataIndex * 300,
            duration: 2000,
            easing: 'easeOutCubic'
          },
          plugins: {
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleFont: { weight: 'bold' },
              bodyFont: { size: 13 },
              padding: 12,
              cornerRadius: 6,
              callbacks: {
                afterBody: function(context) {
                  const index = context[0].dataIndex;
                  let cumulativePct;
                  if (index === 0) {
                    cumulativePct = 36.64;
                  } else if (index === 1) {
                    cumulativePct = 50.12;
                  } else {
                    cumulativePct = 62.40;
                  }
                  return [`Cumulative variance: ${cumulativePct.toFixed(2)}%`];
                }
              }
            }
          }
        }
      });
      
      // Add interactive annotations to variance explained chart
      const guideline60pct = {
        id: '60pctLine',
        afterDraw(chart) {
          const ctx = chart.ctx;
          const yAxis = chart.scales.y1;
          const xAxis = chart.scales.x;
          
          // Draw 60% guideline
          const y60 = yAxis.getPixelForValue(60);
          
          ctx.save();
          ctx.beginPath();
          ctx.moveTo(xAxis.left, y60);
          ctx.lineTo(xAxis.right, y60);
          ctx.lineWidth = 1;
          ctx.strokeStyle = 'rgba(255, 99, 132, 0.5)';
          ctx.setLineDash([5, 5]);
          ctx.stroke();
          
          // Label
          ctx.fillStyle = 'rgba(255, 99, 132, 0.8)';
          ctx.textAlign = 'right';
          ctx.font = '12px Arial';
          ctx.fillText('Target: 60%', xAxis.right - 10, y60 - 5);
          ctx.restore();
        }
      };
      
      // Add the annotation plugin
      varianceExplainedChart.options.plugins.annotation = guideline60pct;
      varianceExplainedChart.update();
        // Enhanced Heatmap Chart for Factor Loadings with interactivity
      const heatmapCtx = document.getElementById('heatmapChart').getContext('2d');
      
      // Draw grid cells with custom colors and interactivity
      function drawHeatmap() {
        const canvas = document.getElementById('heatmapChart');
        const ctx = canvas.getContext('2d');
        
        // Clear previous drawing
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const variables = ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'];
        const factors = ['Factor 1', 'Factor 2', 'Factor 3'];
        const values = [
          [0.287, 0.076, 0.841],
          [0.698, 0.153, 0.084],
          [0.744, -0.410, -0.020],
          [0.471, 0.522, 0.135],
          [0.681, -0.156, -0.148],
          [0.498, -0.498, -0.253],
          [0.860, -0.115, 0.012],
          [0.642, 0.322, 0.044],
          [0.298, 0.595, -0.533]
        ];
        
        // Check if heatmap should be redrawn (first time or window resize)
        if (!window.heatmapData) {
          window.heatmapData = {
            variables,
            factors,
            values,
            highlighted: null
          };
        }
        
        // Calculate grid dimensions
        const padding = 50;
        const cellWidth = (canvas.width - padding * 2) / factors.length;
        const cellHeight = (canvas.height - padding * 2) / variables.length;
        
        // Draw column headers
        ctx.font = 'bold 14px Arial';
        ctx.textAlign = 'center';
        ctx.fillStyle = '#333';
        factors.forEach((factor, i) => {
          ctx.fillText(factor, padding + cellWidth * i + cellWidth / 2, padding - 20);
        });
        
        // Draw row headers
        ctx.textAlign = 'right';
        variables.forEach((variable, i) => {
          ctx.fillText(variable, padding - 10, padding + cellHeight * i + cellHeight / 2 + 5);
        });
        
        // Draw cells
        for (let row = 0; row < variables.length; row++) {
          for (let col = 0; col < factors.length; col++) {
            const value = values[row][col];
            const x = padding + col * cellWidth;
            const y = padding + row * cellHeight;
            
            // Calculate color intensity based on value
            const intensity = Math.min(Math.abs(value), 1);
            let color;
            if (value > 0) {
              color = `rgba(67, 97, 238, ${intensity})`;
              borderColor = `rgba(67, 97, 238, 1)`;
            } else {
              color = `rgba(247, 37, 133, ${intensity})`;
              borderColor = `rgba(247, 37, 133, 1)`;
            }
            
            // Draw cell background
            ctx.fillStyle = color;
            
            // Check if this cell is highlighted
            if (window.heatmapData.highlighted === `${row}-${col}`) {
              ctx.shadowColor = '#333';
              ctx.shadowBlur = 10;
              ctx.strokeStyle = '#000';
              ctx.lineWidth = 2;
            } else {
              ctx.shadowBlur = 0;
              ctx.strokeStyle = '#ddd';
              ctx.lineWidth = 0.5;
            }
            
            ctx.fillRect(x, y, cellWidth, cellHeight);
            ctx.strokeRect(x, y, cellWidth, cellHeight);
            
            // Draw value text
            ctx.shadowBlur = 0;
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = intensity > 0.5 ? 'white' : '#333';
            ctx.fillText(value.toFixed(3), x + cellWidth / 2, y + cellHeight / 2 + 5);
          }
        }
        
        // Add event listener for interactive hover effects if not already added
        if (!window.heatmapEventAdded) {
          canvas.addEventListener('mousemove', function(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Check if mouse is in grid area
            if (x > padding && x < canvas.width - padding && y > padding && y < canvas.height - padding) {
              const col = Math.floor((x - padding) / cellWidth);
              const row = Math.floor((y - padding) / cellHeight);
              
              if (col >= 0 && col < factors.length && row >= 0 && row < variables.length) {
                const cellId = `${row}-${col}`;
                if (window.heatmapData.highlighted !== cellId) {
                  window.heatmapData.highlighted = cellId;
                  drawHeatmap();
                  
                  // Show tooltip
                  const variable = variables[row];
                  const factor = factors[col];
                  const value = values[row][col];
                  
                  const tooltip = document.createElement('div');
                  tooltip.id = 'heatmap-tooltip';
                  tooltip.className = 'fixed bg-white dark:bg-gray-800 p-3 rounded shadow-lg z-50';
                  tooltip.style.left = (event.clientX + 10) + 'px';
                  tooltip.style.top = (event.clientY - 30) + 'px';
                  
                  let strengthClass;
                  let strengthText;
                  
                  if (Math.abs(value) > 0.7) {
                    strengthClass = 'text-green-600 dark:text-green-400';
                    strengthText = 'Strong';
                  } else if (Math.abs(value) > 0.5) {
                    strengthClass = 'text-blue-600 dark:text-blue-400';
                    strengthText = 'Moderate';
                  } else if (Math.abs(value) > 0.3) {
                    strengthClass = 'text-yellow-600 dark:text-yellow-400';
                    strengthText = 'Weak';
                  } else {
                    strengthClass = 'text-gray-600 dark:text-gray-400';
                    strengthText = 'Very Weak';
                  }
                  
                  tooltip.innerHTML = `
                    <div class="font-bold">${variable} → ${factor}</div>
                    <div>Loading: <span class="font-bold">${value.toFixed(3)}</span></div>
                    <div>Strength: <span class="${strengthClass} font-bold">${strengthText}</span></div>
                  `;
                  
                  // Remove existing tooltip if any
                  const existingTooltip = document.getElementById('heatmap-tooltip');
                  if (existingTooltip) {
                    document.body.removeChild(existingTooltip);
                  }
                  
                  document.body.appendChild(tooltip);
                }
                return;
              }
            }
            
            // If we got here, we're not over a cell
            if (window.heatmapData.highlighted) {
              window.heatmapData.highlighted = null;
              drawHeatmap();
              
              // Remove tooltip
              const existingTooltip = document.getElementById('heatmap-tooltip');
              if (existingTooltip) {
                document.body.removeChild(existingTooltip);
              }
            }
          });
          
          canvas.addEventListener('mouseleave', function() {
            // Clear highlight when mouse leaves canvas
            if (window.heatmapData.highlighted) {
              window.heatmapData.highlighted = null;
              drawHeatmap();
              
              // Remove tooltip
              const existingTooltip = document.getElementById('heatmap-tooltip');
              if (existingTooltip) {
                document.body.removeChild(existingTooltip);
              }
            }
          });
          
          window.heatmapEventAdded = true;
        }
      }
      
      // Initialize and draw the heatmap
      window.addEventListener('resize', drawHeatmap);
      setTimeout(drawHeatmap, 500); // Give time for the canvas to be properly sized
      
      // Fallback to Chart.js if the custom heatmap fails
      const data = {
        labels: ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'],
        datasets: [
          {
            label: 'Factor 1',
            data: [0.287, 0.698, 0.744, 0.471, 0.681, 0.498, 0.860, 0.642, 0.298],
            backgroundColor: function(context) {
              const value = context.dataset.data[context.dataIndex];
              const alpha = Math.abs(value);
              return value > 0 
                ? `rgba(67, 97, 238, ${alpha})` 
                : `rgba(247, 37, 133, ${Math.abs(alpha)})`;
            },
            barPercentage: 1,
            categoryPercentage: 1
          },
          {
            label: 'Factor 2',
            data: [0.076, 0.153, -0.410, 0.522, -0.156, -0.498, -0.115, 0.322, 0.595],
            backgroundColor: function(context) {
              const value = context.dataset.data[context.dataIndex];
              const alpha = Math.abs(value);
              return value > 0 
                ? `rgba(67, 97, 238, ${alpha})` 
                : `rgba(247, 37, 133, ${Math.abs(alpha)})`;
            },
            barPercentage: 1,
            categoryPercentage: 1
          },
          {
            label: 'Factor 3',
            data: [0.841, 0.084, -0.020, 0.135, -0.148, -0.253, 0.012, 0.044, -0.533],
            backgroundColor: function(context) {
              const value = context.dataset.data[context.dataIndex];
              const alpha = Math.abs(value);
              return value > 0 
                ? `rgba(67, 97, 238, ${alpha})` 
                : `rgba(247, 37, 133, ${Math.abs(alpha)})`;
            },
            barPercentage: 1,
            categoryPercentage: 1
          }
        ]
      };
      
      new Chart(heatmapCtx, {
        type: 'bar',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += context.parsed.x.toFixed(3);
                  return label;
                }
              }
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              min: -1,
              max: 1,
              ticks: {
                callback: function(value) {
                  return value.toFixed(1);
                }
              }
            }
          }
        }
      });
        // Add animation to elements
      document.querySelectorAll('.stat-card, .interactive-cell').forEach((el, index) => {
        setTimeout(() => {
          el.style.opacity = '1';
          el.style.transform = 'translateY(0)';
        }, 100 * index);
      });
      
      // Add tooltip hover effects
      document.querySelectorAll('.tooltip').forEach(tooltip => {
        tooltip.addEventListener('mouseenter', function() {
          this.querySelector('.tooltip-text').style.visibility = 'visible';
          this.querySelector('.tooltip-text').style.opacity = '1';
        });
        
        tooltip.addEventListener('mouseleave', function() {
          this.querySelector('.tooltip-text').style.visibility = 'hidden';
          this.querySelector('.tooltip-text').style.opacity = '0';
        });
      });
      
      // Add interactive section collapsing with animation
      document.querySelectorAll('details').forEach(detail => {
        detail.addEventListener('toggle', function() {
          if (this.open) {
            // When opening a section, animate entrance of its child elements
            const contentElements = this.querySelectorAll('.content-box > *');
            contentElements.forEach((el, index) => {
              el.style.opacity = '0';
              el.style.transform = 'translateY(20px)';
              
              setTimeout(() => {
                el.style.transition = 'all 0.5s ease';
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
              }, 100 + (index * 50));
            });
          }
        });
      });
      
      // Add "Save as Image" functionality to charts
      document.querySelectorAll('.chart-container').forEach(container => {
        const chartId = container.querySelector('canvas').id;
        
        // Add button to download chart as image
        const downloadBtn = document.createElement('button');
        downloadBtn.className = 'absolute top-2 right-2 bg-white/50 dark:bg-gray-800/50 hover:bg-white/80 dark:hover:bg-gray-800/80 p-1 rounded-full transition-all text-gray-600 dark:text-gray-300';
        downloadBtn.innerHTML = '<i class="fas fa-download"></i>';
        downloadBtn.title = 'Save chart as image';
        
        downloadBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          
          const canvas = document.getElementById(chartId);
          const link = document.createElement('a');
          link.download = `factor-analysis-${chartId}.png`;
          link.href = canvas.toDataURL('image/png');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          // Show confirmation
          const toast = document.createElement('div');
          toast.className = 'fixed bottom-4 left-4 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-4 py-2 rounded shadow-lg z-50';
          toast.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Chart saved as image';
          document.body.appendChild(toast);
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 3000);
        });
        
        // Add positioning to container if not already present
        container.style.position = 'relative';
        container.appendChild(downloadBtn);
      });    });
    
    // Add expanding card animation when hovering over key stat cards
    document.querySelectorAll('.stat-card').forEach(card => {
      card.addEventListener('mouseenter', function() {
        const valueEl = this.querySelector('.text-3xl');
        if (valueEl) {
          valueEl.style.transition = 'transform 0.3s ease';
          valueEl.style.transform = 'scale(1.2)';
        }
      });
      
      card.addEventListener('mouseleave', function() {
        const valueEl = this.querySelector('.text-3xl');
        if (valueEl) {
          valueEl.style.transform = 'scale(1)';
        }
      });
    });
    
    // Add pulse effect to the report header on load
    setTimeout(() => {
      const header = document.querySelector('.report-header');
      header.classList.add('pulse-effect');
      setTimeout(() => header.classList.remove('pulse-effect'), 800);
    }, 1000);
    
    // Add floating action button for quick navigation
    const addFloatingActionButton = () => {
      const fab = document.createElement('div');
      fab.className = 'fixed bottom-6 right-6 bg-primary dark:bg-primary hover:bg-secondary dark:hover:bg-secondary rounded-full w-14 h-14 flex items-center justify-center shadow-lg cursor-pointer z-50 transition-all';
      fab.innerHTML = '<i class="fas fa-chevron-up text-white text-xl"></i>';
      
      fab.addEventListener('click', function() {
        // Check if the menu is already open
        const isOpen = this.getAttribute('data-open') === 'true';
        
        if (isOpen) {
          // Close the menu
          const menu = document.getElementById('fab-menu');
          if (menu) menu.remove();
          this.setAttribute('data-open', 'false');
          this.innerHTML = '<i class="fas fa-chevron-up text-white text-xl"></i>';
        } else {
          // Open the menu
          this.setAttribute('data-open', 'true');
          this.innerHTML = '<i class="fas fa-times text-white text-xl"></i>';
          
          const menu = document.createElement('div');
          menu.id = 'fab-menu';
          menu.className = 'fixed right-6 bg-white dark:bg-gray-800 rounded-lg shadow-xl z-50 transition-all overflow-hidden';
          menu.style.bottom = '80px';
          menu.style.width = '200px';
          menu.style.animation = 'fadeIn 0.3s ease';
          
          // Create menu items for each section
          const sections = [
            { title: 'Key Findings', icon: 'fa-key', color: 'text-indigo-500' },
            { title: 'Data Preparation', icon: 'fa-database', color: 'text-blue-500' },
            { title: 'Suitability Tests', icon: 'fa-vial', color: 'text-green-500' },
            { title: 'Factor Determination', icon: 'fa-ruler', color: 'text-amber-500' },
            { title: 'Factor Loadings', icon: 'fa-table', color: 'text-red-500' },
            { title: 'Communalities', icon: 'fa-chart-bar', color: 'text-purple-500' },
            { title: 'Variance Explained', icon: 'fa-chart-pie', color: 'text-pink-500' },
            { title: 'Practical Implications', icon: 'fa-lightbulb', color: 'text-cyan-500' },
            { title: 'Summary Table', icon: 'fa-clipboard-list', color: 'text-teal-500' }
          ];
          
          menu.innerHTML = `<div class="py-2">
            ${sections.map((section, index) => `
              <div class="section-link px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer flex items-center transition-all" data-index="${index}">
                <i class="fas ${section.icon} ${section.color} w-6"></i>
                <span class="ml-2 text-sm">${section.title}</span>
              </div>
            `).join('')}
          </div>`;
          
          document.body.appendChild(menu);
          
          // Add click handlers to menu items
          menu.querySelectorAll('.section-link').forEach(link => {
            link.addEventListener('click', function() {
              const index = parseInt(this.getAttribute('data-index'));
              const sections = document.querySelectorAll('details');
              
              if (index === 0) {
                // Scroll to key findings
                document.querySelector('.key-finding').scrollIntoView({ behavior: 'smooth' });
              } else if (sections[index - 1]) {
                // Open the section and scroll to it
                sections[index - 1].open = true;
                sections[index - 1].scrollIntoView({ behavior: 'smooth' });
              }
              
              // Close the menu
              document.getElementById('fab-menu').remove();
              fab.setAttribute('data-open', 'false');
              fab.innerHTML = '<i class="fas fa-chevron-up text-white text-xl"></i>';
            });
          });
        }
      });
      
      document.body.appendChild(fab);
    };
    
    // Add floating action button after a slight delay
    setTimeout(addFloatingActionButton, 2000);
  </script>
</body>
</html>

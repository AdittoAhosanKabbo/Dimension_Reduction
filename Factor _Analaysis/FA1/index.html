<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Factor Analysis Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Wait for Chart.js to load
    window.addEventListener('load', function() {
      // Register the plugins globally
      Chart.register(ChartDataLabels);
      
      // Function to destroy existing chart if it exists
      function destroyChart(chartId) {
        const existingChart = Chart.getChart(chartId);
        if (existingChart) {
          existingChart.destroy();
        }
      }

      // Function to create charts
      function initializeCharts() {
                  // Scree Plot
        const screeCtx = document.getElementById('screePlot');
        if (screeCtx) {
          destroyChart('screePlot');
          new Chart(screeCtx, {
            type: 'line',
            data: {
              labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
              datasets: [{
                label: 'Eigenvalues',
                data: [3.298, 1.214, 1.196, 0.85, 0.75, 0.65, 0.45, 0.32, 0.28],
                borderColor: 'rgb(59, 130, 246)', // bright blue
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                pointBackgroundColor: 'rgb(59, 130, 246)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7,
                fill: true,
                tension: 0.4,
                borderWidth: 2
              }, {
                label: 'Kaiser Criterion (Eigenvalue=1)',
                data: [1, 1, 1, 1, 1, 1, 1, 1, 1],
                borderColor: 'rgba(244, 63, 94, 0.6)', // light red
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false,
                borderWidth: 2
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom',
                  align: 'start',
                  labels: {
                    usePointStyle: true,
                    padding: 10,
                    boxWidth: 10,
                    boxHeight: 10,
                    font: {
                      size: 11
                    }
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(255, 255, 255, 0.95)',
                  titleColor: '#1a1a1a',
                  bodyColor: '#666666',
                  borderColor: '#e5e7eb',
                  borderWidth: 1,
                  padding: 10,
                  cornerRadius: 4,
                  displayColors: true,
                  callbacks: {
                    label: function(context) {
                      if (context.dataset.label === 'Eigenvalues') {
                        return `Eigenvalues: ${context.parsed.y.toFixed(3)}`;
                      }
                      return `Kaiser Criterion: ${context.parsed.y.toFixed(3)}`;
                    }
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 3.5,
                  grid: {
                    color: 'rgba(226, 232, 240, 0.6)',
                    drawBorder: false
                  },
                  ticks: {
                    stepSize: 0.5,
                    padding: 8,
                    font: {
                      size: 11
                    }
                  },
                  title: {
                    display: true,
                    text: 'Eigenvalue',
                    font: {
                      size: 13,
                      weight: '500'
                    },
                    padding: {bottom: 10}
                  }
                },
                x: {
                  grid: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    padding: 8,
                    font: {
                      size: 11
                    }
                  },
                  title: {
                    display: true,
                    text: 'Factor Number',
                    font: {
                      size: 13,
                      weight: '500'
                    },
                    padding: {top: 10}
                  }
                }
              }
            }
          });
        } else {
          console.log('Scree plot canvas not found');
        }

                  // Communalities Chart
        const communalitiesCtx = document.getElementById('communalitiesChart');
        if (communalitiesCtx) {
          destroyChart('communalitiesChart');
          new Chart(communalitiesCtx, {
            type: 'bar',
            data: {
              labels: ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'],
              datasets: [{
                label: 'Communality',
                data: [0.795, 0.518, 0.722, 0.512, 0.510, 0.561, 0.754, 0.517, 0.728],
                backgroundColor: [
                  'rgba(16, 185, 129, 0.8)',  // emerald
                  'rgba(99, 102, 241, 0.8)',  // indigo
                  'rgba(20, 184, 166, 0.8)',  // teal
                  'rgba(249, 115, 22, 0.8)',  // orange
                  'rgba(59, 130, 246, 0.8)',  // blue
                  'rgba(236, 72, 153, 0.8)',  // pink
                  'rgba(16, 185, 129, 0.8)',  // emerald
                  'rgba(139, 92, 246, 0.8)',  // violet
                  'rgba(34, 197, 94, 0.8)'    // green
                ],
                borderWidth: 1,
                borderRadius: 6,
                borderColor: [
                  'rgb(16, 185, 129)',
                  'rgb(99, 102, 241)',
                  'rgb(20, 184, 166)',
                  'rgb(249, 115, 22)',
                  'rgb(59, 130, 246)',
                  'rgb(236, 72, 153)',
                  'rgb(16, 185, 129)',
                  'rgb(139, 92, 246)',
                  'rgb(34, 197, 94)'
                ]
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              animation: {
                duration: 2000,
                easing: 'easeOutQuart'
              },
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  backgroundColor: 'rgba(255, 255, 255, 0.95)',
                  titleColor: '#1a1a1a',
                  bodyColor: '#666666',
                  borderColor: '#e5e7eb',
                  borderWidth: 1,
                  padding: 12,
                  cornerRadius: 4,
                  callbacks: {
                    label: function(context) {
                      const value = context.raw;
                      let interpretation = value > 0.7 ? 'Excellent' : value > 0.5 ? 'Good' : 'Fair';
                      return [`Value: ${value.toFixed(3)}`, `Interpretation: ${interpretation}`];
                    }
                  }
                },
                datalabels: {
                  color: '#ffffff',
                  font: {
                    weight: '600',
                    size: 11
                  },
                  padding: 4,
                  formatter: (value) => value.toFixed(3)
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 1,
                  title: {
                    display: true,
                    text: 'Communality Value',
                    font: {
                      size: 13,
                      weight: '500'
                    },
                    padding: {bottom: 10}
                  },
                  grid: {
                    color: 'rgba(226, 232, 240, 0.6)',
                    drawBorder: false
                  },
                  ticks: {
                    padding: 8,
                    font: {
                      size: 11
                    }
                  }
                },
                x: {
                  grid: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    padding: 8,
                    font: {
                      size: 11
                    }
                  }
                }
              }
            }
          });
        } else {
          console.log('Communalities chart canvas not found');
        }

                  // Variance Distribution Chart
        const varianceCtx = document.getElementById('varianceExplainedChart');
        if (varianceCtx) {
          destroyChart('varianceExplainedChart');
          new Chart(varianceCtx, {
            type: 'bar',
            data: {
              labels: ['Factor 1', 'Factor 2', 'Factor 3'],
              datasets: [{
                label: 'Variance Explained',
                data: [36.64, 13.48, 12.28],
                backgroundColor: [
                  'rgba(79, 70, 229, 0.8)',  // indigo
                  'rgba(236, 72, 153, 0.8)', // pink
                  'rgba(20, 184, 166, 0.8)'  // teal
                ],
                borderColor: [
                  'rgb(79, 70, 229)',
                  'rgb(236, 72, 153)',
                  'rgb(20, 184, 166)'
                ],
                borderWidth: 1,
                borderRadius: 6
              }, {
                type: 'line',
                label: 'Cumulative Variance',
                data: [36.64, 50.12, 62.40],
                borderColor: 'rgba(14, 165, 233, 1)',
                backgroundColor: 'rgba(14, 165, 233, 0.2)',
                pointBackgroundColor: 'rgba(14, 165, 233, 1)',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8,
                fill: false,
                tension: 0.1,
                yAxisID: 'y1'
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              animation: {
                duration: 2000,
                easing: 'easeOutQuart'
              },
              interaction: {
                mode: 'index',
                intersect: false
              },
              plugins: {
                legend: {
                  position: 'top',
                  align: 'end',
                  labels: {
                    boxWidth: 15,
                    padding: 15,
                    usePointStyle: true
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(255, 255, 255, 0.95)',
                  titleColor: '#1a1a1a',
                  bodyColor: '#666666',
                  borderColor: '#e5e7eb',
                  borderWidth: 1,
                  padding: 12,
                  cornerRadius: 4,
                  callbacks: {
                    label: function(context) {
                      let label = context.dataset.label || '';
                      if (label) {
                        label += ': ';
                      }
                      label += context.parsed.y.toFixed(2) + '%';
                      return label;
                    }
                  }
                },
                datalabels: {
                  color: '#ffffff',
                  font: {
                    weight: '600',
                    size: 11
                  },
                  padding: 4,
                  formatter: (value) => value.toFixed(1) + '%'
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 100,
                  position: 'left',
                  title: {
                    display: true,
                    text: 'Variance Explained (%)',
                    font: {
                      size: 13,
                      weight: '500'
                    },
                    padding: {bottom: 10}
                  },
                  grid: {
                    color: 'rgba(226, 232, 240, 0.6)',
                    drawBorder: false
                  },
                  ticks: {
                    padding: 8,
                    callback: function(value) {
                      return value + '%';
                    },
                    font: {
                      size: 11
                    }
                  }
                },
                y1: {
                  beginAtZero: true,
                  max: 100,
                  position: 'right',
                  title: {
                    display: true,
                    text: 'Cumulative Variance (%)',
                    font: {
                      size: 13,
                      weight: '500'
                    },
                    padding: {bottom: 10}
                  },
                  grid: {
                    drawOnChartArea: false,
                    drawBorder: false
                  },
                  ticks: {
                    padding: 8,
                    callback: function(value) {
                      return value + '%';
                    },
                    font: {
                      size: 11
                    }
                  }
                },
                x: {
                  grid: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    padding: 8,
                    font: {
                      size: 11
                    }
                  }
                }
              }
            }
          });
        } else {
          console.log('Variance chart canvas not found');
        }
      }

      // Initialize charts
      initializeCharts();

      // Re-initialize charts when tab is clicked (in case they're in tabs)
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
          setTimeout(initializeCharts, 100);
        });
      });
    });
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.0/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --info: #4895ef;
      --warning: #f72585;
      --danger: #e63946;
      --light: #f8f9fa;
      --dark: #212529;
    }
    
    :root.dark-mode {
      --primary: #6366f1;
      --secondary: #818cf8;
      --success: #22d3ee;
      --info: #67e8f9;
      --warning: #fb7185;
      --danger: #f43f5e;
      --light: #1f2937;
      --dark: #f9fafb;
      --bg-main: #0f172a;
      --bg-card: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --border-color: #334155;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-main, #f0f2f5);
      color: var(--text-primary, #111827);
      line-height: 1.6;
      background-image: linear-gradient(135deg, var(--bg-main, #f5f7fa) 0%, var(--bg-card, #c3cfe2) 100%);
      min-height: 100vh;
      transition: background-color 0.3s ease, color 0.3s ease;
    }    .report-container {
      max-width: 1500px;
      min-height: 1200px; /* Added minimum height */
      margin: 2rem auto;
      background: var(--bg-card, white);
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      overflow: hidden;
      transform: translateY(0);
      transition: all 0.5s ease;
      animation: fadeInUp 0.8s ease-out;
    }
    
    @keyframes fadeInUp {
      from { 
        opacity: 0; 
        transform: translateY(30px);
      }
      to { 
        opacity: 1; 
        transform: translateY(0);
      }
    }
    
    .report-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 2.5rem 2rem;
      text-align: center;
      position: relative;
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
    
    .report-header h1 {
      margin: 0;
      font-size: 2.2rem;
      font-weight: 700;
    }
    
    .report-header p {
      margin-top: 0.5rem;
      opacity: 0.9;
    }
      .stat-card {
      background: var(--bg-card, white);
      border-radius: 8px;
      padding: 1.2rem;
      margin: 1rem;
      transition: all 0.3s ease;
      border-left: 4px solid var(--primary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 0;
      background: linear-gradient(to top, rgba(var(--primary-rgb, 67, 97, 238), 0.1), transparent);
      transition: height 0.3s ease;
      z-index: -1;
    }
    
    .stat-card:hover::before {
      height: 100%;
    }
      .section-title {
      position: relative;
      cursor: pointer;
      padding: 1rem 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      background: var(--bg-card, #f8f9fa);
      border-radius: 8px;
      margin: 1rem 0;
      transition: all 0.3s ease;
      border-left: 4px solid var(--primary);
    }
    
    .section-title:hover {
      background: var(--bg-card, #edf2ff);
      transform: translateX(5px);
    }
    
    .dark-mode .section-title:hover {
      background: rgba(99, 102, 241, 0.15);
    }
    
    .section-title::after {
      content: "↓";
      margin-left: auto;
      transition: all 0.3s ease;
    }
    
    details[open] .section-title::after {
      transform: rotate(180deg);
    }
      .content-box {
      background: var(--bg-card, white);
      padding: 1.5rem;
      border-radius: 8px;
      margin-top: 0.5rem;
      animation: fadeIn 0.5s ease-in-out;
      transition: background-color 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      overflow: hidden;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    
    thead {
      background: linear-gradient(135deg, #e9ecef, #dee2e6);
    }
    
    th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
    }
    
    td {
      padding: 1rem;
      border-bottom: 1px solid #e9ecef;
    }
    
    tbody tr:hover {
      background-color: #f8f9fa;
    }
    
    .highlight {
      font-weight: 600;
      color: var(--primary);
    }
    
    .factor1 { background-color: rgba(67, 97, 238, 0.1); }
    .factor2 { background-color: rgba(247, 37, 133, 0.1); }
    .factor3 { background-color: rgba(76, 201, 240, 0.1); }
    
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-right: 0.5rem;
      background: var(--primary);
      color: white;
    }
    
    .badge-success { background: #4cc9f0; }
    .badge-warning { background: #f72585; }
    .badge-info { background: #4895ef; }
    
    .tooltip {
      position: relative;
      cursor: help;
      border-bottom: 1px dotted #ccc;
    }
    
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    .progress-wrapper {
      height: 6px;
      width: 100%;
      background: #e9ecef;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 5px;
    }
    
    .progress-bar {
      height: 100%;
      background: var(--primary);
    }
    
    .progress-bar.factor1 { background: var(--primary); }
    .progress-bar.factor2 { background: var(--warning); }
    .progress-bar.factor3 { background: var(--success); }
    
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
      margin: 1.5rem 0;
    }
    
    .key-finding {
      padding: 1rem;
      background: linear-gradient(135deg, #f0f9ff, #e1f5fe);
      border-radius: 8px;
      border-left: 4px solid var(--info);
      margin: 1rem 0;
    }
    
    .loading-bar {
      height: 4px;
      width: 0%;
      background: linear-gradient(to right, var(--primary), var(--info));
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      animation: loading 2s ease forwards;
    }
    
    @keyframes loading {
      0% { width: 0%; }
      100% { width: 100%; }
    }
    
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }

    /* Factor Loadings Tabs Styles */
    .tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 0.5rem;
    }

    .tab {
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      color: #6B7280;
      font-weight: 500;
      transition: all 0.2s ease;
      user-select: none;
    }

    .tab:hover {
      color: #4B5563;
    }

    .tab.active {
      color: #4F46E5;
      border-bottom-color: #4F46E5;
    }

    .tab-content {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      width: 100%;
    }

    .tab-content.active {
      display: block;
      opacity: 1;
    }

    /* Heatmap specific styles */
    #heatmap {
      width: 100%;
      min-height: 500px;
      padding: 1rem;
    }
    
    #heatmap .chart-container {
      background: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      width: 100%;
      height: 500px;
      position: relative;
    }
    
    #heatmapChart {
      width: 100% !important;
      height: 100% !important;
      touch-action: none;
    }
      .interactive-cell {
      transition: all 0.2s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .interactive-cell:hover {
      background-color: rgba(67, 97, 238, 0.1);
      transform: scale(1.02);
    }
    
    .interactive-cell:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), var(--info));
      transition: width 0.3s ease;
    }
    
    .interactive-cell:hover:after {
      width: 100%;
    }
    
    .bold-value {
      font-weight: 700;
      color: #1a1a1a;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid #dee2e6;
      margin-bottom: 1rem;
    }
    
    .tab {
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 2px solid transparent;
    }
    
    .tab.active {
      border-bottom: 2px solid var(--primary);
      font-weight: 600;
      color: var(--primary);
    }
      .tab-content {
      display: none;
      animation: fadeIn 0.5s;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
      opacity: 1;
    }
    
    .pulse-effect {
      animation: pulse 0.3s ease;
    }
      @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    /* Dark mode adjustments */
    .dark-mode .report-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    .dark-mode .tab.active {
      color: var(--primary);
      border-color: var(--primary);
    }
    
    .dark-mode th, .dark-mode td {
      color: var(--text-primary);
      border-color: var(--border-color);
    }
    
    .dark-mode .badge {
      background: var(--primary);
    }
    
    .dark-mode .badge-success { background: var(--success); }
    .dark-mode .badge-warning { background: var(--warning); }
    .dark-mode .badge-info { background: var(--info); }
    
    .dark-mode thead {
      background: linear-gradient(135deg, #334155, #1e293b);
    }
    
    .dark-mode .highlight {
      color: var(--primary);
    }
    
    /* Enhanced table styling */
    table {
      transition: all 0.3s ease;
    }
    
    .dark-mode table {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced buttons */
    .action-button {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .action-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%, -50%);
      transform-origin: 50% 50%;
    }
    
    .action-button:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }
    
    @keyframes ripple {
      0% { transform: scale(0, 0); opacity: 0.7; }
      20% { transform: scale(25, 25); opacity: 0.5; }
      100% { opacity: 0; transform: scale(40, 40); }
    }
    
    /* Button styling enhancements */
    #exportBtn, #shareBtn {
      position: relative !important;
      z-index: 100 !important;
      transition: all 0.3s ease !important;
      cursor: pointer !important;
      overflow: visible !important;
      transform: translateZ(0) !important;
      will-change: transform !important;
      box-shadow: 0 0 10px rgba(0,0,0,0.1) !important;
    }
    
    #exportBtn:hover, #shareBtn:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2) !important;
    }
    
    .dark-mode #exportBtn {
      background-color: #4f46e5 !important;
      color: white !important;
      border: none !important;
    }
    
    .dark-mode #shareBtn {
      background-color: #3b82f6 !important;
      color: white !important;
      border: none !important;
    }
    
    .dark-mode #exportBtn i, .dark-mode #shareBtn i {
      color: white !important;
    }
    
    /* Enhanced chart tooltips */
    .enhanced-tooltip {
      background-color: rgba(0, 0, 0, 0.8) !important;
      border-radius: 6px !important;
      color: white !important;
      padding: 8px 12px !important;
      font-weight: 500 !important;
      font-size: 12px !important;
    }
    
    /* Print styles for export */
    @media print {
      body {
        background: white !important;
        color: black !important;
      }
      
      .report-container {
        box-shadow: none !important;
        margin: 0 !important;
      }
      
      nav, .no-print {
        display: none !important;
      }
    }

    /* Enhanced Animations and Effects */
    .floating {
      animation: floating 3s ease-in-out infinite;
    }

    @keyframes floating {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    /* Glass Card Effect */
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    /* Neon Glow Effect */
    .neon-glow {
      box-shadow: 0 0 5px var(--primary),
                  0 0 25px var(--primary),
                  0 0 50px var(--primary),
                  0 0 100px var(--primary);
    }

    /* Interactive Hover Effects */
    .hover-lift {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-lift:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    /* Gradient Text */
    .gradient-text {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Progress Bar Animation */
    .progress-bar {
      position: relative;
      overflow: hidden;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 30px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: progress-shine 1.5s infinite;
    }

    @keyframes progress-shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(400%); }
    }

    /* Ripple Effect */
    .ripple {
      position: relative;
      overflow: hidden;
    }

    .ripple::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
      background-repeat: no-repeat;
      background-position: 50%;
      transform: scale(10, 10);
      opacity: 0;
      transition: transform .5s, opacity 1s;
    }

    .ripple:active::after {
      transform: scale(0, 0);
      opacity: .3;
      transition: 0s;
    }
    
    @keyframes progress-pulse {
      0% { transform: scaleY(1); }
      50% { transform: scaleY(1.2); }
      100% { transform: scaleY(1); }
    }
    
    .progress-pulse {
      animation: progress-pulse 0.5s ease;
    }
    
    .factor-tooltip {
      position: fixed;
      z-index: 9999;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 12px;
      max-width: 280px;
      pointer-events: none;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s, transform 0.3s;
    }
    
    .factor-tooltip.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body><div class="loading-bar"></div>
    <nav class="fixed top-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md shadow-sm py-2 px-6 flex items-center justify-between z-50 transition-all">
    <div class="flex items-center">
      <div class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-info flex items-center">
        <i class="fas fa-chart-pie mr-2 text-primary"></i>
        FactorViz
      </div>
    </div>
    <div class="flex items-center space-x-4">
      <button id="datasetBtn" class="action-button px-3 py-1 rounded-full bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200 text-sm font-medium hover:bg-green-200 dark:hover:bg-green-800 transition-all flex items-center">
        <i class="fas fa-table mr-1"></i> View Dataset
      </button>
      <button id="exportBtn" onclick="handleExport()" class="action-button px-3 py-1 rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-200 text-sm font-medium hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-all flex items-center">
        <i class="fas fa-download mr-1"></i> Export
      </button>
      <button id="shareBtn" onclick="handleShare()" class="action-button px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 text-sm font-medium hover:bg-blue-200 dark:hover:bg-blue-800 transition-all flex items-center">
        <i class="fas fa-share-alt mr-1"></i> Share
      </button>
    </div>
  </nav>
  
  <!-- Dataset Viewer Modal -->
  <div id="datasetModal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" id="datasetOverlay"></div>
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-11/12 max-w-6xl max-h-[90vh] flex flex-col relative z-10 transform transition-all scale-95 opacity-0" id="datasetContent">
      <div class="p-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center sticky top-0 bg-white dark:bg-gray-800 rounded-t-xl z-10">
        <div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
            <i class="fas fa-database mr-2 text-green-500"></i>
            Dataset: Factor Analysis Data
          </h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            Source: <a href="https://github.com/AdittoAhosanKabbo/Dimension_Reduction/blob/main/Factor%20_Analaysis/FA1/places_tf.csv" target="_blank" class="text-blue-500 hover:underline">GitHub Repository</a>
          </p>
        </div>
        <div class="flex items-center gap-2">
          <div class="relative">
            <input 
              type="text" 
              id="datasetSearch" 
              placeholder="Search data..." 
              class="pl-8 pr-4 py-1 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-sm focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400"
            >
            <i class="fas fa-search absolute left-3 top-2 text-gray-400"></i>
          </div>
          <button id="datasetDownloadBtn" class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200 rounded-md hover:bg-green-200 dark:hover:bg-green-800 transition-colors flex items-center text-sm">
            <i class="fas fa-download mr-1"></i> CSV
          </button>
          <button id="datasetCloseBtn" class="ml-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>
      
      <div class="p-5 overflow-auto flex-grow relative">
        <!-- Loading indicator -->
        <div id="datasetLoader" class="absolute inset-0 flex flex-col items-center justify-center bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm z-10">
          <div class="w-16 h-16 border-4 border-t-blue-500 border-blue-200 rounded-full animate-spin mb-4"></div>
          <p class="text-gray-600 dark:text-gray-300">Loading dataset...</p>
        </div>
        
        <!-- Error message -->
        <div id="datasetError" class="hidden flex flex-col items-center justify-center py-10 text-center">
          <div class="bg-red-100 dark:bg-red-900/30 p-4 rounded-lg max-w-md">
            <i class="fas fa-exclamation-triangle text-red-500 text-3xl mb-3"></i>
            <h4 class="text-lg font-semibold text-red-700 dark:text-red-400 mb-2">Failed to load dataset</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-4" id="errorMessage">Unable to retrieve the dataset from GitHub.</p>
            <button id="retryBtn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors">
              Try Again
            </button>
          </div>
        </div>
        
        <!-- Dataset view tabs -->
        <div id="datasetView" class="hidden">
          <div class="border-b border-gray-200 dark:border-gray-700 mb-4">
            <ul class="flex -mb-px">
              <li class="mr-2">
                <button id="summaryTabBtn" class="inline-block py-2 px-4 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400 font-medium text-sm focus:outline-none">
                  Data Summary
                </button>
              </li>
              <li class="mr-2">
                <button id="tableTabBtn" class="inline-block py-2 px-4 text-gray-500 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300 font-medium text-sm border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-700 focus:outline-none">
                  Data Table
                </button>
              </li>
            </ul>
          </div>
          
          <!-- Data Summary Tab -->
          <div id="dataSummaryTab">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Dataset Overview -->
              <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                <div class="bg-indigo-50 dark:bg-indigo-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                  <h3 class="font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-indigo-600 dark:text-indigo-400"></i>
                    Dataset Overview
                  </h3>
                </div>
                <div class="p-4">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                      <div class="text-sm text-gray-500 dark:text-gray-400">Total Rows</div>
                      <div class="font-bold text-lg text-indigo-600 dark:text-indigo-400" id="summaryTotalRows">-</div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                      <div class="text-sm text-gray-500 dark:text-gray-400">Total Columns</div>
                      <div class="font-bold text-lg text-indigo-600 dark:text-indigo-400" id="summaryTotalCols">-</div>
                    </div>
                  </div>
                  
                  <!-- Sample Records -->
                  <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Sample Records</h4>
                    <div class="overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-lg">
                      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700" id="sampleRecordsTable">
                        <thead class="bg-gray-50 dark:bg-gray-700">
                          <tr id="sampleTableHeader"></tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="sampleTableBody"></tbody>
                      </table>
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Showing first 5 records</div>
                  </div>
                </div>
              </div>
              
              <!-- Variable Information -->
              <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                <div class="bg-blue-50 dark:bg-blue-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                  <h3 class="font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                    <i class="fas fa-table mr-2 text-blue-600 dark:text-blue-400"></i>
                    Variable Information
                  </h3>
                </div>
                <div class="p-4">
                  <div class="overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                      <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                          <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Variable
                          </th>
                          <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Type
                          </th>
                          <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Non-Null
                          </th>
                        </tr>
                      </thead>
                      <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="variableInfoBody">
                        <!-- Variable info will be populated here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              
              <!-- Data Quality -->
              <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                <div class="bg-amber-50 dark:bg-amber-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                  <h3 class="font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                    <i class="fas fa-check-circle mr-2 text-amber-600 dark:text-amber-400"></i>
                    Data Quality Check
                  </h3>
                </div>
                <div class="p-4">
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                      <div class="text-sm text-gray-500 dark:text-gray-400">Missing Values</div>
                      <div class="font-bold text-lg text-amber-600 dark:text-amber-400" id="summaryMissingValues">-</div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                      <div class="text-sm text-gray-500 dark:text-gray-400">Duplicate Rows</div>
                      <div class="font-bold text-lg text-amber-600 dark:text-amber-400" id="summaryDuplicates">-</div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                      <div class="text-sm text-gray-500 dark:text-gray-400">Potential Outliers</div>
                      <div class="font-bold text-lg text-amber-600 dark:text-amber-400" id="summaryOutliers">-</div>
                    </div>
                  </div>
                  
                  <!-- Missing Values Details -->
                  <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Missing Values by Column</h4>
                    <div class="overflow-x-auto max-h-40 border border-gray-200 dark:border-gray-700 rounded-lg">
                      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0">
                          <tr>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Column</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Missing Count</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Percentage</th>
                          </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="missingValuesBody">
                          <!-- Missing values will be populated here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Basic Statistics -->
              <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                <div class="bg-green-50 dark:bg-green-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                  <h3 class="font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                    <i class="fas fa-chart-bar mr-2 text-green-600 dark:text-green-400"></i>
                    Basic Statistics
                  </h3>
                </div>
                <div class="p-4">
                  <!-- Statistics Tabs -->
                  <div class="border-b border-gray-200 dark:border-gray-700 mb-3">
                    <ul class="flex -mb-px">
                      <li class="mr-2">
                        <button id="numericalStatsBtn" class="inline-block py-2 px-4 text-green-600 dark:text-green-400 border-b-2 border-green-600 dark:border-green-400 font-medium text-sm focus:outline-none">
                          Numerical
                        </button>
                      </li>
                      <li class="mr-2">
                        <button id="categoricalStatsBtn" class="inline-block py-2 px-4 text-gray-500 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300 font-medium text-sm border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-700 focus:outline-none">
                          Categorical
                        </button>
                      </li>
                    </ul>
                  </div>
                  
                  <!-- Numerical Stats Tab -->
                  <div id="numericalStatsTab">
                    <div class="overflow-x-auto max-h-64 border border-gray-200 dark:border-gray-700 rounded-lg">
                      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0">
                          <tr>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Variable</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Mean</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Median</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Std</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Min</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Max</th>
                          </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="numericalStatsBody">
                          <!-- Numerical statistics will be populated here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                  
                  <!-- Categorical Stats Tab -->
                  <div id="categoricalStatsTab" class="hidden">
                    <div class="overflow-x-auto max-h-64 border border-gray-200 dark:border-gray-700 rounded-lg">
                      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0">
                          <tr>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Variable</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Unique Values</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Most Common</th>
                            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Frequency</th>
                          </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="categoricalStatsBody">
                          <!-- Categorical statistics will be populated here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Data Table Tab -->
          <div id="dataTableTab" class="hidden">
            <div id="datasetTableContainer">
          <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4 flex gap-4 flex-wrap">
            <div>
              <span class="font-semibold text-gray-700 dark:text-gray-300">Rows:</span>
              <span id="dataRowCount" class="ml-1 text-blue-700 dark:text-blue-300">0</span>
            </div>
            <div>
              <span class="font-semibold text-gray-700 dark:text-gray-300">Columns:</span>
              <span id="dataColCount" class="ml-1 text-blue-700 dark:text-blue-300">0</span>
            </div>
            <div class="ml-auto flex gap-2">
              <select id="dataPageSize" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-sm px-2 py-1">
                <option value="10">10 rows</option>
                <option value="25" selected>25 rows</option>
                <option value="50">50 rows</option>
                <option value="100">100 rows</option>
                <option value="all">All rows</option>
              </select>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table id="datasetTable" class="w-full border-collapse">
              <thead>
                <tr id="tableHeader" class="bg-gray-100 dark:bg-gray-700 text-left">
                  <!-- Table headers will be inserted here dynamically -->
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- Table rows will be inserted here dynamically -->
              </tbody>
            </table>
          </div>
          
          <!-- Pagination controls -->
          <div id="paginationControls" class="flex items-center justify-between mt-4 flex-wrap gap-2">
            <div class="flex items-center gap-1">
              <button id="prevPageBtn" class="px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-left"></i>
              </button>
              <span class="mx-2 text-sm">
                Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
              </span>
              <button id="nextPageBtn" class="px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">
              Showing <span id="startRow">1</span>-<span id="endRow">25</span> of <span id="totalRows">0</span> rows
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pt-12"></div>
  
  <div class="report-container">    <div class="report-header relative overflow-hidden min-h-[240px]">
      <!-- Dynamic Animated Background -->
      <div class="absolute inset-0 bg-gradient-to-br from-indigo-600 via-purple-600 to-blue-500 background-animate"></div>
      
      <!-- Animated particles overlay -->
      <div id="particles-header" class="absolute inset-0 opacity-60"></div>
      
      <!-- Geometric decorations -->
      <div class="absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-pink-500/30 to-purple-500/30 rounded-full filter blur-3xl transform translate-x-1/3 -translate-y-1/3 animate-pulse-slow"></div>
      <div class="absolute bottom-0 left-0 w-96 h-96 bg-gradient-to-tr from-blue-500/30 to-teal-500/30 rounded-full filter blur-3xl transform -translate-x-1/3 translate-y-1/3 animate-pulse-slow" style="animation-delay: 2s"></div>
      
      <!-- Animated shapes -->
      <div class="header-shape shape-1 absolute"></div>
      <div class="header-shape shape-2 absolute"></div>
      <div class="header-shape shape-3 absolute"></div>
      
      <!-- Header content with 3D effect -->
      <div class="relative z-10 p-8 perspective-container" id="headerContent">
        <!-- Glassmorphism card for title -->
        <div class="text-center p-6 rounded-2xl bg-white/10 backdrop-blur-md border border-white/20 shadow-xl transform transition-all duration-500 hover:scale-105 header-card">
          <h1 class="text-4xl md:text-5xl font-bold mb-2 text-white text-shadow-glow tracking-wide header-title">Factor Analysis Report</h1>
          <div class="h-6 mb-3">
            <p class="text-white/90 text-lg typewriter"></p>
          </div>
          
          <!-- Interactive metric cards -->
          <div class="flex flex-wrap justify-center gap-5 mt-8">
            <div class="metric-card rounded-2xl bg-white/15 backdrop-blur-md p-5 border border-white/20 flex flex-col items-center justify-between transition-all duration-500 cursor-pointer hover:bg-white/25 hover:scale-105 hover:shadow-glow relative group w-44 h-44" data-metric="samples">
              <!-- Animated background gradient -->
              <div class="absolute inset-0 bg-gradient-to-r from-blue-500/0 via-blue-500/30 to-blue-500/0 opacity-0 group-hover:opacity-100 rounded-2xl blur-sm transition-opacity animate-pulse-slow"></div>
              
              <!-- Particle effect container -->
              <div class="absolute inset-0 overflow-hidden rounded-2xl particle-container opacity-0 group-hover:opacity-30"></div>
              
              <!-- Empty top spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- 3D Card effect wrapper -->
              <div class="card-content relative z-10 flex flex-col items-center transform transition-transform duration-300">
                <!-- Icon with glow effect -->
                <div class="icon-wrapper relative mb-3">
                  <div class="absolute inset-0 bg-blue-400/30 rounded-full blur-md scale-0 group-hover:scale-150 transition-transform duration-700"></div>
                  <i class="fas fa-database text-3xl text-blue-200 relative"></i>
                  </div>
                
                <!-- Value with counting animation -->
                <div class="font-bold text-white text-3xl mb-3 relative z-10 count-up value-pulse" data-target="329">0</div>
                
                <!-- Label with shimmer effect -->
                <div class="text-blue-100 text-sm font-medium relative z-10 label-shimmer w-full text-center">Samples</div>
                </div>
              
              <!-- Empty bottom spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- Corner accent -->
              <div class="absolute top-0 right-0 w-4 h-4 bg-blue-400/50 rounded-bl-xl rounded-tr-xl transform -translate-y-0.5 translate-x-0.5"></div>
              </div>
            
            <div class="metric-card rounded-2xl bg-white/15 backdrop-blur-md p-5 border border-white/20 flex flex-col items-center justify-between transition-all duration-500 cursor-pointer hover:bg-white/25 hover:scale-105 hover:shadow-glow relative group w-44 h-44" data-metric="variables">
              <!-- Animated background gradient -->
              <div class="absolute inset-0 bg-gradient-to-r from-purple-500/0 via-purple-500/30 to-purple-500/0 opacity-0 group-hover:opacity-100 rounded-2xl blur-sm transition-opacity animate-pulse-slow"></div>
              
              <!-- Particle effect container -->
              <div class="absolute inset-0 overflow-hidden rounded-2xl particle-container opacity-0 group-hover:opacity-30"></div>
              
              <!-- Empty top spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- 3D Card effect wrapper -->
              <div class="card-content relative z-10 flex flex-col items-center transform transition-transform duration-300">
                <!-- Icon with glow effect -->
                <div class="icon-wrapper relative mb-3">
                  <div class="absolute inset-0 bg-purple-400/30 rounded-full blur-md scale-0 group-hover:scale-150 transition-transform duration-700"></div>
                  <i class="fas fa-table text-3xl text-purple-200 relative"></i>
            </div>
            
                <!-- Value with counting animation -->
                <div class="font-bold text-white text-3xl mb-3 relative z-10 count-up value-pulse" data-target="9">0</div>
                
                <!-- Label with shimmer effect -->
                <div class="text-purple-100 text-sm font-medium relative z-10 label-shimmer w-full text-center">Variables Analyzed</div>
                </div>
              
              <!-- Empty bottom spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- Corner accent -->
              <div class="absolute top-0 right-0 w-4 h-4 bg-purple-400/50 rounded-bl-xl rounded-tr-xl transform -translate-y-0.5 translate-x-0.5"></div>
              </div>
            
            <div class="metric-card rounded-2xl bg-white/15 backdrop-blur-md p-5 border border-white/20 flex flex-col items-center justify-between transition-all duration-500 cursor-pointer hover:bg-white/25 hover:scale-105 hover:shadow-glow relative group w-44 h-44" data-metric="factors">
              <!-- Animated background gradient -->
              <div class="absolute inset-0 bg-gradient-to-r from-green-500/0 via-green-500/30 to-green-500/0 opacity-0 group-hover:opacity-100 rounded-2xl blur-sm transition-opacity animate-pulse-slow"></div>
              
              <!-- Particle effect container -->
              <div class="absolute inset-0 overflow-hidden rounded-2xl particle-container opacity-0 group-hover:opacity-30"></div>
              
              <!-- Empty top spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- 3D Card effect wrapper -->
              <div class="card-content relative z-10 flex flex-col items-center transform transition-transform duration-300">
                <!-- Icon with glow effect -->
                <div class="icon-wrapper relative mb-3">
                  <div class="absolute inset-0 bg-green-400/30 rounded-full blur-md scale-0 group-hover:scale-150 transition-transform duration-700"></div>
                  <i class="fas fa-chart-column text-3xl text-green-200 relative"></i>
            </div>
            
                <!-- Value with counting animation -->
                <div class="font-bold text-white text-3xl mb-3 relative z-10 value-pulse">3</div>
                
                <!-- Label with shimmer effect -->
                <div class="text-green-100 text-sm font-medium relative z-10 label-shimmer w-full text-center">Factors</div>
                  </div>
              
              <!-- Empty bottom spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- Corner accent -->
              <div class="absolute top-0 right-0 w-4 h-4 bg-green-400/50 rounded-bl-xl rounded-tr-xl transform -translate-y-0.5 translate-x-0.5"></div>
                    </div>
            
            <div class="metric-card rounded-2xl bg-white/15 backdrop-blur-md p-5 border border-white/20 flex flex-col items-center justify-between transition-all duration-500 cursor-pointer hover:bg-white/25 hover:scale-105 hover:shadow-glow relative group w-44 h-44" data-metric="variance">
              <!-- Animated background gradient -->
              <div class="absolute inset-0 bg-gradient-to-r from-amber-500/0 via-amber-500/30 to-amber-500/0 opacity-0 group-hover:opacity-100 rounded-2xl blur-sm transition-opacity animate-pulse-slow"></div>
              
              <!-- Particle effect container -->
              <div class="absolute inset-0 overflow-hidden rounded-2xl particle-container opacity-0 group-hover:opacity-30"></div>
              
              <!-- Empty top spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- 3D Card effect wrapper -->
              <div class="card-content relative z-10 flex flex-col items-center transform transition-transform duration-300">
                <!-- Icon with glow effect -->
                <div class="icon-wrapper relative mb-3">
                  <div class="absolute inset-0 bg-amber-400/30 rounded-full blur-md scale-0 group-hover:scale-150 transition-transform duration-700"></div>
                  <i class="fas fa-chart-pie text-3xl text-amber-200 relative"></i>
                  </div>
                
                <!-- Value with counting animation -->
                <div class="font-bold text-white text-3xl mb-3 relative z-10 value-pulse">62.4%</div>
                
                <!-- Label with shimmer effect -->
                <div class="text-amber-100 text-sm font-medium relative z-10 label-shimmer w-full text-center">Variance Explained</div>
                </div>
              
              <!-- Empty bottom spacer for alignment -->
              <div class="h-2"></div>
              
              <!-- Corner accent -->
              <div class="absolute top-0 right-0 w-4 h-4 bg-amber-400/50 rounded-bl-xl rounded-tr-xl transform -translate-y-0.5 translate-x-0.5"></div>
              </div>
            </div>
            
          <!-- Add the required styles and scripts for the enhanced cards -->
          <style>
            /* Pulse animation for values */
            .value-pulse:hover {
              animation: value-pulse 1.5s infinite;
            }
            
            @keyframes value-pulse {
              0% { transform: scale(1); }
              50% { transform: scale(1.05); text-shadow: 0 0 15px rgba(255,255,255,0.5); }
              100% { transform: scale(1); }
            }
            
            /* Shimmer effect for labels */
            .label-shimmer {
              position: relative;
              overflow: hidden;
            }
            
            .label-shimmer::after {
              content: '';
              position: absolute;
              top: 0;
              left: -100%;
              width: 100%;
              height: 100%;
              background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
              animation: shimmer 2s infinite;
              animation-play-state: paused;
            }
            
            .metric-card:hover .label-shimmer::after {
              animation-play-state: running;
            }
            
            @keyframes shimmer {
              0% { left: -100%; }
              100% { left: 100%; }
            }
            
            /* 3D tilt effect */
            .metric-card:hover .card-content {
              transform: translateZ(20px);
            }
            
            /* Particle animation */
            .particle {
              position: absolute;
              background: white;
              border-radius: 50%;
              opacity: 0;
              animation: float-up 3s ease-in-out infinite;
            }
            
            @keyframes float-up {
              0% { transform: translateY(100%); opacity: 0; }
              20% { opacity: 0.7; }
              80% { opacity: 0.7; }
              100% { transform: translateY(-50px); opacity: 0; }
            }
            
            /* Pulse slow animation */
            @keyframes pulse-slow {
              0% { opacity: 0.2; }
              50% { opacity: 0.5; }
              100% { opacity: 0.2; }
            }
            
            .animate-pulse-slow {
              animation: pulse-slow 4s ease-in-out infinite;
            }
          </style>
          
          <script>
            // Initialize particle effects for cards
            document.addEventListener('DOMContentLoaded', function() {
              const containers = document.querySelectorAll('.particle-container');
              
              containers.forEach(container => {
                // Create random particles
                for (let i = 0; i < 15; i++) {
                  const particle = document.createElement('div');
                  particle.classList.add('particle');
                  
                  // Random size
                  const size = Math.random() * 4 + 2;
                  particle.style.width = `${size}px`;
                  particle.style.height = `${size}px`;
                  
                  // Random position
                  const leftPos = Math.random() * 100;
                  particle.style.left = `${leftPos}%`;
                  
                  // Random delay
                  const delay = Math.random() * 3;
                  particle.style.animationDelay = `${delay}s`;
                  
                  container.appendChild(particle);
                }
              });
              
              // Add 3D tilt effect
              const cards = document.querySelectorAll('.metric-card');
              
              cards.forEach(card => {
                card.addEventListener('mousemove', (e) => {
                  const cardRect = card.getBoundingClientRect();
                  const cardCenterX = cardRect.left + cardRect.width / 2;
                  const cardCenterY = cardRect.top + cardRect.height / 2;
                  
                  const mouseX = e.clientX - cardCenterX;
                  const mouseY = e.clientY - cardCenterY;
                  
                  // Calculate rotation (max 10 degrees)
                  const rotateY = mouseX * 10 / (cardRect.width / 2);
                  const rotateX = -mouseY * 10 / (cardRect.height / 2);
                  
                  const content = card.querySelector('.card-content');
                  content.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(20px)`;
                });
                
                card.addEventListener('mouseleave', () => {
                  const content = card.querySelector('.card-content');
                  content.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateZ(0)';
                });
                
                // Add click effect
                card.addEventListener('click', function() {
                  this.classList.add('scale-95');
                  setTimeout(() => {
                    this.classList.remove('scale-95');
                  }, 200);
                });
              });
            });
          </script>
        </div>
        
        <!-- Date and author info badges -->
        <div class="absolute top-4 left-4 bg-white/10 backdrop-blur-lg px-3 py-1.5 rounded-full text-sm font-medium text-white border border-white/20 hover:bg-white/20 transition-all cursor-pointer flex items-center shadow-glow-sm interactive-badge">
          <i class="fas fa-calendar-alt mr-2 text-blue-200"></i> Updated May 15, 2025
        </div>
        
        <div class="absolute top-4 right-4 bg-white/10 backdrop-blur-lg px-3 py-1.5 rounded-full text-sm font-medium text-white border border-white/20 hover:bg-white/20 transition-all cursor-pointer flex items-center shadow-glow-sm interactive-badge group" onclick="document.querySelector('footer').scrollIntoView({behavior: 'smooth'});">
                     <img src="https://raw.githubusercontent.com/AdittoAhosanKabbo/AdittoAhosanKabbo/main/Assets/20221031_113233-removebg.png" 
               alt="" 
               class="w-6 h-6 mr-2 rounded-full border-2 border-purple-300 group-hover:border-white transition-all"
               style="aspect-ratio: 1/1; object-fit: cover; object-position: center top;"
               onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
          <i class="fas fa-user-circle mr-2 text-purple-200 group-hover:animate-pulse" style="display: none;"></i>
          <span class="relative">
            Aditto Ahosan Kabbo
            <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-purple-400 to-transparent group-hover:w-full transition-all duration-300"></span>
          </span>
          <div class="absolute invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-all duration-300 top-full right-0 mt-2 bg-white/10 backdrop-blur-lg rounded-lg p-2 z-50 shadow-xl border border-white/20 w-40">
            <div class="flex space-x-2 justify-center">
              <a href="https://github.com/AdittoAhosanKabbo" target="_blank" class="text-gray-300 hover:text-white transition-colors">
                <i class="fab fa-github"></i>
              </a>
              <a href="https://www.linkedin.com/in/adittoahosankabbo/" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors">
                <i class="fab fa-linkedin"></i>
              </a>
              <a href="mailto:adittoahosankabbo@gmail.com" class="text-red-400 hover:text-red-300 transition-colors">
                <i class="far fa-envelope"></i>
              </a>
              <a href="https://www.kaggle.com/adittoahosankabbo" target="_blank" class="text-cyan-400 hover:text-cyan-300 transition-colors">
                <i class="fab fa-kaggle"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add necessary styles for the new header -->
    <style>
      .background-animate {
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
      }

      @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      
      .text-shadow-glow {
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.3),
                     0 0 20px rgba(255, 255, 255, 0.2),
                     0 0 30px rgba(255, 255, 255, 0.1);
      }
      
      .shadow-glow {
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.3),
                    0 0 30px rgba(79, 70, 229, 0.2);
      }
      
      .shadow-glow-sm {
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.2),
                    0 0 20px rgba(79, 70, 229, 0.1);
      }
      
      .perspective-container {
        perspective: 1000px;
      }
      
      .header-card {
        transform-style: preserve-3d;
      }
      
      .header-title {
        position: relative;
        display: inline-block;
      }
      
      .header-title::after {
        content: '';
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
      }
      
      .typewriter {
        overflow: hidden;
        border-right: 2px solid rgba(255, 255, 255, 0.75);
        white-space: nowrap;
        margin: 0 auto;
        animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
      }
      
      @keyframes typing {
        from { width: 0 }
        to { width: 100% }
      }
      
      @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: rgba(255, 255, 255, 0.75) }
      }
      
      .animate-pulse-slow {
        animation: pulse 6s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 0.6; transform: scale(1) }
        50% { opacity: 0.4; transform: scale(1.1) }
      }
      
      .header-shape {
        width: 80px;
        height: 80px;
        background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
        border-radius: 50%;
      }
      
      .shape-1 {
        top: 20%;
        left: 15%;
        animation: float 8s ease-in-out infinite;
      }
      
      .shape-2 {
        top: 60%;
        right: 10%;
        width: 100px;
        height: 100px;
        animation: float 10s ease-in-out infinite;
        animation-delay: 1s;
      }
      
      .shape-3 {
        bottom: 15%;
        left: 30%;
        width: 60px;
        height: 60px;
        animation: float 6s ease-in-out infinite;
        animation-delay: 2s;
      }
      
      @keyframes float {
        0% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
        100% { transform: translateY(0px) rotate(0deg); }
      }
      
      .interactive-badge:hover {
        transform: translateY(-2px);
      }
    </style>

    <!-- Add additional script for the enhanced header features -->
    <script>
      // Add to the existing document DOMContentLoaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize the header with existing functions
        initHeaderEffects();
        initHeaderParticles();
        initTypingEffect();
        initCountUpAnimation();
        init3DEffect();
      });
      
      // Initialize 3D tilt effect on the header card
      function init3DEffect() {
        const headerContent = document.getElementById('headerContent');
        const headerCard = document.querySelector('.header-card');
        
        if (!headerContent || !headerCard) return;
        
        headerContent.addEventListener('mousemove', (e) => {
          const rect = headerContent.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          
          const rotateX = (y - centerY) / 30;
          const rotateY = (centerX - x) / 30;
          
          headerCard.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`;
        });
        
        headerContent.addEventListener('mouseleave', () => {
          headerCard.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)';
        });
      }
      
      // Initialize typing effect for the subtitle
      function initTypingEffect() {
        const typewriter = document.querySelector('.typewriter');
        if (!typewriter) return;
        
        const text = "Advanced statistical analysis with visualizations and interactive elements";
        typewriter.textContent = '';
        
        let charIndex = 0;
        function typeText() {
          if (charIndex < text.length) {
            typewriter.textContent += text.charAt(charIndex);
            charIndex++;
            setTimeout(typeText, 50);
          }
        }
        
        // Start typing after a brief delay
        setTimeout(typeText, 500);
      }
      
      // Initialize count-up animation for metrics
      function initCountUpAnimation() {
        // Regular count up for integers
        document.querySelectorAll('.count-up').forEach(counter => {
          const target = parseInt(counter.getAttribute('data-target'));
          const duration = 2000; // 2 seconds
          
          let startTime = null;
          
          function animateCount(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = timestamp - startTime;
            const percentage = Math.min(progress / duration, 1);
            
            const currentCount = Math.floor(percentage * target);
            counter.textContent = currentCount;
            
            if (percentage < 1) {
              requestAnimationFrame(animateCount);
            } else {
              counter.textContent = target;
            }
          }
          
          requestAnimationFrame(animateCount);
        });
        
        // Count up for decimal values (like KMO)
        document.querySelectorAll('.count-up-decimal').forEach(counter => {
          const target = parseFloat(counter.getAttribute('data-target'));
          const duration = 2000; // 2 seconds
          
          let startTime = null;
          
          function animateCount(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = timestamp - startTime;
            const percentage = Math.min(progress / duration, 1);
            
            const currentCount = percentage * target;
            counter.textContent = currentCount.toFixed(3);
            
            if (percentage < 1) {
              requestAnimationFrame(animateCount);
            } else {
              counter.textContent = target.toFixed(3);
            }
          }
          
          requestAnimationFrame(animateCount);
        });
      }
      
      // Initialize particle effects for the header background
      function initHeaderParticles() {
        if (typeof particlesJS === 'function') {
          particlesJS("particles-header", {
            particles: {
              number: {
                value: 30,
                density: {
                  enable: true,
                  value_area: 800
                }
              },
              color: {
                value: "#ffffff"
              },
              shape: {
                type: "circle",
                stroke: {
                  width: 0,
                  color: "#000000"
                }
              },
              opacity: {
                value: 0.3,
                random: true,
                anim: {
                  enable: true,
                  speed: 1,
                  opacity_min: 0.1,
                  sync: false
                }
              },
              size: {
                value: 3,
                random: true,
                anim: {
                  enable: true,
                  speed: 2,
                  size_min: 0.1,
                  sync: false
                }
              },
              line_linked: {
                enable: true,
                distance: 150,
                color: "#ffffff",
                opacity: 0.2,
                width: 1
              },
              move: {
                enable: true,
                speed: 1,
                direction: "none",
                random: true,
                straight: false,
                out_mode: "out",
                bounce: false,
                attract: {
                  enable: false,
                  rotateX: 600,
                  rotateY: 1200
                }
              }
            },
            interactivity: {
              detect_on: "canvas",
              events: {
                onhover: {
                  enable: true,
                  mode: "grab"
                },
                onclick: {
                  enable: true,
                  mode: "push"
                },
                resize: true
              },
              modes: {
                grab: {
                  distance: 140,
                  line_linked: {
                    opacity: 0.5
                  }
                },
                push: {
                  particles_nb: 3
                }
              }
            },
            retina_detect: true
          });
        }
      }
      
      // Add mouse parallax effect to header elements
      function initHeaderEffects() {
        const header = document.querySelector('.report-header');
        
        if (!header) return;
        
        header.addEventListener('mousemove', (e) => {
          const x = e.clientX / window.innerWidth;
          const y = e.clientY / window.innerHeight;
          
          const shapes = document.querySelectorAll('.header-shape');
          shapes.forEach((shape, index) => {
            const speed = (index + 1) * 20;
            const xOffset = (x * speed) - (speed / 2);
            const yOffset = (y * speed) - (speed / 2);
            shape.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
          });
          
          // Add subtle parallax to other elements
          const title = document.querySelector('.header-title');
          if (title) {
            title.style.transform = `translate(${x * 10 - 5}px, ${y * 10 - 5}px)`;
          }
        });
        
        // Add click effects to metric cards
        document.querySelectorAll('.metric-card').forEach(card => {
          card.addEventListener('click', function() {
            this.classList.add('scale-90');
            setTimeout(() => {
              this.classList.remove('scale-90');
            }, 150);
            
            // Pulse effect on click
            const type = this.getAttribute('data-metric');
            const value = document.querySelector(`.count-up[data-target="${type}"]`) || 
                        document.querySelector(`.count-up-decimal[data-target="${type}"]`);
            
            if (value) {
              value.classList.add('scale-125', 'text-shadow-glow');
              setTimeout(() => {
                value.classList.remove('scale-125', 'text-shadow-glow');
              }, 300);
            }
          });
        });
      }
    </script>
      <div class="p-6">
      
      <!-- Quick Summary & Chart -->
      <div class="key-finding mb-6">
        <h3 class="font-bold text-lg mb-2">📌 Key Findings</h3>
        <p>Analysis identified <span class="highlight">3 distinct factors</span> explaining <span class="highlight">62.4%</span> of total variance in the 9-variable dataset.</p>
        <div class="chart-container" style="height: 30px;">
          
        </div>
      </div>
      
      <!-- Main Report Sections -->
      <details open>
        <summary class="section-title">🔍 1. Data Preparation</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h4 class="font-semibold mb-2">Dataset Overview</h4>
              <ul class="list-disc pl-5 space-y-2">
                <li><span class="tooltip">Initial Data<span class="tooltip-text">Total observations and variables before preprocessing</span></span>: 329 rows, 10 columns</li>
                <li><span class="tooltip">Columns<span class="tooltip-text">Variables in the dataset</span></span>: climate, housing, health, crime, trans, educate, arts, recreate, econ, id</li>
                <li><span class="tooltip">Preprocessing<span class="tooltip-text">Data cleaning steps taken</span></span>: Dropped <code class="bg-gray-100 px-1">id</code> column</li>
                <li><span class="tooltip">Missing Values<span class="tooltip-text">How missing data was handled</span></span>: None found</li>
                <li><span class="tooltip">Final Dataset<span class="tooltip-text">Dataset dimensions after cleaning</span></span>: 329 rows × 9 columns</li>
              </ul>
            </div>
            <div>
              <h4 class="font-semibold mb-2">Variables Overview</h4>
              <div class="overflow-auto max-h-48">
                <table class="w-full">
                  <thead>
                    <tr>
                      <th>Variable</th>
                      <th>Role in Analysis</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="interactive-cell">
                      <td>climate</td>
                      <td><span class="badge badge-info">Factor 3</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>housing</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>health</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>crime</td>
                      <td><span class="badge badge-warning">Factor 2</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>trans</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>educate</td>
                      <td><span class="badge badge-warning">Factor 2</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>arts</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>recreate</td>
                      <td><span class="badge">Factor 1</span></td>
                    </tr>
                    <tr class="interactive-cell">
                      <td>econ</td>
                      <td><span class="badge badge-warning">Factor 2</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">🧪 2. Suitability Tests</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
              <h4 class="font-semibold mb-3">Bartlett's Test of Sphericity</h4>
              <div class="stat-card text-center">
                <div class="text-2xl font-bold">839.43</div>
                <div class="text-sm text-gray-500">Chi-square value</div>
              </div>
              <div class="stat-card text-center">
                <div class="text-2xl font-bold text-green-600">5.99e-153</div>
                <div class="text-sm text-gray-500">p-value</div>
              </div>
              <div class="p-3 mt-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                <span class="font-semibold">Conclusion: </span>
                <span class="text-green-700">Data is suitable for factor analysis</span>
              </div>
            </div>
            
            <div>
              <h4 class="font-semibold mb-3">Kaiser-Meyer-Olkin (KMO) Test</h4>
              <div class="text-center">
                <div class="relative inline-block w-40 h-40">
                  <svg class="w-full h-full" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#f0f2f5" stroke="#e9ecef" stroke-width="5"></circle>
                    <path d="M50 5 A45 45 0 1 1 5 50" stroke="#4361ee" stroke-width="10" fill="none" stroke-linecap="round"></path>
                    <text x="50" y="50" font-size="18" text-anchor="middle" dy="6" font-weight="bold">0.703</text>
                  </svg>
                </div>
                <div class="mt-2 text-md">
                  <span class="font-semibold">Interpretation: </span>Good sampling adequacy
                </div>
              </div>
              <div class="grid grid-cols-5 gap-1 mt-3">
                <div class="text-center text-xs p-1">0.00</div>
                <div class="text-center text-xs p-1">0.25</div>
                <div class="text-center text-xs p-1">0.50</div>
                <div class="text-center text-xs p-1">0.75</div>
                <div class="text-center text-xs p-1">1.00</div>
              </div>
              <div class="h-3 bg-gray-200 rounded-full w-full relative">
                <div class="h-3 bg-gradient-to-r from-red-400 via-yellow-300 to-green-500 rounded-full" style="width: 70.3%">
                  <div class="absolute -bottom-4 left-[70.3%] transform -translate-x-1/2">
                    <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-1 mt-4 text-xs text-center">
                <div class="p-1 bg-red-100 rounded">Poor<br>&lt;0.5</div>
                <div class="p-1 bg-yellow-100 rounded">Acceptable<br>0.5-0.7</div>
                <div class="p-1 bg-green-100 rounded">Good<br>&gt;0.7</div>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📐 3. Factor Determination</summary>
        <div class="content-box">
          <div class="flex flex-col md:flex-row gap-6">
            <div class="flex-1">
              <h4 class="font-semibold mb-3">Eigenvalues (Kaiser Criterion)</h4>
              <table class="w-full">
                <thead>
                  <tr>
                    <th>Factor</th>
                    <th>Eigenvalue</th>
                    <th>Retained</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="interactive-cell">
                    <td>1</td>
                    <td class="bold-value">3.298</td>
                    <td><span class="text-green-500 font-bold">✓</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>2</td>
                    <td class="bold-value">1.214</td>
                    <td><span class="text-green-500 font-bold">✓</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>3</td>
                    <td class="bold-value">1.196</td>
                    <td><span class="text-green-500 font-bold">✓</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>4–9</td>
                    <td>&lt; 1</td>
                    <td><span class="text-red-500">✗</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="flex-1">
              <h4 class="font-semibold mb-3">Scree Plot</h4>
              <div class="chart-container">
                <div class="chart-container" style="position: relative; height: 300px; width: 100%; margin: 1rem 0;">
                <canvas id="screePlot"></canvas>
            </div>
              </div>
              <div class="mt-2 text-sm text-gray-600">
                <p>Scree plot shows an elbow at factor 4, confirming 3-factor retention.</p>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📊 4. Factor Loadings</summary>
        <div class="content-box">
          <div class="tabs">
            <div class="tab active" data-tab="table">Loadings Table</div>
            <div class="tab" data-tab="heatmap">Heatmap View</div>
            <div class="tab" data-tab="grouped">Grouped Factors</div>
          </div>
          
          <div class="tab-content active" id="table">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr>
                    <th>Variable</th>
                    <th>Factor 1</th>
                    <th>Factor 2</th>
                    <th>Factor 3</th>
                    <th>Main Loading</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="interactive-cell">
                    <td>climate</td>
                    <td>0.287</td>
                    <td>0.076</td>
                    <td class="font-bold text-blue-600">0.841</td>
                    <td><span class="badge badge-info">Factor 3</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>housing</td>
                    <td class="font-bold text-indigo-600">0.698</td>
                    <td>0.153</td>
                    <td>0.084</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>health</td>
                    <td class="font-bold text-indigo-600">0.744</td>
                    <td>-0.410</td>
                    <td>-0.020</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>crime</td>
                    <td>0.471</td>
                    <td class="font-bold text-pink-600">0.522</td>
                    <td>0.135</td>
                    <td><span class="badge badge-warning">Factor 2</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>trans</td>
                    <td class="font-bold text-indigo-600">0.681</td>
                    <td>-0.156</td>
                    <td>-0.148</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>educate</td>
                    <td>0.498</td>
                    <td class="font-bold text-pink-600">-0.498</td>
                    <td>-0.253</td>
                    <td><span class="badge badge-warning">Factor 2</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>arts</td>
                    <td class="font-bold text-indigo-600">0.860</td>
                    <td>-0.115</td>
                    <td>0.012</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>recreate</td>
                    <td class="font-bold text-indigo-600">0.642</td>
                    <td>0.322</td>
                    <td>0.044</td>
                    <td><span class="badge">Factor 1</span></td>
                  </tr>
                  <tr class="interactive-cell">
                    <td>econ</td>
                    <td>0.298</td>
                    <td class="font-bold text-pink-600">0.595</td>
                    <td>-0.533</td>
                    <td><span class="badge badge-warning">Factor 2</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="tab-content" id="heatmap">
            <div class="chart-container bg-white rounded-lg shadow-sm p-4" style="height: 500px;">
              <canvas id="heatmapChart" style="width: 100%; height: 100%;"></canvas>
            </div>
          </div>
          
          <div class="tab-content" id="grouped">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="p-4 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                <h4 class="font-bold mb-2 text-indigo-700">Factor 1: Quality of Life/Amenities</h4>
                <ul class="list-disc pl-5">
                  <li>housing <span class="text-sm text-gray-600">(0.698)</span></li>
                  <li>health <span class="text-sm text-gray-600">(0.744)</span></li>
                  <li>trans <span class="text-sm text-gray-600">(0.681)</span></li>
                  <li>arts <span class="text-sm text-gray-600">(0.860)</span></li>
                  <li>recreate <span class="text-sm text-gray-600">(0.642)</span></li>
                </ul>
              </div>
              
              <div class="p-4 bg-pink-50 rounded-lg border-l-4 border-pink-500">
                <h4 class="font-bold mb-2 text-pink-700">Factor 2: Socioeconomic</h4>
                <ul class="list-disc pl-5">
                  <li>crime <span class="text-sm text-gray-600">(0.522)</span></li>
                  <li>educate <span class="text-sm text-gray-600">(-0.498)</span></li>
                  <li>econ <span class="text-sm text-gray-600">(0.595)</span></li>
                </ul>
              </div>
              
              <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                <h4 class="font-bold mb-2 text-blue-700">Factor 3: Climate</h4>
                <ul class="list-disc pl-5">
                  <li>climate <span class="text-sm text-gray-600">(0.841)</span></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📈 5. Communalities</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h4 class="font-semibold mb-4 text-lg text-gray-700 dark:text-gray-200">Communalities Distribution</h4>
              <div class="chart-container relative rounded-lg overflow-hidden bg-white dark:bg-gray-800 shadow-sm" style="height: 380px;">
                <div class="chart-container" style="position: relative; height: 400px; width: 100%; margin: 1rem 0;">
                <canvas id="communalitiesChart"></canvas>
            </div>
                <div class="absolute top-2 right-2 flex space-x-2">
                  <button class="chart-action bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-700 p-1 rounded text-gray-500 dark:text-gray-400 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <button class="chart-action bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-700 p-1.5 rounded-full text-blue-600 dark:text-blue-400 shadow-sm transition-all" data-action="sort" title="Sort values">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
                    </svg>
                  </button>
                </div>
              </div>

              
            </div>
            
            <div>
              <h4 class="font-semibold mb-4 text-lg text-gray-700 dark:text-gray-200">Communality Values</h4>
              <div class="overflow-auto rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm" style="max-height: 400px;">
                <table class="w-full bg-white dark:bg-gray-800">
                  <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                      <th class="py-3 px-4 text-left font-medium text-gray-700 dark:text-gray-300">Variable</th>
                      <th class="py-3 px-4 text-left font-medium text-gray-700 dark:text-gray-300">Communality</th>
                      <th class="py-3 px-4 text-left font-medium text-gray-700 dark:text-gray-300">Interpretation</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">climate</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-emerald-500" style="width: 79.5%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.795</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">Excellent</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">housing</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-indigo-500" style="width: 51.8%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.518</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">Good</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">health</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-teal-500" style="width: 72.2%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.722</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">Excellent</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">crime</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-orange-500" style="width: 51.2%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.512</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">Good</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">trans</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-blue-500" style="width: 51.0%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.510</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">Good</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">educate</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-pink-500" style="width: 56.1%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.561</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">Good</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">arts</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-emerald-500" style="width: 75.4%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.754</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">Excellent</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">recreate</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-violet-500" style="width: 51.7%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.517</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">Good</span></td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700">
                      <td class="py-3 px-4">econ</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-green-500" style="width: 72.8%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.728</span>
                        </div>
                      </td>
                      <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">Excellent</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="mt-6 grid grid-cols-3 gap-4">
            <div class="p-4 bg-blue-50 dark:bg-blue-900/10 rounded-lg border-l-4 border-blue-500">
              <p class="text-gray-700 dark:text-gray-300 font-medium">Most communalities > 0.5, indicating good factor explanation of variable variance.</p>
            </div>
            <div class="p-4 bg-green-50 dark:bg-green-900/10 rounded-lg border-l-4 border-green-500">
              <div class="font-semibold text-green-700 dark:text-green-400">Excellent</div>
              <div class="text-sm text-gray-600 dark:text-gray-300">Values > 0.7</div>
            </div>
            <div class="p-4 bg-blue-50 dark:bg-blue-900/10 rounded-lg border-l-4 border-blue-500">
              <div class="font-semibold text-blue-700 dark:text-blue-400">Good</div>
              <div class="text-sm text-gray-600 dark:text-gray-300">Values > 0.5</div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📉 6. Variance Explained</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h4 class="font-semibold mb-4 text-lg text-gray-700 dark:text-gray-200">Variance Distribution</h4>
              <div class="chart-container relative rounded-lg overflow-hidden bg-white dark:bg-gray-800 shadow-sm" style="height: 380px;">
                <div class="chart-container" style="position: relative; height: 400px; width: 100%; margin: 1rem 0;">
                <canvas id="varianceExplainedChart"></canvas>
            </div>
              </div>
            </div>
            
            <div>
              <h4 class="font-semibold mb-4 text-lg text-gray-700 dark:text-gray-200">Variance Detail</h4>
              <div class="overflow-auto rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm" style="max-height: 380px;">
                <table class="w-full bg-white dark:bg-gray-800">
                  <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                      <th class="py-3 px-4 text-left font-medium text-gray-700 dark:text-gray-300">Factor</th>
                      <th class="py-3 px-4 text-left font-medium text-gray-700 dark:text-gray-300">Variance</th>
                      <th class="py-3 px-4 text-left font-medium text-gray-700 dark:text-gray-300">Proportional Var</th>
                      <th class="py-3 px-4 text-left font-medium text-gray-700 dark:text-gray-300">Cumulative Var</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-t border-gray-200 dark:border-gray-700 hover:bg-blue-50 dark:hover:bg-blue-900/10 transition-colors duration-150 variance-row" data-index="0">
                      <td class="py-3 px-4 font-medium">Factor 1</td>
                      <td class="py-3 px-4 text-right">3.298</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-indigo-500 variance-progress-bar" style="width: 36.64%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.3664</span>
                        </div>
                      </td>
                      <td class="py-3 px-4 text-right font-medium">0.3664</td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700 hover:bg-pink-50 dark:hover:bg-pink-900/10 transition-colors duration-150 variance-row" data-index="1">
                      <td class="py-3 px-4 font-medium">Factor 2</td>
                      <td class="py-3 px-4 text-right">1.214</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-pink-500 variance-progress-bar" style="width: 13.48%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.1348</span>
                        </div>
                      </td>
                      <td class="py-3 px-4 text-right font-medium">0.5012</td>
                    </tr>
                    <tr class="border-t border-gray-200 dark:border-gray-700 hover:bg-cyan-50 dark:hover:bg-cyan-900/10 transition-colors duration-150 variance-row" data-index="2">
                      <td class="py-3 px-4 font-medium">Factor 3</td>
                      <td class="py-3 px-4 text-right">1.106</td>
                      <td class="py-3 px-4">
                        <div class="flex items-center">
                          <div class="progress-wrapper mr-3 flex-grow bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="h-full rounded-full bg-cyan-500 variance-progress-bar" style="width: 12.28%"></div>
                          </div>
                          <span class="text-sm font-medium text-right w-12">0.1228</span>
                        </div>
                      </td>
                      <td class="py-3 px-4 text-right font-medium">0.6240</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <div class="mt-6 p-5 rounded-xl bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 border border-blue-100 dark:border-blue-900/30 shadow-sm">
                <h4 class="font-bold text-gray-800 dark:text-gray-200">Total Variance Explained: <span class="text-2xl text-indigo-600 dark:text-indigo-400">62.4%</span></h4>
                <div class="mt-3">
                  <div class="h-6 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-blue-500" style="width: 62.4%"></div>
                  </div>
                  <div class="flex justify-between text-xs mt-2 text-gray-600 dark:text-gray-400">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">🔧 7. Practical Implications</summary>
        <div class="content-box">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-5 bg-gradient-to-br from-indigo-50 to-blue-50 rounded-lg">
              <div class="flex items-center">
                <div class="p-3 bg-indigo-100 rounded-full mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 012-2z" />
                  </svg>
                </div>
                <h4 class="text-lg font-bold">Statistical Usage</h4>
              </div>
              <p class="mt-3 text-gray-700">Use factor scores for clustering or regression analysis to reduce dimensionality while retaining information.</p>
            </div>
            
            <div class="p-5 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg">
              <div class="flex items-center">
                <div class="p-3 bg-green-100 rounded-full mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
                  </svg>
                </div>
                <h4 class="text-lg font-bold">Factor Names</h4>
              </div>
              <ul class="mt-3 space-y-2 text-gray-700">
                <li><span class="font-medium text-indigo-600">Factor 1:</span> Quality of Life/Amenities</li>
                <li><span class="font-medium text-pink-600">Factor 2:</span> Socioeconomic/Development</li>
                <li><span class="font-medium text-blue-600">Factor 3:</span> Climate</li>
              </ul>
            </div>
            
            <div class="p-5 bg-gradient-to-br from-amber-50 to-yellow-50 rounded-lg">
              <div class="flex items-center">
                <div class="p-3 bg-yellow-100 rounded-full mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                </div>
                <h4 class="text-lg font-bold">Further Steps</h4>
              </div>
              <p class="mt-3 text-gray-700">Consider factor rotation for clearer interpretation and refined factor structure for better theoretical alignment.</p>
            </div>
          </div>
        </div>
      </details>
      
      <details>
        <summary class="section-title">📋 8. Summary Table</summary>
        <div class="content-box">
          <table class="w-full">
            <thead>
              <tr>
                <th>Step</th>
                <th>Result/Interpretation</th>
              </tr>
            </thead>
            <tbody>
              <tr class="interactive-cell">
                <td>Data Suitability</td>
                <td><span class="font-medium">Bartlett's p < 0.05</span>, <span class="font-medium">KMO = 0.703</span> (Good)</td>
              </tr>
              <tr class="interactive-cell">
                <td>Factors Retained</td>
                <td>3 (Eigenvalues > 1, Scree plot elbow)</td>
              </tr>
              <tr class="interactive-cell">
                <td>Main Factor Themes</td>
                <td>
                  <span class="badge">1: Quality of Life</span>
                  <span class="badge badge-warning">2: Socioeconomic</span>
                  <span class="badge badge-info">3: Climate</span>
                </td>
              </tr>
              <tr class="interactive-cell">
                <td>Variance Explained</td>
                <td>
                  <div class="flex items-center">
                    <span class="mr-2">62.4% (by 3 factors)</span>
                    <div class="progress-wrapper w-32">
                      <div class="progress-bar bg-gradient-to-r from-indigo-500 to-purple-500" style="width: 62.4%"></div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr class="interactive-cell">
                <td>Communalities</td>
                <td>Most > 0.5 (factors explain most variable variance)</td>
              </tr>
            </tbody>
          </table>
        </div>
      </details>
    </div>
  </div>

  <div id="particles-js" class="fixed inset-0 pointer-events-none"></div>

  <script>
    // Register the datalabels plugin
    Chart.register(ChartDataLabels);
    
    // Initialize tabs with smooth transitions
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Add a subtle pulse effect when clicking tabs
        tab.classList.add('pulse-effect');
        setTimeout(() => tab.classList.remove('pulse-effect'), 300);
        
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => {
          c.classList.remove('active');
          c.style.opacity = '0';
        });
        
        tab.classList.add('active');
        const activeContent = document.getElementById(tab.dataset.tab);
        activeContent.classList.add('active');
        
        // Fade in the selected tab content
        setTimeout(() => {
          activeContent.style.opacity = '1';
        }, 10);
      });
    });

    // Initialize Charts
    // Initialize Dark Mode - toggle removed
    function initTheme() {
      // Always use light mode since dark mode toggle was removed
      document.documentElement.classList.remove('dark-mode');
      localStorage.setItem('darkMode', 'false');
    }
    
    // Export functionality (using direct handler now)
    function initExport() {
      // Handled by onclick="handleExport()" now
      console.log("Export initialization skipped - using direct handler");
    }
    
    // Share functionality (using direct handler now)
    function initShare() {
      // Handled by onclick="handleShare()" now
      console.log("Share initialization skipped - using direct handler");
    }
    
    // Interactive elements
    function initInteractions() {
      const interactiveCells = document.querySelectorAll('.interactive-cell');
      interactiveCells.forEach((cell, index) => {
        cell.addEventListener('click', function() {
          this.classList.add('pulse-effect');
          setTimeout(() => this.classList.remove('pulse-effect'), 300);
          
          // Add info tooltip when clicked
          const toast = document.createElement('div');
          toast.className = 'fixed bottom-4 left-4 bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
          toast.innerHTML = `<i class="fas fa-info-circle mr-2"></i> Click to copy the value to clipboard`;
          document.body.appendChild(toast);
          
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 2000);
          
          // Copy the cell content
          const content = this.innerText.trim();
          navigator.clipboard.writeText(content).catch(() => {});
        });
        
        // Add reveal animation
        setTimeout(() => {
          cell.style.opacity = '1';
          cell.style.transform = 'translateY(0)';
        }, 70 * index);
      });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize tab switching for Factor Loadings section
      const tabs = document.querySelectorAll('.tabs .tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs and contents
          tabs.forEach(t => t.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          // Add active class to clicked tab
          tab.classList.add('active');
          
          // Show corresponding content
          const tabId = tab.getAttribute('data-tab');
          const content = document.getElementById(tabId);
          if (content) {
            content.classList.add('active');
            
            // Initialize heatmap if heatmap tab is selected
            if (tabId === 'heatmap') {
              const canvas = document.getElementById('heatmapChart');
              if (canvas) {
                const container = canvas.parentElement;
                canvas.width = container.offsetWidth;
                canvas.height = container.offsetHeight;
                drawHeatmap();
              }
            }
          }
        });
      });

      // Add window resize handler for heatmap
      window.addEventListener('resize', () => {
        const heatmapTab = document.querySelector('.tab[data-tab="heatmap"]');
        if (heatmapTab && heatmapTab.classList.contains('active')) {
          const canvas = document.getElementById('heatmapChart');
          if (canvas) {
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            drawHeatmap();
          }
        }
      });

      initSocialLinks();
      initTheme();
      initExport();
      initShare();
      initInteractions();

      // Initialize heatmap if it's the active tab
      const activeTab = document.querySelector('.tabs .tab.active');
      if (activeTab && activeTab.getAttribute('data-tab') === 'heatmap') {
        const canvas = document.getElementById('heatmapChart');
        if (canvas) {
          canvas.width = canvas.parentElement.offsetWidth;
          canvas.height = 400;
          drawHeatmap();
        }
      }

      // Add window resize handler for heatmap
      window.addEventListener('resize', () => {
        const heatmapTab = document.querySelector('.tab[data-tab="heatmap"]');
        if (heatmapTab && heatmapTab.classList.contains('active')) {
          const canvas = document.getElementById('heatmapChart');
          if (canvas) {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = 400;
            drawHeatmap();
          }
        }
      });      // Variance Explained Pie Chart
      const varianceCtx = document.getElementById('varianceChart').getContext('2d');
      const varianceChart = new Chart(varianceCtx, {
        type: 'doughnut',
        data: {
          labels: ['Factor 1', 'Factor 2', 'Factor 3', 'Unexplained'],
          datasets: [{
            data: [36.64, 13.48, 12.28, 37.6],
            backgroundColor: [
              'rgba(67, 97, 238, 0.7)',
              'rgba(247, 37, 133, 0.7)',
              'rgba(76, 201, 240, 0.7)',
              'rgba(200, 200, 200, 0.5)'
            ],
            borderColor: [
              'rgba(67, 97, 238, 1)',
              'rgba(247, 37, 133, 1)',
              'rgba(76, 201, 240, 1)',
              'rgba(200, 200, 200, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: {
            animateRotate: true,
            animateScale: true,
            duration: 2000,
            easing: 'easeOutQuart'
          },
          plugins: {
            datalabels: {
              display: false  // Disable data labels for this chart
            },
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleFont: {
                size: 14,
                weight: 'bold'
              },
              bodyFont: {
                size: 13
              },
              padding: 12,
              cornerRadius: 6,
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += context.raw + '%';
                  return label;
                }
              }
            }
          }
        }
      });
      
      // Initialize charts when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize Scree Plot
        const screeCtx = document.getElementById('screePlot');
        if (screeCtx) {
          const screePlot = new Chart(screeCtx.getContext('2d'), {
            type: 'line',
            data: {
              labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
              datasets: [{
                label: 'Eigenvalues',
                data: [3.298, 1.214, 1.196, 0.85, 0.75, 0.65, 0.45, 0.32, 0.28],
                borderColor: 'rgba(67, 97, 238, 1)',
                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                pointBackgroundColor: 'rgba(67, 97, 238, 1)',
                pointBorderColor: 'rgba(255, 255, 255, 1)',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8,
                fill: true,
                tension: 0.3
              }, {
                label: 'Kaiser Criterion (Eigenvalue=1)',
                data: [1, 1, 1, 1, 1, 1, 1, 1, 1],
                borderColor: 'rgba(255, 99, 132, 1)',
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                annotation: {
                  annotations: {
                    elbow: {
                      type: 'point',
                      xValue: 3,
                      yValue: 0.85,
                      backgroundColor: 'rgba(255, 99, 132, 0.2)',
                      borderColor: 'rgba(255, 99, 132, 1)',
                      borderWidth: 2,
                      radius: 8,
                      label: {
                        content: 'Elbow Point',
                        enabled: true,
                        position: 'top'
                      }
                    }
                  }
                }
              }
            }
          });
        }

        // Initialize Communalities Chart
        const communalitiesCtx = document.getElementById('communalitiesChart');
        if (communalitiesCtx) {
          const communalitiesChart = new Chart(communalitiesCtx.getContext('2d'), {
            type: 'bar',
            data: {
              labels: ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'],
              datasets: [{
                label: 'Communality',
                data: [0.795, 0.518, 0.722, 0.512, 0.510, 0.561, 0.754, 0.517, 0.728],
                backgroundColor: [
                  '#10b981', '#6366f1', '#14b8a6', '#f97316', '#3b82f6', 
                  '#ec4899', '#10b981', '#8b5cf6', '#22c55e'
                ],
                borderWidth: 0,
                borderRadius: 4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                datalabels: {
                  color: '#fff',
                  font: {
                    weight: 'bold'
                  },
                  formatter: (value) => value.toFixed(3)
                }
              }
            }
          });
        }

        // Initialize Variance Distribution Chart
        const varianceCtx = document.getElementById('varianceExplainedChart');
        if (varianceCtx) {
          const varianceChart = new Chart(varianceCtx.getContext('2d'), {
            type: 'bar',
            data: {
              labels: ['Factor 1', 'Factor 2', 'Factor 3'],
              datasets: [{
                label: 'Variance Explained',
                data: [36.64, 13.48, 12.28],
                backgroundColor: [
                  'rgba(99, 102, 241, 0.85)',  // Indigo
                  'rgba(236, 72, 153, 0.85)',  // Pink
                  'rgba(45, 212, 191, 0.85)'   // Teal
                ],
                borderWidth: 2,
                borderColor: [
                  'rgba(99, 102, 241, 1)',
                  'rgba(236, 72, 153, 1)',
                  'rgba(45, 212, 191, 1)'
                ],
                borderRadius: 6,
                hoverBackgroundColor: [
                  'rgba(99, 102, 241, 1)',
                  'rgba(236, 72, 153, 1)',
                  'rgba(45, 212, 191, 1)'
                ],
                hoverBorderWidth: 3,
                barPercentage: 0.8
              }, {
                type: 'line',
                label: 'Cumulative Variance',
                data: [36.64, 50.12, 62.40],
                borderColor: 'rgba(14, 165, 233, 1)',
                backgroundColor: 'rgba(14, 165, 233, 0.1)',
                pointBackgroundColor: 'rgba(14, 165, 233, 1)',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8,
                pointHoverBackgroundColor: 'rgba(14, 165, 233, 1)',
                pointHoverBorderColor: '#ffffff',
                pointHoverBorderWidth: 3,
                fill: true,
                tension: 0.2
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              animation: {
                duration: 2000,
                easing: 'easeInOutQuart'
              },
              interaction: {
                mode: 'index',
                intersect: false
              },
              plugins: {
                datalabels: {
                  color: function(context) {
                    return context.datasetIndex === 0 ? '#ffffff' : '#000000';
                  },
                  font: {
                    weight: 'bold',
                    size: 12
                  },
                  formatter: (value, context) => {
                    return value.toFixed(1) + '%';
                  },
                  align: function(context) {
                    return context.datasetIndex === 0 ? 'center' : 'top';
                  },
                  offset: function(context) {
                    return context.datasetIndex === 0 ? 0 : 8;
                  },
                  textStrokeColor: 'rgba(0, 0, 0, 0.3)',
                  textStrokeWidth: 2,
                  textShadowBlur: 3,
                  textShadowColor: 'rgba(0, 0, 0, 0.3)'
                },
                legend: {
                  position: 'top',
                  align: 'center',
                  labels: {
                    usePointStyle: true,
                    padding: 20,
                    font: {
                      size: 12,
                      weight: 'bold'
                    },
                    generateLabels: function(chart) {
                      const datasets = chart.data.datasets;
                      return datasets.map((dataset, i) => ({
                        text: dataset.label,
                        fillStyle: i === 0 ? dataset.backgroundColor[0] : dataset.borderColor,
                        strokeStyle: i === 0 ? dataset.borderColor[0] : dataset.borderColor,
                        lineWidth: 2,
                        hidden: !chart.isDatasetVisible(i),
                        index: i
                      }));
                    }
                  }
                },
                tooltip: {
                  enabled: true,
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  titleFont: {
                    size: 13,
                    weight: 'bold'
                  },
                  bodyFont: {
                    size: 12
                  },
                  padding: 12,
                  cornerRadius: 6,
                  displayColors: true,
                  callbacks: {
                    label: function(context) {
                      const label = context.dataset.label || '';
                      const value = context.parsed.y;
                      return `${label}: ${value.toFixed(1)}%`;
                    }
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 40,
                  title: {
                    display: true,
                    text: 'Variance Explained (%)',
                    font: {
                      size: 12,
                      weight: 'bold'
                    },
                    padding: {top: 10, bottom: 10}
                  },
                  ticks: {
                    font: {
                      size: 11
                    },
                    stepSize: 5
                  },
                  grid: {
                    color: 'rgba(0, 0, 0, 0.1)',
                    drawBorder: false,
                    lineWidth: 0.5
                  }
                },
                y1: {
                  position: 'right',
                  beginAtZero: true,
                  max: 100,
                  title: {
                    display: true,
                    text: 'Cumulative Variance (%)',
                    font: {
                      size: 12,
                      weight: 'bold'
                    },
                    padding: {top: 10, bottom: 10}
                  },
                  ticks: {
                    font: {
                      size: 11
                    },
                    stepSize: 10
                  },
                  grid: {
                    display: false
                  }
                },
                x: {
                  grid: {
                    display: false,
                    drawBorder: false
                  },
                  ticks: {
                    font: {
                      size: 11
                    }
                  }
                }
              }
            }
          });
        }
      });
        // Scree Plot with animation and interaction
      const screeCtx = document.getElementById('screePlot').getContext('2d');
      const screePlot = new Chart(screeCtx, {
        type: 'line',
        data: {
          labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
          datasets: [{
            label: 'Eigenvalues',
            data: [3.298, 1.214, 1.196, 0.85, 0.75, 0.65, 0.45, 0.32, 0.28],
            borderColor: 'rgba(67, 97, 238, 1)',
            backgroundColor: 'rgba(67, 97, 238, 0.1)',
            pointBackgroundColor: 'rgba(67, 97, 238, 1)',
            pointBorderColor: 'rgba(255, 255, 255, 1)',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8,
            fill: true,
            tension: 0.3
          }, {
            label: 'Kaiser Criterion (Eigenvalue=1)',
            data: [1, 1, 1, 1, 1, 1, 1, 1, 1],
            borderColor: 'rgba(255, 99, 132, 1)',
            borderDash: [5, 5],
            pointRadius: 0,
            fill: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: {
            duration: 2000,
            easing: 'easeOutQuart'
          },
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            datalabels: {
              display: false  // Disable data labels for scree plot
            },
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 15,
                boxWidth: 10
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleFont: { weight: 'bold' },
              bodyFont: { size: 13 },
              padding: 10,
              cornerRadius: 6,
              displayColors: false,
              callbacks: {
                afterLabel: function(context) {
                  if (context.datasetIndex === 0) {
                    const factorNum = parseInt(context.label);
                    if (factorNum <= 3) {
                      return '✓ Factor retained (Eigenvalue > 1)';
                    } else {
                      return '✗ Factor not retained (Eigenvalue < 1)';
                    }
                  }
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Eigenvalue',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              grid: {
                color: 'rgba(200, 200, 200, 0.2)'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Factor Number',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      // Add elbow point annotation
      const annotationPlugin = {
        id: 'elbowAnnotation',
        afterDraw(chart) {
          const ctx = chart.ctx;
          const xAxis = chart.scales.x;
          const yAxis = chart.scales.y;
          
          // Draw elbow annotation
          const elbowX = xAxis.getPixelForValue('4');
          const elbowY = yAxis.getPixelForValue(0.85);
          
          ctx.save();
          ctx.beginPath();
          ctx.arc(elbowX, elbowY, 8, 0, Math.PI * 2);
          ctx.fillStyle = 'rgba(255, 99, 132, 0.2)';
          ctx.fill();
          ctx.strokeStyle = 'rgba(255, 99, 132, 1)';
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.closePath();
          
          ctx.font = '12px Arial';
          ctx.fillStyle = 'rgba(255, 99, 132, 1)';
          ctx.textAlign = 'center';
          ctx.fillText('Elbow Point', elbowX, elbowY - 15);
          ctx.restore();
        }
      };
      
      // Register and add the annotation plugin
      screePlot.options.plugins.annotation = annotationPlugin;
      screePlot.update();
        // Enhanced Communalities Chart
      const communalitiesCtx = document.getElementById('communalitiesChart').getContext('2d');
      const communalitiesChart = new Chart(communalitiesCtx, {
        type: 'bar',
        data: {
          labels: ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'],
          datasets: [{
            label: 'Communality',
            data: [0.795, 0.518, 0.722, 0.512, 0.510, 0.561, 0.754, 0.517, 0.728],
            backgroundColor: [
              '#10b981', // emerald for climate
              '#6366f1', // indigo for housing
              '#14b8a6', // teal for health
              '#f97316', // orange for crime
              '#3b82f6', // blue for trans
              '#ec4899', // pink for educate
              '#10b981', // emerald for arts
              '#8b5cf6', // violet for recreate
              '#22c55e'  // green for econ
            ],
            borderWidth: 0,
            borderRadius: 4,
            datalabels: {
              color: function(context) {
                const value = context.dataset.data[context.dataIndex];
                return value > 0.6 ? '#10b981' : '#6366f1';  // Use colors matching the bars
              },
              backgroundColor: 'rgba(255, 255, 255, 0.7)',
              borderRadius: 4,
              padding: {
                top: 2,
                bottom: 2,
                left: 6, 
                right: 6
              },
              font: {
                weight: 'bold',
                size: 12
              },
              formatter: function(value) {
                return value.toFixed(3);
              },
              anchor: 'end',
              align: 'top',
              offset: 4
            }
          }, {
            type: 'line',
            label: 'Threshold (0.5)',
            data: [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5],
            borderColor: '#f43f5e',
            borderDash: [6, 4],
            borderWidth: 2,
            pointRadius: 0,
            fill: false,
            datalabels: {
              display: false
            }
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              align: 'end',
              labels: {
                boxWidth: 15,
                padding: 15,
                usePointStyle: true
              }
            },
            tooltip: {
              backgroundColor: 'rgba(249, 250, 251, 0.95)',
              titleColor: '#111827',
              bodyColor: '#374151',
              borderColor: '#e5e7eb',
              borderWidth: 1,
              cornerRadius: 8,
              padding: 12,
              boxPadding: 6,
              usePointStyle: true,
              callbacks: {
                title: function(tooltipItems) {
                  return tooltipItems[0].label + ': ' + tooltipItems[0].formattedValue;
                },
                label: function(context) {
                  const value = context.raw;
                  let interpretation = value > 0.7 ? 'Excellent' : 'Good';
                  return 'Interpretation: ' + interpretation;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 1.2,
              ticks: {
                stepSize: 0.1,
                padding: 10
              },
              title: {
                display: true,
                text: 'Communality Value',
                padding: {
                  bottom: 10
                },
                font: {
                  size: 13,
                  weight: '500'
                }
              },
              grid: {
                color: 'rgba(226, 232, 240, 0.6)',
                drawBorder: false
              }
            },
            x: {
              ticks: {
                padding: 8
              },
              grid: {
                display: false,
                drawBorder: false
              }
            }
          },
          animation: {
            duration: 1000
          }
        }
      });
      
      // Add click interactivity to communalities chart
      document.getElementById('communalitiesChart').addEventListener('click', function(event) {
        const points = communalitiesChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
        if (points.length) {
          const dataIndex = points[0].index;
          const variableName = communalitiesChart.data.labels[dataIndex];
          const value = communalitiesChart.data.datasets[0].data[dataIndex];
          
          // Show detailed info in a toast
          const toast = document.createElement('div');
          toast.className = 'fixed top-20 right-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg z-50';
          toast.style.maxWidth = '300px';
          
          let interpretationClass, interpretationText;
          if (value > 0.7) {
            interpretationClass = 'text-green-600 dark:text-green-400';
            interpretationText = 'Excellent';
          } else if (value > 0.5) {
            interpretationClass = 'text-blue-600 dark:text-blue-400';
            interpretationText = 'Good';
          } else if (value > 0.3) {
            interpretationClass = 'text-yellow-600 dark:text-yellow-400';
            interpretationText = 'Fair';
          } else {
            interpretationClass = 'text-red-600 dark:text-red-400';
            interpretationText = 'Poor';
          }
          
          toast.innerHTML = `
            <div class="flex justify-between items-start">
              <div class="font-bold text-lg">${variableName}</div>
              <button class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="mt-2">
              <div class="font-medium">Communality Value: <span class="font-bold">${value.toFixed(3)}</span></div>
              <div class="font-medium mt-1">Interpretation: <span class="${interpretationClass} font-bold">${interpretationText}</span></div>
              <div class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                This indicates how much of the variable's variance is explained by the extracted factors.
              </div>
            </div>
          `;
          
          document.body.appendChild(toast);
          
          toast.querySelector('button').addEventListener('click', function() {
            document.body.removeChild(toast);
          });
          
          setTimeout(() => {
            if (document.body.contains(toast)) {
              document.body.removeChild(toast);
            }
          }, 5000);
        }
      });
        // Enhanced Variance Explained Chart
      const varianceExplainedCtx = document.getElementById('varianceExplainedChart').getContext('2d');
      const varianceExplainedChart = new Chart(varianceExplainedCtx, {
        type: 'bar',
        data: {
          labels: ['Factor 1', 'Factor 2', 'Factor 3'],
          datasets: [{
            label: 'Variance Explained',
            data: [36.64, 13.48, 12.28],
            backgroundColor: [
                  'rgba(82, 121, 255, 0.6)',  // Lighter blue
                  'rgba(255, 99, 164, 0.6)',  // Lighter pink
                  'rgba(77, 201, 246, 0.6)'   // Lighter cyan
                ],
                borderWidth: 0,
                borderRadius: 0,
                barPercentage: 0.8
          }, {
            type: 'line',
            label: 'Cumulative Variance',
            data: [36.64, 50.12, 62.40],
                borderColor: 'rgb(32, 201, 151)',  // Turquoise
                backgroundColor: 'rgba(32, 201, 151, 0)',
                pointBackgroundColor: 'rgb(32, 201, 151)',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
                pointRadius: 7,
                pointHoverRadius: 9,
                borderWidth: 3,
            fill: false,
            tension: 0.1,
            yAxisID: 'y1'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            datalabels: {
                color: '#000000',
                display: function(context) {
                  return context.datasetIndex === 1; // Only show for line chart
                },
                align: 'top',
                offset: 5,
                font: {
                  weight: 'bold',
                  size: 11
                },
                formatter: (value) => value.toFixed(1) + '%'
            },
            legend: {
              position: 'top',
              align: 'start',
              labels: {
                boxWidth: 15,
                padding: 15,
                usePointStyle: true,
                font: {
                  size: 12
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Variance Explained (%)',
                font: {
                  size: 13,
                  weight: '500'
                },
                padding: {
                  bottom: 10
                }
              },
              max: 42,
              grid: {
                color: 'rgba(226, 232, 240, 0.6)',
                drawBorder: false
              },
              ticks: {
                stepSize: 5,
                padding: 10
              }
            },            y1: {
              beginAtZero: true,
              position: 'right',
              title: {
                display: true,
                text: 'Cumulative Variance (%)',
                font: {
                  size: 13,
                  weight: '500'
                },
                padding: {
                  bottom: 10
                }
              },
              max: 100,
              ticks: {
                stepSize: 10,
                padding: 10,
                callback: function(value) {
                  return value + '%';
                }
              },
              grid: {
                drawOnChartArea: false,
                color: 'rgba(226, 232, 240, 0.4)',
                drawBorder: false
              }
            }
          },
          animation: {
            delay: (context) => context.dataIndex * 200,
            duration: 1200,
            easing: 'easeOutQuad'
          },
          layout: {
            padding: {
              top: 10,
              right: 25,
              bottom: 10,
              left: 10
            }
          },
          plugins: {
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleFont: { weight: 'bold' },
              bodyFont: { size: 13 },
              padding: 12,
              cornerRadius: 6,
              callbacks: {
                afterBody: function(context) {
                  const index = context[0].dataIndex;
                  let cumulativePct;
                  if (index === 0) {
                    cumulativePct = 36.64;
                  } else if (index === 1) {
                    cumulativePct = 50.12;
                  } else {
                    cumulativePct = 62.40;
                  }
                  return [`Cumulative variance: ${cumulativePct.toFixed(2)}%`];
                }
              }
            }
          }
        }
      });
      
      // Add interactive annotations to variance explained chart
      const guideline60pct = {
        id: '60pctLine',
        afterDraw(chart) {
          const ctx = chart.ctx;
          const yAxis = chart.scales.y1;
          const xAxis = chart.scales.x;
          
          // Draw 60% guideline
          const y60 = yAxis.getPixelForValue(60);
          
          ctx.save();
          ctx.beginPath();
          ctx.moveTo(xAxis.left, y60);
          ctx.lineTo(xAxis.right, y60);
          ctx.lineWidth = 1.5;
          ctx.strokeStyle = 'rgba(220, 38, 38, 0.4)';  // Red with opacity
          ctx.setLineDash([6, 4]);
          ctx.stroke();
          
          // Create a small background for the label
          const labelText = 'Target: 60%';
          ctx.font = '12px Arial';
          const textWidth = ctx.measureText(labelText).width;
          ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
          ctx.fillRect(xAxis.right - textWidth - 14, y60 - 16, textWidth + 8, 20);
          
          // Label
          ctx.fillStyle = 'rgba(220, 38, 38, 0.8)';
          ctx.textAlign = 'right';
          ctx.font = 'bold 12px Arial';
          ctx.fillText(labelText, xAxis.right - 10, y60 - 4);
          ctx.restore();
        }
      };
      
      // Add the annotation plugin
      varianceExplainedChart.options.plugins.annotation = guideline60pct;
      varianceExplainedChart.update();
        // Enhanced Heatmap Chart for Factor Loadings with interactivity
      const heatmapCtx = document.getElementById('heatmapChart').getContext('2d');
      
      // Draw grid cells with custom colors and interactivity
      function drawHeatmap() {
        console.log('Initializing heatmap...');
        const canvas = document.getElementById('heatmapChart');
        if (!canvas) {
          console.error('Heatmap canvas element not found');
          return;
        }
        
        const ctx = canvas.getContext('2d');
        if (!ctx) {
          console.error('Could not get 2D context for heatmap canvas');
          return;
        }
        
        console.log(`Canvas dimensions: ${canvas.width}x${canvas.height}`);
        
        // Clear previous drawing
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const variables = ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'];
        const factors = ['Factor 1', 'Factor 2', 'Factor 3'];
        const values = [
          [0.287, 0.076, 0.841],
          [0.698, 0.153, 0.084],
          [0.744, -0.410, -0.020],
          [0.471, 0.522, 0.135],
          [0.681, -0.156, -0.148],
          [0.498, -0.498, -0.253],
          [0.860, -0.115, 0.012],
          [0.642, 0.322, 0.044],
          [0.298, 0.595, -0.533]
        ];
        
        // Check if heatmap should be redrawn (first time or window resize)
        if (!window.heatmapData) {
          window.heatmapData = {
            variables,
            factors,
            values,
            highlighted: null
          };
        }
        
        // Calculate grid dimensions
        const padding = 50;
        const cellWidth = (canvas.width - padding * 2) / factors.length;
        const cellHeight = (canvas.height - padding * 2) / variables.length;
        
        // Draw column headers
        ctx.font = 'bold 14px Arial';
        ctx.textAlign = 'center';
        ctx.fillStyle = '#333';
        factors.forEach((factor, i) => {
          ctx.fillText(factor, padding + cellWidth * i + cellWidth / 2, padding - 20);
        });
        
        // Draw row headers
        ctx.textAlign = 'right';
        variables.forEach((variable, i) => {
          ctx.fillText(variable, padding - 10, padding + cellHeight * i + cellHeight / 2 + 5);
        });
        
        // Draw cells
        for (let row = 0; row < variables.length; row++) {
          for (let col = 0; col < factors.length; col++) {
            const value = values[row][col];
            const x = padding + col * cellWidth;
            const y = padding + row * cellHeight;
            
            // Calculate color intensity based on value
            const intensity = Math.min(Math.abs(value), 1);
            let color;
            if (value > 0) {
              color = `rgba(67, 97, 238, ${intensity})`;
              borderColor = `rgba(67, 97, 238, 1)`;
            } else {
              color = `rgba(247, 37, 133, ${intensity})`;
              borderColor = `rgba(247, 37, 133, 1)`;
            }
            
            // Draw cell background
            ctx.fillStyle = color;
            
            // Check if this cell is highlighted
            if (window.heatmapData.highlighted === `${row}-${col}`) {
              ctx.shadowColor = '#333';
              ctx.shadowBlur = 10;
              ctx.strokeStyle = '#000';
              ctx.lineWidth = 2;
            } else {
              ctx.shadowBlur = 0;
              ctx.strokeStyle = '#ddd';
              ctx.lineWidth = 0.5;
            }
            
            ctx.fillRect(x, y, cellWidth, cellHeight);
            ctx.strokeRect(x, y, cellWidth, cellHeight);
            
            // Draw value text
            ctx.shadowBlur = 0;
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = intensity > 0.5 ? 'white' : '#333';
            ctx.fillText(value.toFixed(3), x + cellWidth / 2, y + cellHeight / 2 + 5);
          }
        }
        
        // Add event listener for interactive hover effects if not already added
        if (!window.heatmapEventAdded) {
          canvas.addEventListener('mousemove', function(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Check if mouse is in grid area
            if (x > padding && x < canvas.width - padding && y > padding && y < canvas.height - padding) {
              const col = Math.floor((x - padding) / cellWidth);
              const row = Math.floor((y - padding) / cellHeight);
              
              if (col >= 0 && col < factors.length && row >= 0 && row < variables.length) {
                const cellId = `${row}-${col}`;
                if (window.heatmapData.highlighted !== cellId) {
                  window.heatmapData.highlighted = cellId;
                  drawHeatmap();
                  
                  // Show tooltip
                  const variable = variables[row];
                  const factor = factors[col];
                  const value = values[row][col];
                  
                  const tooltip = document.createElement('div');
                  tooltip.id = 'heatmap-tooltip';
                  tooltip.className = 'fixed bg-white dark:bg-gray-800 p-3 rounded shadow-lg z-50';
                  tooltip.style.left = (event.clientX + 10) + 'px';
                  tooltip.style.top = (event.clientY - 30) + 'px';
                  
                  let strengthClass;
                  let strengthText;
                  
                  if (Math.abs(value) > 0.7) {
                    strengthClass = 'text-green-600 dark:text-green-400';
                    strengthText = 'Strong';
                  } else if (Math.abs(value) > 0.5) {
                    strengthClass = 'text-blue-600 dark:text-blue-400';
                    strengthText = 'Moderate';
                  } else if (Math.abs(value) > 0.3) {
                    strengthClass = 'text-yellow-600 dark:text-yellow-400';
                    strengthText = 'Weak';
                  } else {
                    strengthClass = 'text-gray-600 dark:text-gray-400';
                    strengthText = 'Very Weak';
                  }
                  
                  tooltip.innerHTML = `
                    <div class="font-bold">${variable} → ${factor}</div>
                    <div>Loading: <span class="font-bold">${value.toFixed(3)}</span></div>
                    <div>Strength: <span class="${strengthClass} font-bold">${strengthText}</span></div>
                  `;
                  
                  // Remove existing tooltip if any
                  const existingTooltip = document.getElementById('heatmap-tooltip');
                  if (existingTooltip) {
                    document.body.removeChild(existingTooltip);
                  }
                  
                  document.body.appendChild(tooltip);
                }
                return;
              }
            }
            
            // If we got here, we're not over a cell
            if (window.heatmapData.highlighted) {
              window.heatmapData.highlighted = null;
              drawHeatmap();
              
              // Remove tooltip
              const existingTooltip = document.getElementById('heatmap-tooltip');
              if (existingTooltip) {
                document.body.removeChild(existingTooltip);
              }
            }
          });
          
          canvas.addEventListener('mouseleave', function() {
            // Clear highlight when mouse leaves canvas
            if (window.heatmapData.highlighted) {
              window.heatmapData.highlighted = null;
              drawHeatmap();
              
              // Remove tooltip
              const existingTooltip = document.getElementById('heatmap-tooltip');
              if (existingTooltip) {
                document.body.removeChild(existingTooltip);
              }
            }
          });
          
          window.heatmapEventAdded = true;
        }
      }
      
      // Initialize and draw the heatmap
      window.addEventListener('resize', drawHeatmap);
      setTimeout(drawHeatmap, 500); // Give time for the canvas to be properly sized
      
      // Fallback to Chart.js if the custom heatmap fails
      const data = {
        labels: ['climate', 'housing', 'health', 'crime', 'trans', 'educate', 'arts', 'recreate', 'econ'],
        datasets: [
          {
            label: 'Factor 1',
            data: [0.287, 0.698, 0.744, 0.471, 0.681, 0.498, 0.860, 0.642, 0.298],
            backgroundColor: function(context) {
              const value = context.dataset.data[context.dataIndex];
              return value > 0 
                ? `rgba(67, 97, 238, ${Math.abs(value)})` 
                : `rgba(247, 37, 133, ${Math.abs(value)})`;
            },
            barPercentage: 1,
            categoryPercentage: 1
          },
          {
            label: 'Factor 2',
            data: [0.076, 0.153, -0.410, 0.522, -0.156, -0.498, -0.115, 0.322, 0.595],
            backgroundColor: function(context) {
              const value = context.dataset.data[context.dataIndex];
              return value > 0 
                ? `rgba(67, 97, 238, ${Math.abs(value)})` 
                : `rgba(247, 37, 133, ${Math.abs(value)})`;
            },
            barPercentage: 1,
            categoryPercentage: 1
          },
          {
            label: 'Factor 3',
            data: [0.841, 0.084, -0.020, 0.135, -0.148, -0.253, 0.012, 0.044, -0.533],
            backgroundColor: function(context) {
              const value = context.dataset.data[context.dataIndex];
              return value > 0 
                ? `rgba(67, 97, 238, ${Math.abs(value)})` 
                : `rgba(247, 37, 133, ${Math.abs(value)})`;
            },
            barPercentage: 1,
            categoryPercentage: 1
          }
        ]
      };
      
      new Chart(heatmapCtx, {
        type: 'bar',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += context.parsed.x.toFixed(3);
                  return label;
                }
              }
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              min: -1,
              max: 1,
              ticks: {
                callback: function(value) {
                  return value.toFixed(1);
                }
              }
            }
          }
        }
      });
        // Add animation to elements
      document.querySelectorAll('.stat-card, .interactive-cell').forEach((el, index) => {
        setTimeout(() => {
          el.style.opacity = '1';
          el.style.transform = 'translateY(0)';
        }, 100 * index);
      });
      
      // Add tooltip hover effects
      document.querySelectorAll('.tooltip').forEach(tooltip => {
        tooltip.addEventListener('mouseenter', function() {
          this.querySelector('.tooltip-text').style.visibility = 'visible';
          this.querySelector('.tooltip-text').style.opacity = '1';
        });
        
        tooltip.addEventListener('mouseleave', function() {
          this.querySelector('.tooltip-text').style.visibility = 'hidden';
          this.querySelector('.tooltip-text').style.opacity = '0';
        });
      });
      
      // Add interactive section collapsing with animation
      document.querySelectorAll('details').forEach(detail => {
        detail.addEventListener('toggle', function() {
          if (this.open) {
            // When opening a section, animate entrance of its child elements
            const contentElements = this.querySelectorAll('.content-box > *');
            contentElements.forEach((el, index) => {
              el.style.opacity = '0';
              el.style.transform = 'translateY(20px)';
              
              setTimeout(() => {
                el.style.transition = 'all 0.5s ease';
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
              }, 100 + (index * 50));
            });
          }
        });
      });
      
      // Add "Save as Image" functionality to charts
      document.querySelectorAll('.chart-container').forEach(container => {
        const chartId = container.querySelector('canvas').id;
        
        // Add button to download chart as image
        const downloadBtn = document.createElement('button');
        downloadBtn.className = 'absolute top-2 right-2 bg-white/50 dark:bg-gray-800/50 hover:bg-white/80 dark:hover:bg-gray-800/80 p-1 rounded-full transition-all text-gray-600 dark:text-gray-300';
        downloadBtn.innerHTML = '<i class="fas fa-download"></i>';
        downloadBtn.title = 'Save chart as image';
        
        downloadBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          
          const canvas = document.getElementById(chartId);
          const link = document.createElement('a');
          link.download = `factor-analysis-${chartId}.png`;
          link.href = canvas.toDataURL('image/png');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          // Show confirmation
          const toast = document.createElement('div');
          toast.className = 'fixed bottom-4 left-4 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-4 py-2 rounded shadow-lg z-50';
          toast.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Chart saved as image';
          document.body.appendChild(toast);
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 3000);
        });
        
        // Add positioning to container if not already present
        container.style.position = 'relative';
        container.appendChild(downloadBtn);
      });    });
    
    // Add expanding card animation when hovering over key stat cards
    document.querySelectorAll('.stat-card').forEach(card => {
      card.addEventListener('mouseenter', function() {
        const valueEl = this.querySelector('.text-3xl');
        if (valueEl) {
          valueEl.style.transition = 'transform 0.3s ease';
          valueEl.style.transform = 'scale(1.2)';
        }
      });
      
      card.addEventListener('mouseleave', function() {
        const valueEl = this.querySelector('.text-3xl');
        if (valueEl) {
          valueEl.style.transform = 'scale(1)';
        }
      });
    });
    
    // Add pulse effect to the report header on load
    setTimeout(() => {
      const header = document.querySelector('.report-header');
      header.classList.add('pulse-effect');
      setTimeout(() => header.classList.remove('pulse-effect'), 800);
    }, 1000);
    
    // Add floating action button for quick navigation
    const addFloatingActionButton = () => {
      const fab = document.createElement('div');
      fab.className = 'fixed bottom-6 right-6 bg-primary dark:bg-primary hover:bg-secondary dark:hover:bg-secondary rounded-full w-14 h-14 flex items-center justify-center shadow-lg cursor-pointer z-50 transition-all';
      fab.innerHTML = '<i class="fas fa-chevron-up text-white text-xl"></i>';
      
      fab.addEventListener('click', function() {
        // Check if the menu is already open
        const isOpen = this.getAttribute('data-open') === 'true';
        
        if (isOpen) {
          // Close the menu
          const menu = document.getElementById('fab-menu');
          if (menu) menu.remove();
          this.setAttribute('data-open', 'false');
          this.innerHTML = '<i class="fas fa-chevron-up text-white text-xl"></i>';
        } else {
          // Open the menu
          this.setAttribute('data-open', 'true');
          this.innerHTML = '<i class="fas fa-times text-white text-xl"></i>';
          
          const menu = document.createElement('div');
          menu.id = 'fab-menu';
          menu.className = 'fixed right-6 bg-white dark:bg-gray-800 rounded-lg shadow-xl z-50 transition-all overflow-hidden';
          menu.style.bottom = '80px';
          menu.style.width = '200px';
          menu.style.animation = 'fadeIn 0.3s ease';
          
          // Create menu items for each section
          const sections = [
            { title: 'Key Findings', icon: 'fa-key', color: 'text-indigo-500' },
            { title: 'Data Preparation', icon: 'fa-database', color: 'text-blue-500' },
            { title: 'Suitability Tests', icon: 'fa-vial', color: 'text-green-500' },
            { title: 'Factor Determination', icon: 'fa-ruler', color: 'text-amber-500' },
            { title: 'Factor Loadings', icon: 'fa-table', color: 'text-red-500' },
            { title: 'Communalities', icon: 'fa-chart-bar', color: 'text-purple-500' },
            { title: 'Variance Explained', icon: 'fa-chart-pie', color: 'text-pink-500' },
            { title: 'Practical Implications', icon: 'fa-lightbulb', color: 'text-cyan-500' },
            { title: 'Summary Table', icon: 'fa-clipboard-list', color: 'text-teal-500' }
          ];
          
          menu.innerHTML = `<div class="py-2">
            ${sections.map((section, index) => `
              <div class="section-link px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer flex items-center transition-all" data-index="${index}">
                <i class="fas ${section.icon} ${section.color} w-6"></i>
                <span class="ml-2 text-sm">${section.title}</span>
              </div>
            `).join('')}
          </div>`;
          
          document.body.appendChild(menu);
          
          // Add click handlers to menu items
          menu.querySelectorAll('.section-link').forEach(link => {
            link.addEventListener('click', function() {
              const index = parseInt(this.getAttribute('data-index'));
              const sections = document.querySelectorAll('details');
              
              if (index === 0) {
                // Scroll to key findings
                document.querySelector('.key-finding').scrollIntoView({ behavior: 'smooth' });
              } else if (sections[index - 1]) {
                // Open the section and scroll to it
                sections[index - 1].open = true;
                sections[index - 1].scrollIntoView({ behavior: 'smooth' });
              }
              
              // Close the menu
              document.getElementById('fab-menu').remove();
              fab.setAttribute('data-open', 'false');
              fab.innerHTML = '<i class="fas fa-chevron-up text-white text-xl"></i>';
            });
          });
        }
      });
      
      document.body.appendChild(fab);
    };
    
    // Add floating action button after a slight delay
    setTimeout(addFloatingActionButton, 2000);
    
    // Add the annotation plugin
      varianceExplainedChart.options.plugins.annotation = guideline60pct;
      varianceExplainedChart.update();
      
      // Add CSS for animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes progress-pulse {
          0% { transform: scaleY(1); }
          50% { transform: scaleY(1.2); }
          100% { transform: scaleY(1); }
        }
        .progress-pulse {
          animation: progress-pulse 0.5s ease;
        }
        
        .factor-tooltip {
          position: fixed;
          z-index: 9999;
          background: white;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          padding: 12px;
          max-width: 280px;
          pointer-events: none;
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.3s, transform 0.3s;
        }
        
        .factor-tooltip.show {
          opacity: 1;
          transform: translateY(0);
        }
      `;
      document.head.appendChild(style);
      
      // Make variance explained section interactive
      document.addEventListener('DOMContentLoaded', function() {
        // Create tooltip element
        const tooltip = document.createElement('div');
        tooltip.className = 'factor-tooltip';
        document.body.appendChild(tooltip);
        
        // Factor data
        const factorInfo = [
          {
            name: "Quality of Life/Amenities",
            variables: ["housing", "health", "trans", "arts", "recreate"],
            description: "Represents variables related to living conditions and amenities.",
            color: "indigo"
          },
          {
            name: "Socioeconomic",
            variables: ["crime", "educate", "econ"],
            description: "Represents variables related to economic and social factors.",
            color: "pink"
          },
          {
            name: "Climate",
            variables: ["climate"],
            description: "Represents environment-related variables.",
            color: "cyan"
          }
        ];
        
        // Add row hover effect
        document.querySelectorAll('.variance-row').forEach((row, index) => {
          row.addEventListener('mouseenter', function() {
            // Highlight chart bar
            highlightChartBar(index);
            
            // Show factor info tooltip
            const info = factorInfo[index];
            tooltip.innerHTML = `
              <div class="font-bold text-${info.color}-600 text-lg">Factor ${index + 1}: ${info.name}</div>
              <div class="mt-2">
                <div class="font-medium">Variance explained: <span class="font-bold">${varianceExplainedChart.data.datasets[0].data[index].toFixed(2)}%</span></div>
                <div class="mt-1 font-medium">Variables: <span class="text-gray-600">${info.variables.join(", ")}</span></div>
                <div class="mt-2 text-sm text-gray-600">
                  ${info.description}
                </div>
              </div>
            `;
            
            tooltip.classList.add('show');
            
            // Position tooltip next to the row
            const rect = this.getBoundingClientRect();
            tooltip.style.left = (rect.right + 20) + 'px';
            tooltip.style.top = (rect.top - 10) + 'px';
          });
          
          row.addEventListener('mouseleave', function() {
            // Reset chart
            resetChartBars();
            tooltip.classList.remove('show');
          });
          
          row.addEventListener('click', function() {
            // Pulse effect on row
            this.classList.add('bg-gray-100', 'dark:bg-gray-800');
            setTimeout(() => {
              this.classList.remove('bg-gray-100', 'dark:bg-gray-800');
            }, 300);
            
            // Animate the progress bar
            const progressBar = this.querySelector('.variance-progress-bar');
            if (progressBar) {
              progressBar.classList.add('progress-pulse');
              setTimeout(() => {
                progressBar.classList.remove('progress-pulse');
              }, 500);
            }
          });
        });
        
        // Add chart interactions
        document.getElementById('varianceExplainedChart').addEventListener('mousemove', function(e) {
          const points = varianceExplainedChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, false);
          if (points.length && points[0].datasetIndex === 0) {
            const index = points[0].index;
            
            // Reset all bars
            resetChartBars();
            
            // Highlight selected bar
            highlightChartBar(index);
            
            // Highlight table row
            highlightTableRow(index);
          } else {
            // Reset highlights
            resetChartBars();
            resetTableRows();
          }
        });
        
        document.getElementById('varianceExplainedChart').addEventListener('mouseleave', function() {
          resetChartBars();
          resetTableRows();
        });
        
        // Make total variance box interactive
        const totalVarianceBox = document.querySelector('.mt-6.p-5.rounded-xl');
        if (totalVarianceBox) {
          totalVarianceBox.classList.add('cursor-pointer', 'transition-transform', 'hover:shadow-md', 'duration-300');
          totalVarianceBox.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
          });
          
          totalVarianceBox.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
          });
          
          totalVarianceBox.addEventListener('click', function() {
            const progressBar = this.querySelector('.bg-gradient-to-r');
            progressBar.style.transition = 'width 1s ease-in-out';
            progressBar.style.width = '0%';
            
            setTimeout(() => {
              progressBar.style.width = '62.4%';
            }, 100);
          });
        }
        
        // Utility functions
        function highlightChartBar(index) {
          const dataset = varianceExplainedChart.data.datasets[0];
          const originalBgColors = [
            'rgba(79, 70, 229, 0.8)',
            'rgba(236, 72, 153, 0.8)',
            'rgba(20, 184, 166, 0.8)'
          ];
          
          dataset.backgroundColor = [...originalBgColors];
          dataset.backgroundColor[index] = index === 0 
            ? 'rgba(79, 70, 229, 1)' 
            : (index === 1 ? 'rgba(236, 72, 153, 1)' : 'rgba(20, 184, 166, 1)');
          
          varianceExplainedChart.update();
        }
        
        function resetChartBars() {
          const dataset = varianceExplainedChart.data.datasets[0];
          dataset.backgroundColor = [
            'rgba(79, 70, 229, 0.8)',
            'rgba(236, 72, 153, 0.8)',
            'rgba(20, 184, 166, 0.8)'
          ];
          varianceExplainedChart.update();
        }
        
        function highlightTableRow(index) {
          resetTableRows();
          const row = document.querySelector(`.variance-row[data-index="${index}"]`);
          if (row) {
            if (index === 0) {
              row.classList.add('bg-indigo-50', 'dark:bg-indigo-900/20');
            } else if (index === 1) {
              row.classList.add('bg-pink-50', 'dark:bg-pink-900/20');
            } else {
              row.classList.add('bg-cyan-50', 'dark:bg-cyan-900/20');
            }
          }
        }
        
        function resetTableRows() {
          document.querySelectorAll('.variance-row').forEach(row => {
            row.classList.remove('bg-indigo-50', 'bg-pink-50', 'bg-cyan-50');
            row.classList.remove('dark:bg-indigo-900/20', 'dark:bg-pink-900/20', 'dark:bg-cyan-900/20');
          });
        }
      });
      
      // Enhanced Heatmap Chart for Factor Loadings with interactivity
  </script>

  <!-- Dataset Viewer Script -->
  <script>
    // Dataset viewer functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize dataset viewer
      initDatasetViewer();
    });
    
    function initDatasetViewer() {
      // Elements
      const datasetBtn = document.getElementById('datasetBtn');
      const datasetModal = document.getElementById('datasetModal');
      const datasetContent = document.getElementById('datasetContent');
      const datasetOverlay = document.getElementById('datasetOverlay');
      const datasetCloseBtn = document.getElementById('datasetCloseBtn');
      const datasetLoader = document.getElementById('datasetLoader');
      const datasetError = document.getElementById('datasetError');
      const datasetTableContainer = document.getElementById('datasetTableContainer');
      const datasetSearch = document.getElementById('datasetSearch');
      const datasetDownloadBtn = document.getElementById('datasetDownloadBtn');
      const retryBtn = document.getElementById('retryBtn');
      
      // Tab elements
      const datasetView = document.getElementById('datasetView');
      const summaryTabBtn = document.getElementById('summaryTabBtn');
      const tableTabBtn = document.getElementById('tableTabBtn');
      const dataSummaryTab = document.getElementById('dataSummaryTab');
      const dataTableTab = document.getElementById('dataTableTab');
      
      // Stats tab elements
      const numericalStatsBtn = document.getElementById('numericalStatsBtn');
      const categoricalStatsBtn = document.getElementById('categoricalStatsBtn');
      const numericalStatsTab = document.getElementById('numericalStatsTab');
      const categoricalStatsTab = document.getElementById('categoricalStatsTab');
      
      // Modal controls
      const openModal = () => {
        datasetModal.classList.remove('hidden');
        // Add entrance animation
        setTimeout(() => {
          datasetContent.classList.remove('scale-95', 'opacity-0');
          datasetContent.classList.add('scale-100', 'opacity-100');
        }, 10);
        
        // Load dataset if not already loaded
        if (window.datasetLoaded !== true) {
          loadDataset();
        }
      };
      
      const closeModal = () => {
        // Add exit animation
        datasetContent.classList.remove('scale-100', 'opacity-100');
        datasetContent.classList.add('scale-95', 'opacity-0');
        setTimeout(() => {
          datasetModal.classList.add('hidden');
        }, 300);
      };
      
      // Event listeners
      datasetBtn.addEventListener('click', openModal);
      datasetCloseBtn.addEventListener('click', closeModal);
      datasetOverlay.addEventListener('click', closeModal);
      retryBtn.addEventListener('click', loadDataset);
      
      // No need for default tab initialization here as we do it when data loads
      
      // Tab switching
      summaryTabBtn.addEventListener('click', function() {
        summaryTabBtn.classList.add('text-blue-600', 'dark:text-blue-400', 'border-blue-600', 'dark:border-blue-400');
        summaryTabBtn.classList.remove('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        tableTabBtn.classList.remove('text-blue-600', 'dark:text-blue-400', 'border-blue-600', 'dark:border-blue-400');
        tableTabBtn.classList.add('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        dataSummaryTab.classList.remove('hidden');
        dataTableTab.classList.add('hidden');
      });
      
      tableTabBtn.addEventListener('click', function() {
        tableTabBtn.classList.add('text-blue-600', 'dark:text-blue-400', 'border-blue-600', 'dark:border-blue-400');
        tableTabBtn.classList.remove('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        summaryTabBtn.classList.remove('text-blue-600', 'dark:text-blue-400', 'border-blue-600', 'dark:border-blue-400');
        summaryTabBtn.classList.add('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        dataTableTab.classList.remove('hidden');
        dataSummaryTab.classList.add('hidden');
      });
      
      // Stats tab switching
      numericalStatsBtn.addEventListener('click', function() {
        numericalStatsBtn.classList.add('text-green-600', 'dark:text-green-400', 'border-green-600', 'dark:border-green-400');
        numericalStatsBtn.classList.remove('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        categoricalStatsBtn.classList.remove('text-green-600', 'dark:text-green-400', 'border-green-600', 'dark:border-green-400');
        categoricalStatsBtn.classList.add('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        numericalStatsTab.classList.remove('hidden');
        categoricalStatsTab.classList.add('hidden');
      });
      
      categoricalStatsBtn.addEventListener('click', function() {
        categoricalStatsBtn.classList.add('text-green-600', 'dark:text-green-400', 'border-green-600', 'dark:border-green-400');
        categoricalStatsBtn.classList.remove('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        numericalStatsBtn.classList.remove('text-green-600', 'dark:text-green-400', 'border-green-600', 'dark:border-green-400');
        numericalStatsBtn.classList.add('text-gray-500', 'hover:text-gray-600', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'border-transparent');
        
        categoricalStatsTab.classList.remove('hidden');
        numericalStatsTab.classList.add('hidden');
      });
      
      // Generate data summary
      function generateDataSummary() {
        if (!dataset || dataset.length === 0) return;
        
        // 1. Update dataset overview
        document.getElementById('summaryTotalRows').textContent = dataset.length;
        document.getElementById('summaryTotalCols').textContent = Object.keys(dataset[0]).length;
        
        // 2. Display sample records (first 5)
        displaySampleRecords();
        
        // 3. Generate variable information
        generateVariableInfo();
        
        // 4. Check data quality
        checkDataQuality();
        
        // 5. Calculate basic statistics
        calculateBasicStats();
      }
      
      // Display sample records
      function displaySampleRecords() {
        const sampleTableHeader = document.getElementById('sampleTableHeader');
        const sampleTableBody = document.getElementById('sampleTableBody');
        
        // Clear existing content
        sampleTableHeader.innerHTML = '';
        sampleTableBody.innerHTML = '';
        
        // Get headers
        const headers = Object.keys(dataset[0]);
        
        // Add header cells
        headers.forEach(header => {
          sampleTableHeader.innerHTML += `
            <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              ${header}
            </th>
          `;
        });
        
        // Add sample rows (first 5)
        const sampleSize = Math.min(5, dataset.length);
        for (let i = 0; i < sampleSize; i++) {
          const row = dataset[i];
          let rowHtml = '<tr>';
          
          headers.forEach(header => {
            rowHtml += `<td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${row[header] || ''}</td>`;
          });
          
          rowHtml += '</tr>';
          sampleTableBody.innerHTML += rowHtml;
        }
      }
      
      // Generate variable information
      function generateVariableInfo() {
        const variableInfoBody = document.getElementById('variableInfoBody');
        variableInfoBody.innerHTML = '';
        
        if (dataset.length === 0) return;
        
        const headers = Object.keys(dataset[0]);
        const totalRows = dataset.length;
        
        headers.forEach(header => {
          // Determine variable type
          let variableType = determineVariableType(header);
          
          // Count non-null values
          let nonNullCount = dataset.filter(row => row[header] && row[header] !== '').length;
          let nonNullPercentage = ((nonNullCount / totalRows) * 100).toFixed(2);
          
          variableInfoBody.innerHTML += `
            <tr>
              <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200 font-medium">${header}</td>
              <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">
                <span class="px-2 py-1 text-xs font-medium rounded-full ${getTypeClass(variableType)}">
                  ${variableType}
                </span>
              </td>
              <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${nonNullCount} (${nonNullPercentage}%)</td>
            </tr>
          `;
        });
      }
      
      // Determine variable type
      function determineVariableType(header) {
        // In this factor analysis dataset, all variables are likely numerical
        // You could add more sophisticated type detection here
        const sampleValues = dataset.slice(0, 10).map(row => row[header]);
        
        // Check if values are numeric
        const numericValues = sampleValues.filter(val => !isNaN(parseFloat(val)) && val !== '' && val !== null);
        if (numericValues.length > 0.8 * sampleValues.length) {
          return 'Numerical';
        }
        
        // Check if it's a categorical variable with few unique values
        const uniqueValues = new Set(dataset.map(row => row[header])).size;
        if (uniqueValues < 10 || uniqueValues < dataset.length * 0.05) {
          return 'Categorical';
        }
        
        return 'Text';
      }
      
      // Get CSS class based on variable type
      function getTypeClass(variableType) {
        switch (variableType) {
          case 'Numerical':
            return 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400';
          case 'Categorical':
            return 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400';
          case 'Text':
            return 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400';
          default:
            return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
        }
      }
      
      // Check data quality
      function checkDataQuality() {
        // 1. Count missing values
        let totalMissingValues = 0;
        const missingByColumn = {};
        const headers = Object.keys(dataset[0]);
        
        headers.forEach(header => {
          const missingCount = dataset.filter(row => !row[header] || row[header] === '').length;
          missingByColumn[header] = missingCount;
          totalMissingValues += missingCount;
        });
        
        document.getElementById('summaryMissingValues').textContent = totalMissingValues;
        
        // Populate missing values table
        const missingValuesBody = document.getElementById('missingValuesBody');
        missingValuesBody.innerHTML = '';
        
        Object.entries(missingByColumn)
          .filter(([_, count]) => count > 0)  // Only show columns with missing values
          .sort(([_, countA], [__, countB]) => countB - countA)  // Sort by count (descending)
          .forEach(([column, count]) => {
            const percentage = ((count / dataset.length) * 100).toFixed(2);
            missingValuesBody.innerHTML += `
              <tr>
                <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${column}</td>
                <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${count}</td>
                <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${percentage}%</td>
              </tr>
            `;
          });
        
        // If no missing values, add a message
        if (totalMissingValues === 0) {
          missingValuesBody.innerHTML = `
            <tr>
              <td colspan="3" class="px-4 py-2 text-sm text-center text-green-600 dark:text-green-400">
                No missing values found in the dataset!
              </td>
            </tr>
          `;
        }
        
        // 2. Count duplicate rows
        const rowStrings = dataset.map(row => JSON.stringify(row));
        const uniqueRowStrings = new Set(rowStrings);
        const duplicateCount = rowStrings.length - uniqueRowStrings.size;
        
        document.getElementById('summaryDuplicates').textContent = duplicateCount;
        
        // 3. Detect potential outliers using a simple IQR method for numeric columns
        let totalOutliers = 0;
        
        headers.forEach(header => {
          // Only check numerical columns
          const values = dataset.map(row => parseFloat(row[header])).filter(val => !isNaN(val));
          
          if (values.length > 0) {
            // Sort values
            values.sort((a, b) => a - b);
            
            // Calculate quartiles
            const q1Index = Math.floor(values.length * 0.25);
            const q3Index = Math.floor(values.length * 0.75);
            const q1 = values[q1Index];
            const q3 = values[q3Index];
            
            // Calculate IQR and bounds
            const iqr = q3 - q1;
            const lowerBound = q1 - 1.5 * iqr;
            const upperBound = q3 + 1.5 * iqr;
            
            // Count outliers
            const outliers = values.filter(val => val < lowerBound || val > upperBound);
            totalOutliers += outliers.length;
          }
        });
        
        document.getElementById('summaryOutliers').textContent = totalOutliers;
      }
      
      // Calculate basic statistics
      function calculateBasicStats() {
        const numericalStatsBody = document.getElementById('numericalStatsBody');
        const categoricalStatsBody = document.getElementById('categoricalStatsBody');
        
        numericalStatsBody.innerHTML = '';
        categoricalStatsBody.innerHTML = '';
        
        const headers = Object.keys(dataset[0]);
        
        headers.forEach(header => {
          const variableType = determineVariableType(header);
          
          if (variableType === 'Numerical') {
            // Calculate numerical statistics
            const values = dataset.map(row => parseFloat(row[header])).filter(val => !isNaN(val));
            
            if (values.length > 0) {
              // Calculate mean
              const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
              
              // Calculate median
              const sortedValues = [...values].sort((a, b) => a - b);
              const median = sortedValues.length % 2 === 0
                ? (sortedValues[sortedValues.length / 2 - 1] + sortedValues[sortedValues.length / 2]) / 2
                : sortedValues[Math.floor(sortedValues.length / 2)];
              
              // Calculate standard deviation
              const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
              const std = Math.sqrt(variance);
              
              // Get min and max
              const min = Math.min(...values);
              const max = Math.max(...values);
              
              numericalStatsBody.innerHTML += `
                <tr>
                  <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200 font-medium">${header}</td>
                  <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${mean.toFixed(2)}</td>
                  <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${median.toFixed(2)}</td>
                  <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${std.toFixed(2)}</td>
                  <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${min.toFixed(2)}</td>
                  <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${max.toFixed(2)}</td>
                </tr>
              `;
            }
          } else if (variableType === 'Categorical' || variableType === 'Text') {
            // Calculate categorical statistics
            const valueCountMap = {};
            let totalNonEmpty = 0;
            
            dataset.forEach(row => {
              const value = row[header];
              if (value && value !== '') {
                valueCountMap[value] = (valueCountMap[value] || 0) + 1;
                totalNonEmpty++;
              }
            });
            
            const uniqueValues = Object.keys(valueCountMap).length;
            
            // Find most common value
            let mostCommon = '';
            let highestCount = 0;
            
            Object.entries(valueCountMap).forEach(([value, count]) => {
              if (count > highestCount) {
                mostCommon = value;
                highestCount = count;
              }
            });
            
            const frequency = totalNonEmpty > 0 ? ((highestCount / totalNonEmpty) * 100).toFixed(2) + '%' : 'N/A';
            
            categoricalStatsBody.innerHTML += `
              <tr>
                <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200 font-medium">${header}</td>
                <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${uniqueValues}</td>
                <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${mostCommon}</td>
                <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">${frequency}</td>
              </tr>
            `;
          }
        });
        
                 // Add message if no numerical variables
         if (numericalStatsBody.innerHTML === '') {
           numericalStatsBody.innerHTML = `
             <tr>
               <td colspan="6" class="px-4 py-2 text-sm text-center text-gray-500 dark:text-gray-400">
                 No numerical variables found in the dataset.
               </td>
             </tr>
           `;
         }
         
         // Add message if no categorical variables
         if (categoricalStatsBody.innerHTML === '') {
           categoricalStatsBody.innerHTML = `
             <tr>
               <td colspan="4" class="px-4 py-2 text-sm text-center text-gray-500 dark:text-gray-400">
                 No categorical variables found in the dataset.
               </td>
             </tr>
           `;
         }
       }
      
      // Dataset functionality
      let dataset = []; // Will hold the full dataset
      let filteredDataset = []; // Will hold the filtered dataset
      let currentPage = 1;
      let pageSize = 25;
      
      // CSV fetcher function
      async function loadDataset() {
        // Show loader, hide error and view
        datasetLoader.classList.remove('hidden');
        datasetError.classList.add('hidden');
        datasetView.classList.add('hidden');
        
        try {
          // Get raw CSV from GitHub
          const response = await fetch('https://raw.githubusercontent.com/AdittoAhosanKabbo/Dimension_Reduction/main/Factor%20_Analaysis/FA1/places_tf.csv');
          
          if (!response.ok) {
            throw new Error(`Failed to fetch dataset: ${response.status} ${response.statusText}`);
          }
          
          const csvText = await response.text();
          
          // Parse CSV
          dataset = parseCSV(csvText);
          filteredDataset = [...dataset];
          
          // Update UI
          updateDatasetTable();
          updatePagination();
          updateStats();
          
          // Generate data summary
          generateDataSummary();
          
                     // Hide loader, show view
          datasetLoader.classList.add('hidden');
           datasetView.classList.remove('hidden');
          window.datasetLoaded = true;
           
           // Set default tabs (initially show data summary)
           summaryTabBtn.click();
           numericalStatsBtn.click();
          
          // Initialize search functionality
          initSearch();
          
          // Initialize download functionality
          initDownload(csvText);
          
          // Initialize pagination
          initPagination();
          
          // Initialize sorting
          initSorting();
          
        } catch (error) {
          console.error('Error loading dataset:', error);
          
          // Show error message
          datasetLoader.classList.add('hidden');
          datasetError.classList.remove('hidden');
          document.getElementById('errorMessage').textContent = error.message || 'Failed to load dataset from GitHub.';
        }
      }
      
      // CSV parser function
      function parseCSV(csvText) {
        const lines = csvText.split('\n');
        
        // Get headers from first line
        const headers = lines[0].split(',').map(header => header.trim());
        
        // Parse data rows
        const data = [];
        for (let i = 1; i < lines.length; i++) {
          if (lines[i].trim() === '') continue; // Skip empty lines
          
          const values = lines[i].split(',').map(value => value.trim());
          
          // Create object with headers as keys
          const row = {};
          headers.forEach((header, index) => {
            row[header] = values[index];
          });
          
          data.push(row);
        }
        
        return data;
      }
      
      // Update pagination controls
      function updatePagination() {
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const currentPageEl = document.getElementById('currentPage');
        const totalPagesEl = document.getElementById('totalPages');
        const startRowEl = document.getElementById('startRow');
        const endRowEl = document.getElementById('endRow');
        const totalRowsEl = document.getElementById('totalRows');
        
        // Calculate total pages
        const totalPages = pageSize === 'all' ? 1 : Math.ceil(filteredDataset.length / pageSize);
        
        // Update UI elements
        currentPageEl.textContent = currentPage;
        totalPagesEl.textContent = totalPages;
        
        // Update row count display
        const startRow = filteredDataset.length === 0 ? 0 : pageSize === 'all' ? 1 : (currentPage - 1) * pageSize + 1;
        const endRow = pageSize === 'all' ? filteredDataset.length : Math.min(startRow + parseInt(pageSize) - 1, filteredDataset.length);
        
        startRowEl.textContent = startRow;
        endRowEl.textContent = endRow;
        totalRowsEl.textContent = filteredDataset.length;
        
        // Enable/disable pagination buttons
        prevPageBtn.disabled = currentPage <= 1;
        nextPageBtn.disabled = currentPage >= totalPages;
      }
      
      // Update dataset statistics
      function updateStats() {
        const rowCount = document.getElementById('dataRowCount');
        const colCount = document.getElementById('dataColCount');
        
        if (dataset.length > 0) {
          rowCount.textContent = dataset.length;
          colCount.textContent = Object.keys(dataset[0]).length;
        }
      }
      
      // Initialize pagination controls
      function initPagination() {
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const pageSizeSelect = document.getElementById('dataPageSize');
        
        prevPageBtn.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            updateDatasetTable();
            updatePagination();
          }
        });
        
        nextPageBtn.addEventListener('click', () => {
          const totalPages = pageSize === 'all' ? 1 : Math.ceil(filteredDataset.length / pageSize);
          if (currentPage < totalPages) {
            currentPage++;
            updateDatasetTable();
            updatePagination();
          }
        });
        
        pageSizeSelect.addEventListener('change', () => {
          pageSize = pageSizeSelect.value;
          currentPage = 1; // Reset to first page
          updateDatasetTable();
          updatePagination();
        });
      }
      
      // Initialize search functionality
      function initSearch() {
        datasetSearch.addEventListener('input', debounce(function() {
          const searchTerm = this.value.toLowerCase();
          
          if (searchTerm === '') {
            filteredDataset = [...dataset];
          } else {
            filteredDataset = dataset.filter(row => {
              return Object.values(row).some(value => 
                value.toString().toLowerCase().includes(searchTerm)
              );
            });
          }
          
          currentPage = 1; // Reset to first page
          updateDatasetTable();
          updatePagination();
        }, 300));
      }
      
      // Initialize sorting functionality
      function initSorting() {
        document.querySelectorAll('#tableHeader th').forEach(th => {
          th.addEventListener('click', function() {
            const column = this.getAttribute('data-column');
            
            // Remove sort indicators from all headers
            document.querySelectorAll('#tableHeader th').forEach(header => {
              header.querySelector('i').className = 'fas fa-sort text-gray-400 ml-1';
            });
            
            // Get current sort direction
            let sortDirection = this.getAttribute('data-sort') || 'none';
            
            // Determine new sort direction
            if (sortDirection === 'none' || sortDirection === 'desc') {
              sortDirection = 'asc';
              this.querySelector('i').className = 'fas fa-sort-up text-blue-500 ml-1';
            } else {
              sortDirection = 'desc';
              this.querySelector('i').className = 'fas fa-sort-down text-blue-500 ml-1';
            }
            
            // Set new sort direction
            this.setAttribute('data-sort', sortDirection);
            
            // Sort the dataset
            filteredDataset.sort((a, b) => {
              const valueA = a[column];
              const valueB = b[column];
              
              // Try to convert to numbers for numeric comparison
              const numA = !isNaN(parseFloat(valueA)) ? parseFloat(valueA) : valueA;
              const numB = !isNaN(parseFloat(valueB)) ? parseFloat(valueB) : valueB;
              
              if (sortDirection === 'asc') {
                return numA > numB ? 1 : -1;
              } else {
                return numA < numB ? 1 : -1;
              }
            });
            
            updateDatasetTable();
          });
        });
      }
      
      // Initialize download functionality
      function initDownload(csvText) {
        datasetDownloadBtn.addEventListener('click', () => {
          const blob = new Blob([csvText], { type: 'text/csv' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'factor_analysis_dataset.csv';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });
      }
      
      // Debounce function for search input
      function debounce(func, wait) {
        let timeout;
        return function(...args) {
          const context = this;
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(context, args), wait);
        };
      }
      
      // Initialize Factor Loadings tabs
      function initFactorLoadingsTabs() {
        const tabs = document.querySelectorAll('.tabs .tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            // Remove active class from all tabs and contents
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab
            tab.classList.add('active');
            
            // Show corresponding content
            const tabId = tab.getAttribute('data-tab');
            const content = document.getElementById(tabId);
            if (content) {
              content.classList.add('active');
              
              // Initialize heatmap if heatmap tab is selected
              if (tabId === 'heatmap') {
                const canvas = document.getElementById('heatmapChart');
                if (canvas) {
                  // Set canvas dimensions
                  canvas.width = canvas.parentElement.offsetWidth;
                  canvas.height = 400; // Fixed height
                  drawHeatmap();
                }
              }
            }
          });
        });
      }

      // Initialize social links and enhanced creator profile features
      function initSocialLinks() {
        // Add hover effects to social links
        const socialIcons = document.querySelectorAll('footer a i');
        socialIcons.forEach(icon => {
          icon.parentElement.addEventListener('mouseenter', () => {
            icon.classList.add('animate-bounce');
            setTimeout(() => {
              icon.classList.remove('animate-bounce');
            }, 1000);
          });
        });
        
        // Add a scroll to top feature in footer
        const footerContainer = document.querySelector('footer');
        if (footerContainer) {
          const scrollTopBtn = document.createElement('button');
          scrollTopBtn.className = 'fixed bottom-6 right-6 bg-purple-600 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:bg-purple-700 transition-colors';
          scrollTopBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
          scrollTopBtn.style.zIndex = '50';
          scrollTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
          
          // Only show when scrolled down
          scrollTopBtn.style.opacity = '0';
          scrollTopBtn.style.visibility = 'hidden';
          scrollTopBtn.style.transition = 'opacity 0.3s, visibility 0.3s';
          
          window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
              scrollTopBtn.style.opacity = '1';
              scrollTopBtn.style.visibility = 'visible';
            } else {
              scrollTopBtn.style.opacity = '0';
              scrollTopBtn.style.visibility = 'hidden';
            }
          });
          
          document.body.appendChild(scrollTopBtn);
        }
        
        // Create a tooltip for the creator badge
        const creatorBadge = document.querySelector('.interactive-badge');
        if (creatorBadge) {
          creatorBadge.setAttribute('title', 'Click to view my profile and contact information');
        }
      }

      // Update dataset table with current page data
      function updateDatasetTable() {
        const tableHeader = document.getElementById('tableHeader');
        const tableBody = document.getElementById('tableBody');
        
        // Clear existing content
        tableHeader.innerHTML = '';
        tableBody.innerHTML = '';
        
        if (dataset.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="100%" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                No data available
              </td>
            </tr>
          `;
          return;
        }
        
        // Add headers
        const headers = Object.keys(dataset[0]);
        headers.forEach(header => {
          tableHeader.innerHTML += `
            <th data-column="${header}" class="px-4 py-3 text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600/50 transition-colors">
              ${header}
              <i class="fas fa-sort text-gray-400 ml-1"></i>
            </th>
          `;
        });
        
        // Calculate slice indices based on pagination
        const startIndex = pageSize === 'all' ? 0 : (currentPage - 1) * parseInt(pageSize);
        const endIndex = pageSize === 'all' ? filteredDataset.length : startIndex + parseInt(pageSize);
        
        // Add rows for current page
        const pageData = filteredDataset.slice(startIndex, endIndex);
        
        pageData.forEach((row, rowIndex) => {
          let rowHtml = `
            <tr class="${rowIndex % 2 === 0 ? 'bg-white dark:bg-gray-800' : 'bg-gray-50 dark:bg-gray-700/50'} hover:bg-gray-100 dark:hover:bg-gray-600/50 transition-colors">
          `;
          
          headers.forEach(header => {
            rowHtml += `
              <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200 whitespace-nowrap">
                ${row[header] || ''}
              </td>
            `;
          });
          
          rowHtml += '</tr>';
          tableBody.innerHTML += rowHtml;
        });
      }
    }
  </script>

  <!-- Direct button handling -->
  <script>
    // Direct export handler
    function handleExport() {
      console.log("Export button clicked");
      // Show notification
      const notification = document.createElement('div');
      notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
      notification.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Preparing PDF export...';
      notification.style.zIndex = '9999'; // Ensure it's above everything
      document.body.appendChild(notification);
      
      // Trigger print after a short delay
      setTimeout(() => {
        window.print();
        
        notification.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Export complete!';
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 2000);
      }, 1000);
    }
    
    // Direct share handler
    function handleShare() {
      console.log("Share button clicked");
      
      const url = window.location.href;
      const title = 'Factor Analysis Report';
      
      try {
        if (navigator.share) {
          navigator.share({
            title: title,
            url: url
          }).catch(() => {
            directCopyToClipboard(url);
          });
        } else {
          directCopyToClipboard(url);
        }
      } catch (e) {
        console.error("Share failed:", e);
        directCopyToClipboard(url);
      }
    }
    
    // Helper function to copy text to clipboard
    function directCopyToClipboard(text) {
      // Create a temporary textarea
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-9999px';
      textArea.style.top = '-9999px';
      document.body.appendChild(textArea);
      
      try {
        // Try to select and copy
        textArea.select();
        const success = document.execCommand('copy');
        
        // Show notification based on success
        const notification = document.createElement('div');
        if (success) {
          notification.className = 'fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
          notification.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Link copied to clipboard!';
        } else {
          notification.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
          notification.innerHTML = '<i class="fas fa-exclamation-circle mr-2"></i> Failed to copy link!';
        }
        
        notification.style.zIndex = '9999'; // Ensure it's above everything
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 2000);
      } catch (err) {
        console.error('Unable to copy', err);
      }
      
      document.body.removeChild(textArea);
    }
  </script>

  <!-- Enhanced Interactive Footer -->
  <footer class="bg-gradient-to-br from-gray-900 via-purple-950 to-indigo-900 text-white py-12 mt-12 relative overflow-hidden">
    <!-- Animated background elements -->
    <div class="absolute inset-0 overflow-hidden">
      <div class="particles-js absolute inset-0 opacity-20" id="footer-particles"></div>
      <div class="absolute top-0 right-0 w-96 h-96 bg-blue-500/10 rounded-full filter blur-3xl animate-pulse-slow"></div>
      <div class="absolute bottom-0 left-0 w-96 h-96 bg-purple-500/10 rounded-full filter blur-3xl animate-pulse-slow" style="animation-delay: 2s"></div>
    </div>
    
    <!-- Border glow top -->
    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-purple-500/50 to-transparent"></div>
    
    <!-- Content container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
        <!-- About Creator Section - Enhanced with 3D card -->
        <div class="space-y-4 perspective">
          <h3 class="text-2xl font-bold flex items-center bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-300">
            <i class="fas fa-user-circle mr-3 text-purple-400"></i>
            About Aditto Ahosan Kabbo
          </h3>
          <p class="text-gray-300 text-sm leading-relaxed">Data Enthusiast and Statistics Student at Pabna University of Science and Technology. Passionate about transforming raw data into actionable insights.</p>
          
          <!-- 3D interactive profile card -->
          <div class="profile-card bg-gradient-to-br from-purple-900/60 to-indigo-900/60 backdrop-blur-lg rounded-xl p-6 mt-4 border border-white/10 shadow-xl transform transition-all duration-500 hover:shadow-purple-500/20 group relative">
            <!-- Card tilt effect - JS will be added later -->
            <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-blue-500/5 opacity-0 group-hover:opacity-100 rounded-xl transition-opacity"></div>
            
            <!-- Animated profile picture -->
            <div class="relative w-32 h-32 mx-auto mb-5 rounded-full overflow-hidden profile-pic-container perspective">
              <div class="profile-pic-inner transform transition-all duration-700">
                <img src="https://raw.githubusercontent.com/AdittoAhosanKabbo/AdittoAhosanKabbo/main/Assets/20221031_113233-removebg.png" 
                    alt="Aditto Ahosan Kabbo" 
                    class="w-full h-full object-cover rounded-full border-2 border-purple-400/70 shadow-lg"
                    onerror="this.src='https://avatars.githubusercontent.com/u/AdittoAhosanKabbo'"
                    style="aspect-ratio: 1/1; object-fit: cover; object-position: center top;">
              </div>
              
              <!-- Glowing ring animation -->
              <div class="absolute inset-0 border-2 border-transparent rounded-full animate-spin-slow opacity-0 group-hover:opacity-100" style="background: linear-gradient(45deg, transparent, rgba(147, 51, 234, 0.3), transparent); animation-duration: 3s;"></div>
            </div>
            
            <!-- Animated title with typewriter effect -->
            <div class="text-center h-6 mb-2">
              <span class="inline-block font-medium text-purple-300 typewriter-container overflow-hidden whitespace-nowrap" data-typing="🎓 Statistics Student,💻 Data Enthusiast,📊 Skilled in Visualization ">🎓 Statistics Student</span>
            </div>
            
            <!-- Interactive buttons that appear on hover -->
            <div class="mt-4 flex justify-center space-x-3 opacity-0 group-hover:opacity-100 transition-opacity">
              <button class="btn-glow px-3 py-1 rounded-full bg-purple-600/30 hover:bg-purple-600/50 text-xs font-medium border border-purple-500/30 transition-all flex items-center" onclick="window.open('https://github.com/AdittoAhosanKabbo', '_blank')">
                <i class="fab fa-github mr-1"></i> GitHub
              </button>
              <button class="btn-glow px-3 py-1 rounded-full bg-blue-600/30 hover:bg-blue-600/50 text-xs font-medium border border-blue-500/30 transition-all flex items-center" onclick="window.open('https://www.linkedin.com/in/adittoahosankabbo/', '_blank')">
                <i class="fab fa-linkedin mr-1"></i> LinkedIn
              </button>
            </div>
          </div>
        </div>
        
        <!-- Enhanced Connect with me - Interactive 3D social links -->
        <div class="space-y-5">
          <h3 class="text-2xl font-bold flex items-center bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-cyan-300">
            <i class="fas fa-link mr-3 text-blue-400"></i>
            Connect with me
          </h3>
          <ul class="space-y-3 text-gray-300">
            <li class="flex items-center hover:text-white transition-colors">
              <i class="fab fa-linkedin text-blue-400 w-6"></i>
              <a href="https://www.linkedin.com/in/adittoahosankabbo/" target="_blank" class="ml-2 hover:underline">LinkedIn</a>
            </li>
            <li class="flex items-center hover:text-white transition-colors">
              <i class="fab fa-github text-gray-400 w-6"></i>
              <a href="https://github.com/AdittoAhosanKabbo" target="_blank" class="ml-2 hover:underline">GitHub</a>
            </li>
            <li class="flex items-center hover:text-white transition-colors">
              <i class="fab fa-facebook text-blue-500 w-6"></i>
              <a href="https://www.facebook.com/Adittoahosan" target="_blank" class="ml-2 hover:underline">Facebook</a>
            </li>
            <li class="flex items-center hover:text-white transition-colors">
              <i class="fab fa-kaggle text-cyan-500 w-6"></i>
              <a href="https://www.kaggle.com/adittoahosankabbo" target="_blank" class="ml-2 hover:underline">Kaggle</a>
            </li>
            <li class="flex items-center hover:text-white transition-colors">
              <i class="far fa-envelope text-red-400 w-6"></i>
              <a href="mailto:adittoahosankabbo@gmail.com" class="ml-2 hover:underline">adittoahosankabbo@gmail.com</a>
            </li>
            <li class="flex items-center hover:text-white transition-colors">
              <i class="fab fa-whatsapp text-green-400 w-6"></i>
              <a href="https://wa.me/8801749018051?text=hello" target="_blank" class="ml-2 hover:underline">WhatsApp</a>
            </li>
          </ul>
        </div>
        
        <!-- Skills & Project Links -->
        <div class="space-y-4">
          <h3 class="text-xl font-bold flex items-center">
            <i class="fas fa-laptop-code mr-2 text-green-400"></i>
            Skills & Projects
          </h3>
          <div class="grid grid-cols-2 gap-2 mb-4">
            <div class="bg-white/10 backdrop-blur-sm p-2 rounded text-center">
              <i class="fab fa-python text-xl text-blue-400"></i>
              <p class="text-xs mt-1">Python</p>
            </div>
            <div class="bg-white/10 backdrop-blur-sm p-2 rounded text-center">
              <i class="fas fa-database text-xl text-blue-500"></i>
              <p class="text-xs mt-1">SQL</p>
            </div>
            <div class="bg-white/10 backdrop-blur-sm p-2 rounded text-center">
              <i class="fab fa-r-project text-xl text-blue-300"></i>
              <p class="text-xs mt-1">R</p>
            </div>
            <div class="bg-white/10 backdrop-blur-sm p-2 rounded text-center">
              <i class="fas fa-table text-xl text-green-400"></i>
              <p class="text-xs mt-1">Excel</p>
            </div>
            <div class="bg-white/10 backdrop-blur-sm p-2 rounded text-center">
              <i class="fas fa-chart-bar text-xl text-purple-400"></i>
              <p class="text-xs mt-1">Power BI</p>
            </div>
            <div class="bg-white/10 backdrop-blur-sm p-2 rounded text-center">
              <i class="fas fa-chart-line text-xl text-purple-300"></i>
              <p class="text-xs mt-1">SPSS</p>
            </div>
          </div>
          <p class="text-gray-300 text-sm">View more data analysis and statistics projects on my GitHub and Kaggle profiles.</p>
          <div class="mt-4">
            <a href="https://github.com/AdittoAhosanKabbo" target="_blank" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-full text-sm font-medium hover:from-purple-700 hover:to-indigo-700 transition-all inline-flex items-center">
              <i class="fab fa-github mr-2"></i> View GitHub Projects
            </a>
          </div>
        </div>
      </div>
      
      <div class="mt-8 pt-6 border-t border-white/10 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-400 text-sm">© 2025 Aditto Ahosan Kabbo. All rights reserved.</p>
        <div class="flex space-x-4 mt-4 md:mt-0">
          <a href="https://www.hackerrank.com/profile/aditahosankabbo" target="_blank" class="text-gray-400 hover:text-white transition-colors">
            <i class="fab fa-hackerrank"></i>
          </a>
          <a href="https://www.reddit.com/user/AhosanKabbo/" target="_blank" class="text-gray-400 hover:text-white transition-colors">
            <i class="fab fa-reddit-alien"></i>
          </a>
          <a href="https://www.kaggle.com/adittoahosankabbo" target="_blank" class="text-gray-400 hover:text-white transition-colors">
            <i class="fab fa-kaggle"></i>
          </a>
        </div>
      </div>
    </div>
    
    <!-- Footer particles container -->
    <div id="footer-particles-js" class="absolute inset-0 opacity-20"></div>
  </footer>
  
  <!-- Enhanced footer styles and animations -->
  <style>
    /* 3D perspective for cards */
    .perspective {
      perspective: 1000px;
    }
    
    /* Profile card animations */
    .profile-card {
      transform-style: preserve-3d;
      transition: transform 0.3s ease;
    }
    
    .profile-card:hover {
      transform: translateY(-5px) rotateX(5deg);
    }
    
    .profile-pic-inner:hover {
      transform: scale(1.05) rotateY(10deg);
    }
    
    /* Skill shimmer effect */
    .skill-shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transform: translateX(-100%);
      animation: shimmer 2s infinite;
      animation-play-state: paused;
    }
    
    .skill-card:hover .skill-shimmer {
      animation-play-state: running;
    }
    
    @keyframes shimmer {
      100% { transform: translateX(100%); }
    }
    
    /* Button glow effects */
    .btn-glow {
      position: relative;
      overflow: hidden;
    }
    
    .btn-glow::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 60%);
      opacity: 0;
      transition: opacity 0.5s;
    }
    
    .btn-glow:hover::after {
      opacity: 1;
    }
    
    .btn-glow-alt {
      box-shadow: 0 0 0 transparent;
      transition: all 0.3s;
    }
    
    .btn-glow-alt:hover {
      box-shadow: 0 0 15px rgba(72, 187, 120, 0.3);
    }
    
    /* Social hexagon styles */
    .social-hexagon {
      width: 100%;
      padding-top: 86.6%; /* Height to width ratio for hexagon */
      position: relative;
      background: rgba(255, 255, 255, 0.05);
      clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .social-hexagon:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .hexagon-inner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    /* Social hexagon specific hover colors */
    .social-hexagon.linkedin:hover { box-shadow: 0 10px 20px -10px rgba(10, 102, 194, 0.5); }
    .social-hexagon.github:hover { box-shadow: 0 10px 20px -10px rgba(100, 100, 100, 0.5); }
    .social-hexagon.facebook:hover { box-shadow: 0 10px 20px -10px rgba(66, 103, 178, 0.5); }
    .social-hexagon.kaggle:hover { box-shadow: 0 10px 20px -10px rgba(32, 182, 216, 0.5); }
    .social-hexagon.email:hover { box-shadow: 0 10px 20px -10px rgba(234, 67, 53, 0.5); }
    .social-hexagon.whatsapp:hover { box-shadow: 0 10px 20px -10px rgba(37, 211, 102, 0.5); }
    .social-hexagon.hackerrank:hover { box-shadow: 0 10px 20px -10px rgba(0, 175, 74, 0.5); }
    .social-hexagon.reddit:hover { box-shadow: 0 10px 20px -10px rgba(255, 69, 0, 0.5); }
    
    /* Animated spin for icons */
    @keyframes spin-once {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .group:hover .group-hover\:animate-spin-once {
      animation: spin-once 0.5s ease-in-out;
    }
    
    /* Animated bounce for scroll to top */
    @keyframes bounce-short {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }
    
    .animate-bounce-short {
      animation: bounce-short 1s infinite;
    }
    
    /* Slow spin animation */
    @keyframes spin-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .animate-spin-slow {
      animation: spin-slow 6s linear infinite;
    }
    
    /* Progress bar pulse animation */
    @keyframes pulse-progress {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(1.1); }
    }
    
    .group-hover\:animate-pulse-progress {
      animation: pulse-progress 1.5s ease infinite;
    }
    
    /* Animated sliding gradient */
    @keyframes slide {
      from { transform: translateX(-50%); }
      to { transform: translateX(0); }
    }
    
    .animate-slide {
      animation: slide 2s linear infinite;
    }
    
    /* Text gradient hover effect */
    .text-gradient-hover {
      background-clip: text;
      -webkit-background-clip: text;
      transition: all 0.3s ease;
    }
    
    .text-gradient-hover:hover {
      color: transparent;
      background-image: linear-gradient(45deg, #8b5cf6, #ec4899);
    }
    
    /* Typewriter effect */
    .typewriter-container::after {
      content: '|';
      animation: blink 1s step-end infinite;
    }
    
    @keyframes blink {
      from, to { opacity: 1; }
      50% { opacity: 0; }
    }
  </style>
  
  <!-- Enhanced footer interactive scripts -->
  <script>
    // Initialize after DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize scroll to top button
      initScrollToTop();
      
      // Initialize profile card tilt effect
      initCardTilt();
      
      // Initialize typewriter effect
      initTypewriter();
      
      // Initialize footer particles
      initFooterParticles();
    });
    
    // Scroll to top functionality
    function initScrollToTop() {
      const scrollBtn = document.getElementById('scrollToTopBtn');
      if (!scrollBtn) return;
      
      window.addEventListener('scroll', function() {
        if (window.scrollY > 500) {
          scrollBtn.classList.remove('invisible', 'opacity-0');
          scrollBtn.classList.add('opacity-100');
        } else {
          scrollBtn.classList.remove('opacity-100');
          scrollBtn.classList.add('opacity-0');
          // Keep invisible class for accessibility after fade out
          setTimeout(() => {
            if (window.scrollY <= 500) {
              scrollBtn.classList.add('invisible');
            }
          }, 300);
        }
      });
      
      scrollBtn.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }
    
    // 3D tilt effect for profile card
    function initCardTilt() {
      const card = document.querySelector('.profile-card');
      if (!card) return;
      
      card.addEventListener('mousemove', function(e) {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        const angleX = (y - centerY) / 20;
        const angleY = (centerX - x) / 20;
        
        card.style.transform = `rotateX(${angleX}deg) rotateY(${angleY}deg) translateZ(10px)`;
      });
      
      card.addEventListener('mouseleave', function() {
        card.style.transform = 'rotateX(0) rotateY(0) translateZ(0)';
      });
    }
    
    // Typewriter effect for titles
    function initTypewriter() {
      const typewriterElement = document.querySelector('.typewriter-container');
      if (!typewriterElement) return;
      
      const phrases = typewriterElement.getAttribute('data-typing').split(',');
      let currentPhraseIndex = 0;
      let currentCharIndex = 0;
      let isDeleting = false;
      let typingSpeed = 100;
      
      function type() {
        const currentPhrase = phrases[currentPhraseIndex];
        
        if (isDeleting) {
          typewriterElement.textContent = currentPhrase.substring(0, currentCharIndex - 1);
          currentCharIndex--;
          typingSpeed = 50;
        } else {
          typewriterElement.textContent = currentPhrase.substring(0, currentCharIndex + 1);
          currentCharIndex++;
          typingSpeed = 150;
        }
        
        if (!isDeleting && currentCharIndex === currentPhrase.length) {
          isDeleting = true;
          typingSpeed = 1500; // Pause at the end of phrase
        } else if (isDeleting && currentCharIndex === 0) {
          isDeleting = false;
          currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
          typingSpeed = 500; // Pause before next phrase
        }
        
        setTimeout(type, typingSpeed);
      }
      
      setTimeout(type, 1000);
    }
    
    // Initialize particles effect in footer
    function initFooterParticles() {
      if (typeof particlesJS === 'function' && document.getElementById('footer-particles-js')) {
        particlesJS('footer-particles-js', {
          particles: {
            number: { value: 30, density: { enable: true, value_area: 800 } },
            color: { value: "#ffffff" },
            shape: { type: "circle" },
            opacity: { value: 0.3, random: true },
            size: { value: 3, random: true },
            line_linked: {
              enable: true,
              distance: 150,
              color: "#ffffff",
              opacity: 0.2,
              width: 1
            },
            move: {
              enable: true,
              speed: 1,
              direction: "none",
              random: true,
              straight: false,
              out_mode: "out",
              bounce: false
            }
          },
          interactivity: {
            detect_on: "canvas",
            events: {
              onhover: { enable: true, mode: "grab" },
              onclick: { enable: true, mode: "push" },
              resize: true
            }
          },
          retina_detect: true
        });
      }
    }
  </script>
</body>
</html>
